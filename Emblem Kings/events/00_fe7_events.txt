namespace = fe7
##################################
# FE7 / The Blazing Sword Events #
##################################
# fe7.1	Destroy Nergal's realm on death

#Nergal dies and his realm does not outlive him.
character_event = {
	id = fe7.1
	desc = "EVTDESCfe7.1"
	picture = GFX_evt_death
	
	is_triggered_only = yes
	only_rulers = yes

	trigger = {
		has_landed_title = e_nergal
	}
	
	immediate = {
		# All vassals become independent
		any_vassal = {
			limit = { 
				higher_tier_than = BARON 
			} 
			set_defacto_liege = THIS
		}	
		
		#Destroy Nergal's titles higher than count
		any_demesne_title = {
			limit = {
				is_landless_type_title = no
				higher_tier_than = COUNT
				#NOT = { title = e_nergal }
			}
			destroy_landed_title = ROOT
		}		
		
		# Hand out what's left to random new people of the title's culture/religion
		any_demesne_title = {
			limit = {
				lower_tier_than = DUKE
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				female = no
				age = 20
				religion = THIS
				culture = THIS
			}
			new_character = {
				usurp_title = { target = PREV } 
			}
		}
	}

	option = {
		name = "EVTOPTAfe7.1"	
	}
}

# Create Morph(s)
character_event = {
	id = fe7.2
	desc = "EVTDESCfe7.2"
	picture = GFX_evt_library
	
	is_triggered_only = yes
	only_rulers = yes
	
	immediate = {
	
	}

	option = {
		name = "EVTOPTAfe7.2"	
		character_event = { id = fe7.3 }
	}
	option = {
		name = "EVTOPTBfe7.2"
		location = {
			ROOT = {
				spawn_unit = {
					owner = ROOT
					province = PREV
					home = PREV
					troops = {
						archers = { 150 150 }
						knights = { 100 100 }
						heavy_infantry = { 250 250 }
					}
					attrition = 0
					maintenance_multiplier = 0
				}
				spawn_unit = {
					owner = ROOT
					province = PREV
					home = PREV
					troops = {
						archers = { 150 150 }
						knights = { 100 100 }
						heavy_infantry = { 250 250 }
					}
					attrition = 0
					maintenance_multiplier = 0
				}
				spawn_unit = {
					owner = ROOT
					province = PREV
					home = PREV
					troops = {
						archers = { 150 150 }
						knights = { 100 100 }
						heavy_infantry = { 250 250 }
					}
					attrition = 0
					maintenance_multiplier = 0
				}
			}
		}
	}
	option = {
		name = "EVTOPTCfe7.2"
		ai_chance = { 
			factor = 0
		}
		piety=500
	}
}
character_event = {
	id = fe7.3
	desc = "EVTDESCfe7.3"
	picture = GFX_evt_library
	
	is_triggered_only = yes
	only_rulers = yes
	

	option = {
		name = "EVTOPTAfe7.3" #Warrior
		
		# Male or female?
		random_list = {
			50 = {
				create_character = {
					random_traits = no
					religion = FROM
					culture = FROM
					female = no
					dynasty=none
					age = 20
					attributes = {
						martial = 10
						diplomacy = 10
						stewardship = 10
						intrigue = 10
						learning = 10
					}
					trait = morph
					trait = attractive
					employer = FROM
				}
				
				new_character = {
					# Assign a class
					random_list = {
						6 = {
							add_trait=class_assassin
						}
						5 = {
							add_trait=class_berserker
						}
						5 = {
							add_trait=class_bishop
						}
						6 = {
							add_trait=class_druid
						}
						6 = {
							add_trait=class_general
						}
						5 = {
							add_trait=class_great_knight
						}
						6 = {
							add_trait=class_hero
						}
						5 = {
							add_trait=class_mage_knight
						}
						6 = {
							add_trait=class_paladin
						}
						5 = {
							add_trait=class_ranger
						}
						5 = {
							add_trait=class_rogue
						}
						6 = {
							add_trait=class_sage
						}
						6 = {
							add_trait=class_sniper
						}
						5 = {
							add_trait=class_summoner
						}
						6 = {
							add_trait=class_swordmaster
						}
						6 = {
							add_trait=class_warrior
						}
						5 = {
							add_trait=class_wyvern_knight
						}
						6 = {
							add_trait=class_wyvern_lord
						}
					}
				}
			}
			50 = {
				create_character = {
					random_traits = no
					religion = FROM
					culture = FROM
					female = yes
					dynasty=none
					age = 20
					attributes = {
						martial = 10
						diplomacy = 10
						stewardship = 10
						intrigue = 10
						learning = 10
					}
					trait = morph
					trait = attractive
					employer = FROM
				}
				new_character = {
					# Assign a class
					random_list = {
						5 = {
							add_trait=class_assassin_female
						}
						5 = {
							add_trait=class_berserker		
						}
						5 = {
							add_trait=class_bishop_female		
						}
						5 = {
							add_trait=class_druid_female		
						}
						5 = {
							add_trait=class_falcon_knight		
						}
						5 = {
							add_trait=class_general		
						}
						5 = {
							add_trait=class_great_knight		
						}
						5 = {
							add_trait=class_hero_female		
						}
						5 = {
							add_trait=class_mage_knight_female		
						}
						5 = {
							add_trait=class_paladin		
						}
						5 = {
							add_trait=class_ranger_female		
						}
						5 = {
							add_trait=class_rogue		
						}
						5 = {
							add_trait=class_sage_female		
						}
						5 = {
							add_trait=class_sniper_female		
						}
						5 = {
							add_trait=class_summoner		
						}
						5 = {
							add_trait=class_swordmaster_female		
						}
						5 = {
							add_trait=class_valkyrie		
						}
						5 = {
							add_trait=class_warrior		
						}
						5 = {
							add_trait=class_wyvern_knight		
						}
						5 = {
							add_trait=class_wyvern_lord		
						}
					}
				}
			}
		}
		# Assign education trait
		new_character = {
		random_list = {
			40 = {
				add_trait=brilliant_strategist
			}
			50 = {
				add_trait=skilled_tactician
			}
			10 = {
				add_trait=tough_soldier
			}
		}
		}
	}
	option = {
		name = "EVTOPTBfe7.3"#Diplomat/Intrigue
		
		# Male or female?
		random_list = {
			50 = {
				create_character = {
					random_traits = no
					religion = FROM
					culture = FROM
					female = no
					dynasty=none
					age = 20
					attributes = {
						martial = 10
						diplomacy = 10
						stewardship = 10
						intrigue = 10
						learning = 10
					}
					trait = morph
					trait = attractive
					employer = FROM
				}
				
				new_character = {
					# Assign a class
					random_list = {
						10 = {
							add_trait=class_assassin
						}
						10 = {
							add_trait=class_bishop
						}
						10 = {
							add_trait=class_druid
						}
						10 = {
							add_trait=class_hero
						}
						10 = {
							add_trait=class_mage_knight
						}
						10 = {
							add_trait=class_rogue
						}
						10 = {
							add_trait=class_sage
						}
						10 = {
							add_trait=class_sniper
						}
						10 = {
							add_trait=class_summoner
						}
						10 = {
							add_trait=class_swordmaster
						}
					}
				}
			}
			50 = {
				create_character = {
					random_traits = no
					religion = FROM
					culture = FROM
					female = yes
					dynasty=none
					age = 20
					attributes = {
						martial = 10
						diplomacy = 10
						stewardship = 10
						intrigue = 10
						learning = 10
					}
					trait = morph
					trait = attractive
					employer = FROM
				}
				new_character = {
					# Assign a class
					random_list = {
						9 = {
							add_trait=class_assassin_female
						}
						9 = {
							add_trait=class_bishop_female		
						}
						9 = {
							add_trait=class_druid_female		
						}
						9 = {
							add_trait=class_hero_female		
						}
						9 = {
							add_trait=class_mage_knight_female		
						}
						9 = {
							add_trait=class_rogue		
						}
						10 = {
							add_trait=class_sage_female		
						}
						9 = {
							add_trait=class_sniper_female		
						}
						9 = {
							add_trait=class_summoner		
						}
						9 = {
							add_trait=class_swordmaster_female		
						}
						9 = {
							add_trait=class_valkyrie		
						}
					}
				}
			}
		}
		# Assign education trait
		new_character = {
			random_list = {
				20 = {
					add_trait=grey_eminence
				}
				20 = {
					add_trait=elusive_shadow
				}
				25 = {
					add_trait=charismatic_negotiator
				}
				25 = {
					add_trait=intricate_webweaver
				}
				5 = {
					add_trait=underhanded_rogue
				}
				5 = {
					add_trait=flamboyant_schemer
				}
			}
		}
	}
	option = {
		name = "EVTOPTCfe7.3"#???
		trigger = {
			always=no
		}
	}
	option = {
		name = "EVTOPTDfe7.3" #Cancel
		ai_chance = { 
			factor = 0
		}
		piety=500
	}
}

character_event = {
	id = fe7.998
	
	hide_window = yes # Only fires for unplayable landless characters
	
	is_triggered_only = yes

	capable_only = yes
	prisoner = no
	
	trigger = {
		character = 111 # Lyn
		is_ruler = no
		NOT = { any_spouse = { is_ruler = yes } }
		
		any_claim = {
			title = d_caelin
			has_holder = yes
			holder_scope = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_claimant_adventure_target
				}
			}
		}
	}
	
	immediate = {
		
		wealth = 500
		clr_character_flag = do_not_disturb
		
		liege = {
			character_event = {
				id = TOG.1203
				days = 1
			}
		}
		
		liege = {
			capital_scope = {
				ROOT = {
					set_defacto_liege = ROOT
					
					d_lyn = {
						grant_title = ROOT
						make_primary_title = yes
					}
					
					random_claim = {
						limit = {
							title = d_caelin
							has_holder = yes
							holder_scope = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_claimant_adventure_target
								}
							}
						}
						holder_scope = {
							ROOT = {
								set_character_flag = claimant_adventurer
								random_list = {
									34 = {
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											#leader = THIS
											match_character = PREV
											match_mult = 0.125
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.125
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.125
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.125
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.125
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.125
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
									}
									33 = {
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											#leader = THIS
											match_character = PREV
											match_mult = 0.1
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.1
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.1
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.1
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.1
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.1
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
									}
									33 = {
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											#leader = THIS
											match_character = PREV
											match_mult = 0.075
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.075
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.075
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.075
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.075
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
										spawn_unit = {
											province = PREVPREVPREVPREV
											home = PREVPREVPREVPREV
											owner = THIS
											match_character = PREV
											match_mult = 0.075
											match_min = 300
											match_max = 5000
											attrition = 0.25
											earmark = claimant_adventure
										}
									}
								}
							}
						}
					}
				}
			}
		}
		
		# I no longer have a valid claim on the target
		if = {
			limit = {
				NOT = { has_character_flag = claimant_adventurer }
			}
			break = yes
		}
		
		# Create some decent commander characters
		create_random_soldier = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 30
		}
		create_random_soldier = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 25
		}
		create_random_soldier = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 33
		}
		create_random_soldier = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 29
		}
		
		# Create a fleet, just to be sure
		spawn_fleet = {
			province = closest # closest sea zone
			owner = ROOT
			disband_on_peace = yes
			troops =
			{
				galleys = { 150 150 }
			}
			earmark = claimant_adventure
		}
		
		random_claim = {
			limit = {
				title = d_caelin
				has_holder = yes
				holder_scope = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_claimant_adventure_target
					}
				}
			}
			
#			log = "TOG.1202: [Root.GetBestName] starts claim adventure for [This.GetName]"
			
			holder_scope = {
				reverse_war = {
					target = ROOT
					casus_belli = claim
					thirdparty_title = PREV
				}
				reverse_remove_opinion = {
					who = ROOT
					modifier = opinion_claimant_adventure_target
				}
			}
		}
	}
	
	option = {
		name = OK
	}
}

# Birth of the Black Fang
narrative_event = {
	id = fe7.999
	title = "EVTNAME88000"
	desc = "EVTDESC88000"
	major = yes
	
	picture = GFX_evt_shadow
	
	hide_from = yes
	
	only_playable = yes
	only_men = yes
	min_age = 16
	religion_group = muslim
	
	trigger = {
		year = 1150
		region = world_elibe_greater_bern
		NOT = { 
			has_global_flag = black_fang_founded 
			has_global_flag = black_fang_destroyed
		}
		b_alamut = {
			has_holder = no
		}
		665 = { # Dailam
			NOR = {
				num_of_settlements = 6
				AND = {
					num_of_settlements = 5
					has_settlement_construction = yes
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 6
	}
	
	immediate = {
		set_global_flag = black_fang_founded
		activate_title = { title = d_hashshashin status = yes }
		create_character = {
			random_traits = no
			name = "Hassan"
			dynasty = random
			religion = ROOT
			culture = persian
			female = no
			age = 40
			attributes = {
				martial = 6
				diplomacy = 8
				stewardship = 9
				intrigue = 12
				learning = 12
			}
			health = 6
			fertility = 0.8
			trait = elusive_shadow
			trait = patient
			trait = zealous
			trait = scholar
			trait = chaste
			trait = temperate
		}
		new_character = {
			set_character_flag = hassan_the_assassin
			wealth = 500
			d_hashshashin = {
				grant_title = PREV
			}
			set_government_type = feudal_government
			665 = { # Dailam
				build_holding = {
					title = b_alamut
					type = temple
					holder = PREV
				}
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = no
				age = 16
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = no
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = no
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = no
				age = 20
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = no
				age = 25
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = no
				age = 26
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = no
				age = 28
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = yes
				age = 16
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = yes
				age = 17
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = yes
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = yes
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = persian
				female = yes
				age = 20
			}
		}
	}
	

	option = {
		name = "EVTOPTA88000"
	}
}