# New events by Galle
namespace = battle

### Pre-Battlefield-Duel Events
# battle.1	Begin Battlefield Duel Chain
# battle.2	Defender: Fight or Run?
# battle.3	Attacker: Fight or Run? (Begin Duel)
# battle.4	Defender Runs
# battle.5	Attacker Runs
### Post-Battlefield-Duel Events
# battle.11	(End Duel) Victor Killed Opponent
# battle.12	(End Duel) Victor Takes Opponent Hostage
# battle.13	Opponent Imprisoned

# battle.1	Begin Battlefield Duel Chain
character_event = { # Battlefield Duel Start
	id = battle.1
	desc = "EVTDESCbattle.1"
	border = "GFX_event_normal_frame_war"
	picture = GFX_evt_battle
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		NOT = { has_character_modifier = battlefield_fight }
	}
	
	weight_multiplier = {
		days = 1
		
		modifier = {
			factor = 0.2
			has_game_rule = { name = battlefield_duels value = rare }
		}
		modifier = {
			factor = 5
			has_game_rule = { name = battlefield_duels value = more_frequent }
		}
		
#		modifier = {
#			factor = 0.15
#			trait = back_seat_leader
#		}
		modifier = {
			factor = 4
			trait = aggressive_leader
		}	
		
		modifier = {
			factor = 3
			trait = duelist
		}
		modifier = {
			factor = 3
			trait = brave
		}
		modifier = {
			factor = 3
			trait = wroth
		}
		modifier = {
			factor = 0.33
			trait = craven
		}
		modifier = {
			factor = 0.33
			trait = patient
		}
		#Unlikely to be in middle of battle
		modifier = {
			factor = 0.05
			is_crippled_trigger = yes
		}
		modifier = {
			factor = 0.15
			is_ill = yes
		}
		modifier = {
			factor = 0.15
			is_maimed_trigger = yes
		}
		modifier = {
			factor = 0.25
			trait = wounded
		}
		modifier = {
			factor = 0.05
			trait = infirm
		}
		modifier = {
			factor = 0.05
			trait = blinded
		}
		modifier = {
			factor = 0.05
			trait = blinded_age
		}
	}
	
	immediate = {
		# Target lock
		if = {
			limit = { 
				is_ruler = yes
				war = yes
			}
			random_current_enemy = {
				limit = {
					OR = {
						AND = {						
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }
							NOT = { has_character_modifier = battlefield_fight }
						}
						any_realm_character = {						
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
					}	
				}
				if = {
					limit = {
						in_battle = yes
						at_location = ROOT
						prisoner = no
						is_alive = yes		
						NOT = { character = ROOT }				
						NOT = { has_character_modifier = battlefield_fight }
					}
					character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
					break = yes
				}
				random_realm_character = {
					limit = {
						in_battle = yes
						at_location = ROOT
						prisoner = no
						is_alive = yes		
						NOT = { character = ROOT }				
						NOT = { has_character_modifier = battlefield_fight }
						NOT = { is_liege_or_above = ROOT }
					}
					character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
					break = yes
				}
			}
			random_playable_ruler = {
				limit = {
					war_with = ROOT
					OR = {
						AND = {						
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }
							NOT = { has_character_modifier = battlefield_fight }
						}
						any_realm_character = {						
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
					}	
				}
				if = {
					limit = {
						in_battle = yes
						at_location = ROOT
						prisoner = no
						is_alive = yes		
						NOT = { character = ROOT }					
						NOT = { has_character_modifier = battlefield_fight }
					}
					character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
					break = yes
				}
				random_realm_character = {
					limit = {
						in_battle = yes
						at_location = ROOT
						prisoner = no
						is_alive = yes		
						NOT = { character = ROOT }				
						NOT = { has_character_modifier = battlefield_fight }
						NOT = { is_liege_or_above = ROOT }
					}
					character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
					break = yes
				}
			}
		}
		if = {
			limit = { 
				liege = { NOT = { character = ROOT } }				
			}
			liege = {
				random_current_enemy = {
					limit = {
						OR = {
							AND = {						
								in_battle = yes
								at_location = ROOT
								prisoner = no
								is_alive = yes		
								NOT = { character = ROOT }
								NOT = { has_character_modifier = battlefield_fight }
								NOT = { is_liege_or_above = ROOT }
							}
							any_realm_character = {						
								in_battle = yes
								at_location = ROOT
								prisoner = no
								is_alive = yes		
								NOT = { character = ROOT }
								NOT = { has_character_modifier = battlefield_fight }
								NOT = { is_liege_or_above = ROOT }
							}
						}	
					}
					if = {
						limit = {
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }						
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
						character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
						break = yes
					}
					random_realm_character = {
						limit = {
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }					
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
						character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
						break = yes
					}
				}
				random_playable_ruler = {
					limit = {
						war_with = PREV
						OR = {
							AND = {						
								in_battle = yes
								at_location = ROOT
								prisoner = no
								is_alive = yes		
								NOT = { character = ROOT }
								NOT = { has_character_modifier = battlefield_fight }
								NOT = { is_liege_or_above = ROOT }
							}
							any_realm_character = {						
								in_battle = yes
								at_location = ROOT
								prisoner = no
								is_alive = yes		
								NOT = { character = ROOT }
								NOT = { has_character_modifier = battlefield_fight }
								NOT = { is_liege_or_above = ROOT }
							}
						}
					}
					if = {
						limit = {
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }						
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
						character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
						break = yes
					}
					random_realm_character = {
						limit = {
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }					
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
						character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
						break = yes
					}
				}
			}
		}
		if = {
			limit = { is_ruler = yes }
			random_opinion_modifier_target = {
				limit = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_looted }
					OR = {
						AND = {						
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
						any_realm_character = {						
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
					}
				}
				if = {
					limit = {
						in_battle = yes
						at_location = ROOT
						prisoner = no
						is_alive = yes		
						NOT = { character = ROOT }					
						NOT = { has_character_modifier = battlefield_fight }
						NOT = { is_liege_or_above = ROOT }
					}
					character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
					break = yes
				}
				random_realm_character = {
					limit = {
						in_battle = yes
						at_location = ROOT
						prisoner = no
						is_alive = yes		
						NOT = { character = ROOT }					
						NOT = { has_character_modifier = battlefield_fight }
						NOT = { is_liege_or_above = ROOT }
					}
					character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
					break = yes
				}
			}
		}	
		if = {
			limit = { 
				liege = { NOT = { character = ROOT } }				
			}
			liege = {
				random_opinion_modifier_target = {
					limit = {
						reverse_has_opinion_modifier = { who = PREV modifier = opinion_looted }
						OR = {
							AND = {						
								in_battle = yes
								at_location = ROOT
								prisoner = no
								is_alive = yes		
								NOT = { character = ROOT }
								NOT = { has_character_modifier = battlefield_fight }
								NOT = { is_liege_or_above = ROOT }
							}
							any_realm_character = {						
								in_battle = yes
								at_location = ROOT
								prisoner = no
								is_alive = yes		
								NOT = { character = ROOT }
								NOT = { has_character_modifier = battlefield_fight }
								NOT = { is_liege_or_above = ROOT }
							}
						}
					}
					if = {
						limit = {
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }					
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
						character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
						break = yes
					}
					random_realm_character = {
						limit = {
							in_battle = yes
							at_location = ROOT
							prisoner = no
							is_alive = yes		
							NOT = { character = ROOT }				
							NOT = { has_character_modifier = battlefield_fight }
							NOT = { is_liege_or_above = ROOT }
						}
						character_event = { id = battle.2 tooltip = "EVTTOOLTIPbattle.2" }
						break = yes
					}
				}
			}
		}	
	}
	
	option = {
		name = "EVTOPTAbattle.1"
	}
}


# battle.2	Defender: Fight or Run?
character_event = {
	id = battle.2
	desc = "EVTDESCbattle.2"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	trigger = {
		NOT = { is_liege_or_above = FROM }
	}
	
	immediate = {
		FROM = { add_character_modifier = { name = battlefield_fight duration = 20 } }
		add_character_modifier = { name = battlefield_fight duration = 20 }

		#chance of not being able to flee
		random = {
			chance = 15
#			modifier = {
#				factor = 0.25
#				trait = back_seat_leader
#			}		
			modifier = {
				factor = 2
				trait = aggressive_leader
			}	
			modifier = {
				factor = 2
				trait = duelist
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 0.5
				trait = patient
			}
			set_character_flag = cannot_flee_battle_duel
		}
	}
	
	option = {
		name = "EVTOPTAbattle.2" #Fight
		FROM = { character_event = { id = battle.3 tooltip = "EVTTOOLTIPbattle.3" } }
		ai_chance = {
			factor = 100
			
			modifier = { #Avoid fights
				factor = 0
				NOT = { combat_rating = -5 }
			}
			modifier = {
				factor = 1.33
				combat_rating_diff = { who = FROM value = 1 }
			}
			modifier = {
				factor = 1.33
				combat_rating_diff = { who = FROM value = 2 }
			}
			modifier = {
				factor = 1.33
				combat_rating_diff = { who = FROM value = 3 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 4 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 5 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 6 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 7 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 8 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 10 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 12 }
			}
			
			modifier = {
				factor = 3
				trait = duelist
			}
			modifier = {
				factor = 4
				trait = brave
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = wroth
			}
		}
	}
	
	option = {
		name = "EVTOPTBbattle.2" #run
		trigger = { 
			NOT = { trait = berserker } 
			NOT = { has_character_flag = cannot_flee_battle_duel }
		}
		hidden_tooltip = { FROM = { character_event = { id = battle.4 } } }		
		remove_character_modifier = battlefield_fight
		if = {
			limit = { 
				NOT = { trait = craven } 
				NOT = { trait = brave } 
				NOT = { FROM = { combat_rating_diff = { who = ROOT value = 4 } } }
			}
			random = {
				chance = 25
				add_trait = craven
				hidden_tooltip = {
					character_event ={
						id = 38257 #Notify
					}
				}
			}	
		}
		if = {
			limit = { 
				trait = brave
				NOT = { FROM = { combat_rating_diff = { who = ROOT value = 4 } } }
			}
			random = {
				chance = 25
				remove_trait = brave
			}	
		}
		morale = -0.1
		ai_chance = {
			factor = 100
			
			modifier = {
				factor = 0
				FROM = { NOT = { combat_rating = -5 } }
			}
			modifier = {
				factor = 1.33
				FROM = { combat_rating_diff = { who = ROOT value = 1 } }
			}
			modifier = {
				factor = 1.33
				FROM = { combat_rating_diff = { who = ROOT value = 2 } }
			}
			modifier = {
				factor = 1.33
				FROM = { combat_rating_diff = { who = ROOT value = 3 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 4 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 5 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 6 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 7 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 8 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 10 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 12 } }
			}
			
			modifier = {
				factor = 4
				trait = craven
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = patient
			}
		}
	}
	
	after = {
		clr_character_flag = cannot_flee_battle_duel
	}
}
# battle.3	Attacker: Fight or Run? (Begin Duel)
character_event = {
	id = battle.3
	desc = "EVTDESCbattle.3"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	immediate = {
		#chance of not being able to flee
		random = {
			chance = 15
#			modifier = {
#				factor = 0.25
#				trait = back_seat_leader
#			}	
			modifier = {
				factor = 2
				trait = aggressive_leader
			}			
			modifier = {
				factor = 2
				trait = duelist
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 0.5
				trait = patient
			}
			set_character_flag = cannot_flee_battle_duel
		}
	}
	
	option = {
		name = "EVTOPTAbattle.3" #fight
		
		# Set context flags for duel
		set_character_flag = duel_context_battle
		FROM = { set_character_flag = duel_context_battle }
		set_character_flag = flag_battlefield_duel
		FROM = { set_character_flag = flag_battlefield_duel }
		
		# Begin duel
		hidden_tooltip = { k_naga = { holder_scope = { character_event = { id = duel.0 } } } }
		ai_chance = {
			factor = 100
			modifier = { #Avoid fights
				factor = 0
				NOT = { combat_rating = -5 }
			}
			modifier = {
				factor = 1.33
				combat_rating_diff = { who = FROM value = 1 }
			}
			modifier = {
				factor = 1.33
				combat_rating_diff = { who = FROM value = 2 }
			}
			modifier = {
				factor = 1.33
				combat_rating_diff = { who = FROM value = 3 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 4 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 5 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 6 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 7 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 8 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 10 }
			}
			modifier = {
				factor = 1.5
				combat_rating_diff = { who = FROM value = 12 }
			}
			
			modifier = {
				factor = 3
				trait = duelist
			}
			modifier = {
				factor = 4
				trait = brave
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = wroth
			}
		}
	}
	
	option = {
		name = "EVTOPTBbattle.3" #run
		trigger = { 
			NOT = { trait = berserker } 
			NOT = { has_character_flag = cannot_flee_battle_duel }
		}
		hidden_tooltip = { FROM = { character_event = { id = battle.5 } } }
		remove_character_modifier = battlefield_fight
		if = {
			limit = { 
				NOT = { trait = craven } 
				NOT = { trait = brave } 
				NOT = { FROM = { combat_rating_diff = { who = ROOT value = 4 } } }
			}
			random = {
				chance = 25
				add_trait = craven
				hidden_tooltip = {
					character_event ={
						id = 38257 #Notify
					}
				}
			}	
		}
		if = {
			limit = { 
				trait = brave
				NOT = { FROM = { combat_rating_diff = { who = ROOT value = 4 } } }
			}
			random = {
				chance = 25
				remove_trait = brave
			}	
		}
		morale = -0.1
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = white_walker
			}
			modifier = {
				factor = 0
				FROM = { NOT = { combat_rating = -5 } }
			}
			modifier = {
				factor = 1.33
				FROM = { combat_rating_diff = { who = ROOT value = 1 } }
			}
			modifier = {
				factor = 1.33
				FROM = { combat_rating_diff = { who = ROOT value = 2 } }
			}
			modifier = {
				factor = 1.33
				FROM = { combat_rating_diff = { who = ROOT value = 3 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 4 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 5 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 6 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 7 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 8 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 10 } }
			}
			modifier = {
				factor = 1.5
				FROM = { combat_rating_diff = { who = ROOT value = 12 } }
			}
			
			modifier = {
				factor = 4
				trait = craven
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = patient
			}
		}
	}
	
	after = {
		clr_character_flag = cannot_flee_battle_duel
	}
}
# battle.4	Defender Runs
character_event = {
	id = battle.4
	desc = "EVTDESCbattle.4"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAbattle.4"
		remove_character_modifier = battlefield_fight
		morale = 0.1
	}
}
# battle.5	Attacker Runs
character_event = {
	id = battle.5
	desc = "EVTDESCbattle.5"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAbattle.5"
		remove_character_modifier = battlefield_fight
		morale = 0.1
	}
}

### Post-Battlefield-Duel Events
# battle.11	(End Duel) Victor Killed Opponent
character_event = {
	id = battle.11
	desc = "EVTDESCbattle.11"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	show_from_from = yes
	
	immediate = {
		hidden_tooltip = {
			any_player = {
				limit = {
					OR = {
						any_current_enemy = { character = FROMFROM }
						is_liege_or_above = FROMFROM
						is_liege_of = FROMFROM
						dynasty = FROMFROM
						is_close_relative = FROMFROM
						is_married = FROMFROM
						is_friend = FROMFROM
						is_rival = FROMFROM
						is_lover = FROMFROM
						is_allied_with = FROMFROM
						has_opinion_modifier = { who = FROMFROM modifier = opinion_de_facto_liege }	
						has_opinion_modifier = { who = FROMFROM modifier = opinion_with_rebel_leader }
					}
					NOT = { character = ROOT }
					NOT = { character = FROMFROM }
				}
				character_event = { id = battle.12 }
			}
		}	
	}
	
	option = {
		name = "EVTOPTAbattle.11"
		if = {
			limit = { 
				ai = no 
				FROMFROM = {
					OR = {
						is_ruler = yes
						liege = { is_close_relative = PREV }
						prestige = 250
						trait = skilled_warrior
						trait = master_warrior
					}
				}
			}
			chronicle = {
				entry = CHRONICLE_WON_BATTLE_DUEL_KILL
				portrait = [FromFrom.GetID]
			}
		}
		morale = 0.2
	}
}
# battle.12	(End Duel) Inform liege their vassal killed in combat
character_event = {
	id = battle.12
	desc = "EVTDESCbattle.12"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	show_from_from_from = yes
	
	option = {
		name = "EVTOPTAbattle.12"
		FROM = { show_portrait = yes }
	}
}
# battle.13	Opponent Imprisoned
character_event = {
	id = battle.13
	desc = "EVTDESCbattle.13"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			liege = {
				if = {
					limit = {
						ai = no
						NOT = { character = ROOT }
						NOT = { character = FROM }
					}
					character_event = { id = battle.1399 }
				}
			}
		}	
	}
	
	option = {
		name = "EVTOPTAbattle.13"
		if = {
			limit = { ai = no }
			chronicle = {
				entry = CHRONICLE_LOST_BATTLE_DUEL_CAPTURED
				portrait = [From.GetID]
			}
		}
		FROM = {
			if = {
				limit = { 
					ai = no 
					ROOT = {
						OR = {
							is_ruler = yes
							liege = { is_close_relative = PREV }
							prestige = 250
						}
					}	
				}
				chronicle = {
					entry = CHRONICLE_WON_BATTLE_DUEL_HOSTAGE
					portrait = [Root.GetID]
				}
			}
		}
		tooltip = {
			if = {
				limit = { FROM = { is_ruler = yes } }
				hidden_tooltip = { character_event = { id = 50020 } } # "imprisoned_events.txt"
				ROOT = { imprison = FROM }
			}
			if = {
				limit = { FROM = { is_ruler = no } }
				FROM = {
					liege = { 
						hidden_tooltip = { character_event = { id = 50020 } } # "imprisoned_events.txt"
						ROOT = { imprison = PREV } 
					}
				}	
			}
		}
		set_character_flag = captured_in_battle	
	}
}
# battle.12	(End Duel) Inform liege their vassal was captured
character_event = {
	id = battle.1399
	desc = "EVTDESCbattle.1399"
	picture = GFX_evt_battle
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAbattle.1399"
		FROMFROM = { show_portrait = yes }
	}
}