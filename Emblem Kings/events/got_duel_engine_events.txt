namespace = duel

#####################
# Duel Engine Mk II #
#####################
# Galle (Gregory Hayes)
# May 28 2012
#####################
# Updated by blackninja9939 and knuckey
#####################
# MAIN LOOP
# duel.0	Duel Start
# duel.1	Round Start # Was 5555000
# duel.2	Duelist One Round
# duel.3	Duelist Two Round
# duel.4	Round Resolution
# duel.5	Winner Exploits Hole in Defense
# duel.6	Loser Is Hit
# duel.7	Determine Outcome
######################
# WOUND OUTCOMES (NYI)
######################
# duel.101	Opponent Wounded!
# duel.102	Wounded!
######################
# YIELD OUTCOMES (NYI)
######################
# duel.105	Opponent At Your Mercy!
# duel.106	Subdued! Yield Y/N?
# duel.107	Opponent Yields! Accept Y/N?
# duel.108	Opponent Accepts Your Yield!
# duel.109	Opponent Refuses Your Yield!
# duel.110	You Roll Aside, But Are Wounded!
# duel.111	Your Opponent Rolls Aside, But Is Wounded!
######################
# DEATH OUTCOMES
######################
# duel.201	The final blow!
# duel.202	Slain!
# duel.203	Opponent Slain!
######################
# How to include a duel in an event chain:
# 1. Call an event for the first duelist, that gives them
#    a unique flag for the context of your duel.
# 2. From the first event, call an event for the second duelist,
#    giving THEM a unique flag for the context of your duel.
# 3. Put the following in the second event:
#    k_naga = { holder_scope = { character_event = { id = duel.0 } } }
# 4. In option A of event duel_output.1, in duel_engine_output_events.txt,
#    and a new if statement checking ROOT for either of your context flags.
#	 Remove all context flags from both ROOT and FROM and call the next
#	 event of your chain. For the next event, FROM will be the winner, and
#	 FROMFROM will be the loser.
#########################
# SPECIAL CONTEXT FLAGS
# Put these on a characters before the duel begins in order to
# alter the duel in specific ways.
# They do not need to be removed in your output block.
#########################
# flag_duel_friendly		This character is not trying to kill their opponent.
# flag_duel_to_the_death	This character intends to fight to their death. Overriden by flag_duel_friendly
#########################

# DUEL START
# Starts up the duel, saves event targets, checks for things being broken and sets up duel_rounds counter. Called only once
character_event = { 
	id = duel.0
	is_triggered_only = yes
	
	# Nobody but the actual referee should ever get this
	trigger = { has_landed_title = k_naga }
	
	option = {
		name = "DUEL_START"
		clear_event_target = duelist_1
		clear_event_target = duelist_2
		FROM = { 
			set_variable = { which = duel_rounds value = 0 }
			save_event_target_as = duelist_1 
		}
		FROMFROM = { 
			set_variable = { which = duel_rounds value = 0 }
			save_event_target_as = duelist_2 
		}
		event_target:duelist_2 = { character_event = { id = duel.2 } } # Can skip duel.1 event
		log = "Duel Engine Log: [duelist_1.GetTitledName] and [duelist_2.GetTitledName] start a duel."
	}
}

# ROUND START
# This event starts a new round of combat after resolving the previous one
character_event = {
	id = duel.1
	is_triggered_only = yes
	
	# Nobody but the actual referee should ever get this
	trigger = { 
		has_landed_title = k_naga 
		event_target:duelist_2 = { is_alive = yes }
		event_target:duelist_1 = { is_alive = yes }
	}
	
	option = {
		name = "BEGIN!"		
		event_target:duel_round_winner = { clear_event_target = duel_round_winner }
		event_target:duel_round_loser = { clear_event_target = duel_round_loser }
		event_target:duelist_2 = { character_event = { id = duel.2 } }
	}
}

# MAIN LOOP
# Duel tactics Speed > Force > Defense
character_event = {
	id = duel.2
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	show_from_from = yes
	
	trigger = { event_target:duelist_1 = { is_alive = yes } }
	
	desc = { #default
		text = EVTDESCDUEL2
		trigger = {
		}
	}
	
	#Contexts
	desc = {
		text = EVTDESCDUEL2BATTLE
		trigger = { 
			OR = {
				has_character_flag = reaving_duel
				has_character_flag = flag_battlefield_duel
			}	
		}
	}
	desc = {
		text = EVTDESCDUEL2TRIALBYCOMBAT
		trigger = { 
			OR = {
				has_character_flag = elected_champion
				has_character_flag = demmanded_trial_by_combat
				has_character_flag = champion_of_relative
			}	
		}
	}
	
	#My Traits
	desc = {
		text = EVTDESCDUEL2WOUNDED
		trigger = { trait = wounded }
	}
	desc = {
		text = EVTDESCDUEL2MAIMED
		trigger = { is_maimed_trigger = yes }
	}
	desc = {
		text = EVTDESCDUEL2ILL
		trigger = {
			OR = {
				is_ill = yes
				has_epidemic = yes
			}	
		}
	}
	desc = {
		text = EVTDESCDUEL2YOUNG
		trigger = { 
			NOT = { age = 15 }
			NOT = { trait = tall }
			NOT = { is_strong_trigger = yes }
		}
	}
	
	#Opponent Traits
	desc = {
		text = EVTDESCDUEL2WOUNDEDOPP
		trigger = { event_target:duelist_1 = { trait = wounded } }
	}
	desc = {
		text = EVTDESCDUEL2MAIMEDOPP
		trigger = { event_target:duelist_1 = { is_maimed_trigger = yes } }
	}
	desc = {
		text = EVTDESCDUEL2ILLOPP
		trigger = {
			event_target:duelist_1 = {
				OR = {
					is_ill = yes
					has_epidemic = yes
				}	
			}	
		}
	}
	desc = {
		text = EVTDESCDUEL2YOUNGOPP
		trigger = { 
			event_target:duelist_1 = {
				NOT = { age = 15 }
				NOT = { trait = tall }
				NOT = { is_strong_trigger = yes }
			}	
		}
	}
	
	immediate = {
		clr_character_flag = duel_tactic_speed
		clr_character_flag = duel_tactic_force
		clr_character_flag = duel_tactic_defense
	}
	
	option = { # Speed
		name = {
			text = "EVTOPTADUEL2" #default
			trigger = {
			}
		}
		name = {
			text = "EVTOPTADUEL2TRIALBYCOMBAT"
			trigger = { 
				OR = {
					trait = zealous
					has_character_flag = elected_champion
					has_character_flag = demmanded_trial_by_combat
					has_character_flag = champion_of_relative
				}	
			}
		}	
		name = {
			text = "EVTOPTADUEL2WOUNDED"
			trigger = { 
				trait = wounded	
			}
		}	
		name = {
			text = "EVTOPTADUEL2MAIMED"
			trigger = { 
				is_maimed_trigger = yes	
			}
		}
		name = {
			text = "EVTOPTADUEL2WOUNDEDOPP"
			trigger = { event_target:duelist_1 = { trait = wounded } }
		}
		name = {
			text = "EVTOPTADUEL2YOUNGOPP"
			trigger = { 
				event_target:duelist_1 = { 
					NOT = { age = 15 }
					NOT = { trait = tall }
					NOT = { is_strong_trigger = yes }
				} 
			}
		}
		ai_chance = {
			factor = 33
			modifier = {
				factor = 1.66
				OR = {
					trait = skilled_warrior
					trait = master_warrior
				}
			}
			modifier = {
				factor = 1.66
				is_smart_incl_genius_trigger = yes
			}
		}
		set_character_flag = duel_tactic_speed
		custom_tooltip = { text = TOOLTIPduel_tactic_speed }
		hidden_tooltip = { event_target:duelist_1 = { character_event = { id = duel.3 } } }
	}
	option = { # Force
		name = {
			text = "EVTOPTBDUEL2" #default
			trigger = {
			}
		}
		name = {
			text = "EVTOPTBDUEL2TRIALBYCOMBAT"
			trigger = { 
				OR = {
					trait = zealous
					has_character_flag = elected_champion
					has_character_flag = demmanded_trial_by_combat
					has_character_flag = champion_of_relative
				}	
			}
		}	
		name = {
			text = "EVTOPTBDUEL2WOUNDED"
			trigger = { 
				trait = wounded	
			}
		}	
		name = {
			text = "EVTOPTBDUEL2MAIMED"
			trigger = { 
				is_maimed_trigger = yes	
			}
		}
		name = {
			text = "EVTOPTBDUEL2WOUNDEDOPP"
			trigger = { event_target:duelist_1 = { trait = wounded } }
		}
		name = {
			text = "EVTOPTBDUEL2YOUNGOPP"
			trigger = { 
				event_target:duelist_1 = { 
					NOT = { age = 15 }
					NOT = { trait = tall }
					NOT = { is_strong_trigger = yes }
				} 
			}
		}
		ai_chance = {
			factor = 33
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 1.66
				trait = brave
			}
		}
		set_character_flag = duel_tactic_force
		custom_tooltip = { text = TOOLTIPduel_tactic_force }
		hidden_tooltip = { event_target:duelist_1 = { character_event = { id = duel.3 } } }
	}
	option = { # Defense
		name = {
			text = "EVTOPTCDUEL2" #default
			trigger = {
			}
		}
		name = {
			text = "EVTOPTCDUEL2TRIALBYCOMBAT"
			trigger = { 
				OR = {
					trait = zealous
					has_character_flag = elected_champion
					has_character_flag = demmanded_trial_by_combat
					has_character_flag = champion_of_relative
				}	
			}
		}	
		name = {
			text = "EVTOPTCDUEL2WOUNDED"
			trigger = { 
				trait = wounded	
			}
		}	
		name = {
			text = "EVTOPTCDUEL2MAIMED"
			trigger = { 
				is_maimed_trigger = yes	
			}
		}
		name = {
			text = "EVTOPTCDUEL2WOUNDEDOPP"
			trigger = { event_target:duelist_1 = { trait = wounded } }
		}
		name = {
			text = "EVTOPTCDUEL2YOUNGOPP"
			trigger = { 
				event_target:duelist_1 = { 
					NOT = { age = 15 }
					NOT = { trait = tall }
					NOT = { is_strong_trigger = yes }
				} 
			}
		}
		ai_chance = {
			factor = 33
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 1.66
				trait = craven
			}
		}
		set_character_flag = duel_tactic_defense
		custom_tooltip = { text = TOOLTIPduel_tactic_defense }
		hidden_tooltip = { event_target:duelist_1 = { character_event = { id = duel.3 } } }
	}
}
character_event = {
	id = duel.3
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = duel_tactic_speed
		clr_character_flag = duel_tactic_force
		clr_character_flag = duel_tactic_defense
	}
	
	desc = { #default
		text = EVTDESCDUEL3
		trigger = {
		}
	}
	
	#Contexts
	desc = {
		text = EVTDESCDUEL3BATTLE
		trigger = { 
			OR = {
				has_character_flag = reaving_duel
				has_character_flag = flag_battlefield_duel
			}	
		}
	}
	desc = {
		text = EVTDESCDUEL3TRIALBYCOMBAT
		trigger = { 
			OR = {
				has_character_flag = elected_champion
				has_character_flag = demmanded_trial_by_combat
				has_character_flag = champion_of_relative
			}	
		}
	}
	
	#My Traits
	desc = {
		text = EVTDESCDUEL3WOUNDED
		trigger = { trait = wounded }
	}
	desc = {
		text = EVTDESCDUEL3MAIMED
		trigger = { is_maimed_trigger = yes }
	}
	desc = {
		text = EVTDESCDUEL3ILL
		trigger = {
			OR = {
				is_ill = yes
				has_epidemic = yes
			}	
		}
	}
	desc = {
		text = EVTDESCDUEL3YOUNG
		trigger = { 
			NOT = { age = 15 }
			NOT = { trait = tall }
			NOT = { is_strong_trigger = yes }
		}
	}
	
	#Opponent Traits
	desc = {
		text = EVTDESCDUEL3WOUNDEDOPP
		trigger = { event_target:duelist_2 = { trait = wounded } }
	}
	desc = {
		text = EVTDESCDUEL3MAIMEDOPP
		trigger = { event_target:duelist_2 = { is_maimed_trigger = yes } }
	}
	desc = {
		text = EVTDESCDUEL3ILLOPP
		trigger = {
			event_target:duelist_2 = {
				OR = {
					is_ill = yes
					has_epidemic = yes
				}	
			}	
		}
	}
	desc = {
		text = EVTDESCDUEL3YOUNGOPP
		trigger = { 
			event_target:duelist_2 = {
				NOT = { age = 15 }
				NOT = { trait = tall }
				NOT = { is_strong_trigger = yes }
			}	
		}
	}
	
	option = { # Speed
		name = {
			text = "EVTOPTADUEL3" #default
			trigger = {
			}
		}
		name = {
			text = "EVTOPTADUEL3TRIALBYCOMBAT"
			trigger = { 
				OR = {
					trait = zealous
					has_character_flag = elected_champion
					has_character_flag = demmanded_trial_by_combat
					has_character_flag = champion_of_relative
				}	
			}
		}	
		name = {
			text = "EVTOPTADUEL3WOUNDED"
			trigger = { 
				trait = wounded	
			}
		}	
		name = {
			text = "EVTOPTADUEL3MAIMED"
			trigger = { 
				is_maimed_trigger = yes	
			}
		}
		name = {
			text = "EVTOPTADUEL3WOUNDEDOPP"
			trigger = { event_target:duelist_2 = { trait = wounded } }
		}
		name = {
			text = "EVTOPTADUEL3YOUNGOPP"
			trigger = { 
				event_target:duelist_2 = { 
					NOT = { age = 15 }
					NOT = { trait = tall }
					NOT = { is_strong_trigger = yes }
				} 
			}
		}
		ai_chance = {
			factor = 33
			modifier = {
				factor = 1.66
				OR = {
					trait = skilled_warrior
					trait = master_warrior
				}
			}
			modifier = {
				factor = 1.66
				is_smart_incl_genius_trigger = yes
			}
		}
		set_character_flag = duel_tactic_speed
		custom_tooltip = { text = TOOLTIPduel_tactic_speed }
		hidden_tooltip = { k_naga = { holder_scope = { character_event = { id = duel.4 } } } }
	}
	option = { # Force
		name = {
			text = "EVTOPTBDUEL3" #default
			trigger = {
			}
		}
		name = {
			text = "EVTOPTBDUEL3TRIALBYCOMBAT"
			trigger = { 
				OR = {
					trait = zealous
					has_character_flag = elected_champion
					has_character_flag = demmanded_trial_by_combat
					has_character_flag = champion_of_relative
				}	
			}
		}	
		name = {
			text = "EVTOPTBDUEL3WOUNDED"
			trigger = { 
				trait = wounded	
			}
		}	
		name = {
			text = "EVTOPTBDUEL3MAIMED"
			trigger = { 
				is_maimed_trigger = yes	
			}
		}
		name = {
			text = "EVTOPTBDUEL3WOUNDEDOPP"
			trigger = { event_target:duelist_2 = { trait = wounded } }
		}
		name = {
			text = "EVTOPTBDUEL3YOUNGOPP"
			trigger = { 
				event_target:duelist_2 = { 
					NOT = { age = 15 }
					NOT = { trait = tall }
					NOT = { is_strong_trigger = yes }
				} 
			}
		}
		ai_chance = {
			factor = 33
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 1.66
				trait = brave
			}
		}
		set_character_flag = duel_tactic_force
		custom_tooltip = { text = TOOLTIPduel_tactic_force }
		hidden_tooltip = { k_naga = { holder_scope = { character_event = { id = duel.4 } } } }
	}
	option = { # Defense
		name = {
			text = "EVTOPTCDUEL3" #default
			trigger = {
			}
		}
		name = {
			text = "EVTOPTCDUEL3TRIALBYCOMBAT"
			trigger = { 
				OR = {
					trait = zealous
					has_character_flag = elected_champion
					has_character_flag = demmanded_trial_by_combat
					has_character_flag = champion_of_relative
				}	
			}
		}	
		name = {
			text = "EVTOPTC3DUELWOUNDED"
			trigger = { 
				trait = wounded	
			}
		}	
		name = {
			text = "EVTOPTC3DUELMAIMED"
			trigger = { 
				is_maimed_trigger = yes	
			}
		}
		name = {
			text = "EVTOPTCDUEL3WOUNDEDOPP"
			trigger = { event_target:duelist_2 = { trait = wounded } }
		}
		name = {
			text = "EVTOPTCDUEL3YOUNGOPP"
			trigger = { 
				event_target:duelist_2 = { 
					NOT = { age = 15 }
					NOT = { trait = tall }
					NOT = { is_strong_trigger = yes }
				} 
			}
		}
		ai_chance = {
			factor = 33
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 1.66
				trait = craven
			}
		}
		set_character_flag = duel_tactic_defense
		custom_tooltip = { text = TOOLTIPduel_tactic_defense }
		hidden_tooltip = { k_naga = { holder_scope = { character_event = { id = duel.4 } } } }
	}
}

# RESOLVE ROUND - WINNER
# Determine who "won" the round by weighting stats
character_event = {
	id = duel.4
	is_triggered_only = yes
	
	# Nobody but the actual referee should ever get this
	trigger = { has_landed_title = k_naga }
	
	# Increase duel_rounds counter
	immediate = {
		event_target:duelist_1 = { change_variable = { which = duel_rounds value = 1 } }
		event_target:duelist_2 = { change_variable = { which = duel_rounds value = 1 } }
	}
	
	##The combat_rating trait/modifier entry is used to display an estimate of the below modifiers
	#As combat_rating is additive, use the logarithm (base sqrt(2)) of the below modifiers for the combat_rating
	#This ensures a more accurate estimate of comparitive duel ability
	
	# duelist_2 wins the round
	option = {
		name = duelist_2_wins
		ai_chance = {
			factor = 1
			
			# Random factor Rule Effects
			# if these factors are changed the game rule localisation must be changed
			modifier = { #high
				factor = 2
				event_target:duelist_1 = { combat_rating_diff = { who = event_target:duelist_2 value = 3 } }
				has_game_rule = { name = duel_outcome_randomness value = high } 
			}
			modifier = { #low
				factor = 1.75
				event_target:duelist_2 = { combat_rating_diff = { who = event_target:duelist_1 value = 2.5 } }
				has_game_rule = { name = duel_outcome_randomness value = low }
			}
			modifier = {
				factor = 1.286
				event_target:duelist_2 = { combat_rating_diff = { who = event_target:duelist_1 value = 4 } }
				has_game_rule = { name = duel_outcome_randomness value = low }
			}
			modifier = { #very low
				factor = 4.5
				event_target:duelist_2 = { combat_rating_diff = { who = event_target:duelist_1 value = 2.5 } }
				has_game_rule = { name = duel_outcome_randomness value = very_low }
			}
			modifier = {
				factor = 2.667
				event_target:duelist_2 = { combat_rating_diff = { who = event_target:duelist_1 value = 4 } }
				has_game_rule = { name = duel_outcome_randomness value = very_low }
			}
						
			# Skill-at-Arms Effects
			modifier = {
				factor = 2
				event_target:duelist_2 = { trait = poor_warrior }
			}
			modifier = {
				factor = 4
				event_target:duelist_2 = { trait = trained_warrior }
			}
			modifier = {
				factor = 8
				event_target:duelist_2 = { trait = skilled_warrior }
			}
			modifier = {
				factor = 16
				event_target:duelist_2 = { trait = master_warrior }
			}
			
			# Duel tactic
			modifier = {
				factor = 2
				OR = {
					AND = {
						event_target:duelist_2 = { has_character_flag = duel_tactic_speed }
						event_target:duelist_1 = { has_character_flag = duel_tactic_force }
					}
					AND = {
						event_target:duelist_2 = { has_character_flag = duel_tactic_force }
						event_target:duelist_1 = { has_character_flag = duel_tactic_defense }
					}
					AND = {
						event_target:duelist_2 = { has_character_flag = duel_tactic_defense }
						event_target:duelist_1 = { has_character_flag = duel_tactic_speed }
					}
				}
			}
	
			# Weapon effects
			modifier = {
				factor = 2
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_4
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_3
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.35
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_2
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.2
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_1
						is_artifact_equipped = yes
					}
				}	
			}
			
			
			modifier = {
				factor = 1.2
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_1
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.35
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_2
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_3
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 2
				event_target:duelist_2 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_4
						is_artifact_equipped = yes
					}
				}	
			}
			
			# Physical Strength Effects
			modifier = {
				factor = 2
				event_target:duelist_2 = { is_strong_trigger = yes }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { is_weak_trigger = yes }
			}
			
			# Cunning/Intelligence Effects
			modifier = {
				factor = 2
				event_target:duelist_2 = { trait = genius }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { is_smart_trigger = yes }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { trait = imbecile }
			}
			modifier = {
				factor = 0.666
				event_target:duelist_2 = { is_dumb_trigger = yes }
			}
			
			# Personality Effects
			modifier = {
				factor = 2
				event_target:duelist_2 = { trait = brave }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { trait = craven }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = deceitful }
			}
			modifier = {
				factor = 0.666
				event_target:duelist_2 = { trait = honest }
			}
			modifier = {
				factor = 2
				event_target:duelist_2 = { trait = ruthless }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = cannibal_trait }
			}
			
			# Wound Effects
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { trait = wounded }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_2 = { trait = maimed }
			}
			modifier = {
				factor = 0
				event_target:duelist_2 = { 
					OR = {
						trait = incapable 
						trait = crippled	
						trait = sick_incapable
					}	
				}
				event_target:duelist_1 = { 
					NOR = {
						trait = incapable 
						trait = crippled
						trait = sick_incapable						
					}	
				}
			}
			modifier = {
				factor = 0.25
				event_target:duelist_2 = { trait = one_eyed }
			}
			modifier = {
				factor = 0.125
				event_target:duelist_2 = { trait = one_handed }
			}
			modifier = {
				factor = 0.125
				event_target:duelist_2 = { trait = one_legged }
			}
			modifier = {
				factor = 0.05
				event_target:duelist_2 = { trait = mangled }
			}
			modifier = {
				factor = 0.125
				event_target:duelist_2 = { trait = severely_injured }
			}
			
			# Health Effects			
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { is_ill = yes }
			}	
			modifier = {
				factor = 0.25
				event_target:duelist_2 = { trait = infirm }
			}
			modifier = {
				factor = 0.166
				event_target:duelist_2 = { has_epidemic = yes }	
			}
			modifier = {
				factor = 0.033
				event_target:duelist_2 = {
					OR = {
						trait = blinded
						trait = blinded_age
					}
				}	
			}
			modifier = {
				factor = 0.75
				event_target:duelist_2 = { trait = drunkard }
			}
			
			# Body Shape Effects
			modifier = {
				factor = 3
				event_target:duelist_2 = { trait = tall }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_2 = { trait = hunchback }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_2 = { trait = dwarf }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_2 = { trait = clubfooted }
			}
			
			# Age Effects
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { age = 50 }
			}
			modifier = {
				factor = 0.333
				event_target:duelist_2 = { age = 70 }
			}
			
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_2 = { age = 16 } }
			}
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_2 = { age = 12 } }
			}
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_2 = { age = 8 } }
			}
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_2 = { age = 4 } }
			}
			
			# Way of Life war focus effects
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { has_character_modifier = wol_duel_training }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { has_character_modifier = wol_war_fit }
			}
			
			
			# Magical Effects
			modifier = {
				factor = 2
				event_target:duelist_2 = { trait = direwolf }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = wolf }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = snowbear }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = eagle }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = shadowcat }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = brownbear }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { trait = dog }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { trait = crow }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { trait = boar }
			}
			modifier = {
				factor = 2
				event_target:duelist_2 = { trait = chosen_by_rhllor }
			}
			modifier = {
				factor = 4
				event_target:duelist_2 = { trait = resurrected_by_rhllor }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { trait = favored_by_rhllor }
			}
			modifier = {
				factor = 0.8
				107 = { 
					NOT = { has_province_modifier = completeharren3 } 
					NOT = { has_province_flag = pre_harren_harrenhal }
				}
				event_target:duelist_2 = { has_landed_title = c_harrenhal }
			}
			modifier = {
				factor = 0.8
				107 = { 
					NOT = { has_province_modifier = completeharren3 } 
					NOT = { has_province_flag = pre_harren_harrenhal }
				}
				c_harrenhal = {
					holder_scope = {
						OR = {
							any_child = { character = event_target:duelist_2 }
							any_child = { any_child = { character = event_target:duelist_2 } }
						}
					}
				}
			}
			modifier = {
				factor = 2
				event_target:duelist_2 = { has_character_modifier = demon_child_non_pagan }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { trait = dragon_dreams } # Can see into the future-ish
			}
			modifier = {
				factor = 5
				event_target:duelist_2 = { trait = white_walker } # Counteract age effect
			}
			modifier = {
				factor = 4
				event_target:duelist_2 = { trait = immortal } # Counteract age effect
			}
			modifier = {
				factor = 4
				event_target:duelist_2 = { trait = undead }
			}
			
			# Misc character modifiers
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { has_character_modifier = wolf_blood }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { has_character_modifier = lycanthropy }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { has_character_modifier = manly_skill_wrestling }
			}
			modifier = {
				factor = 4
				event_target:duelist_2 = { has_character_modifier = martially_ambidextrous }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { any_artifact = { artifact_type = prosthetic_hand_metal is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_2 = { any_artifact = { artifact_type = prosthetic_leg_artifact is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { has_character_modifier = peg_leg }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { has_character_modifier = phantom_pain }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_2 = { has_character_modifier = severe_illness }
			}
			modifier = {
				factor = 0.05
				event_target:duelist_2 = { has_character_modifier = bedridden_illness }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_2 = { any_artifact = { artifact_type = how_to_hold_a_sword is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_2 = { any_artifact = { artifact_type = a_soldiers_life is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { any_artifact = { artifact_type = my_fechtbuch is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { any_artifact = { artifact_type = the_sword_and_buckler is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_2 = { any_artifact = { artifact_type = lessons_taught_to_me_by_rival_2 is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { any_artifact = { artifact_type = lessons_taught_to_me_by_rival_3 is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_2 = { any_artifact = { artifact_type = the_wisdom_of_the_heavens is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { any_artifact = { artifact_type = ordinary_beasts is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_2 = { any_artifact = { artifact_type = the_book_of_shadows is_artifact_active = yes } }
			}
		}	
		event_target:duelist_1 = {
			save_event_target_as = duel_round_loser
			clr_character_flag = duel_random_boost
		}
		event_target:duelist_2 = { 
			save_event_target_as = duel_round_winner
			clr_character_flag = duel_random_boost
			character_event = { id = duel.5 }
		}
	}
	
	# duelist_1 wins the round
	option = {
		name = duelist_1_wins
		ai_chance = {
			factor = 1
			
			# Random factor Rule Effects
			modifier = { #high
				factor = 2
				event_target:duelist_2 = { combat_rating_diff = { who = event_target:duelist_1 value = 3 } }
				has_game_rule = { name = duel_outcome_randomness value = high } 
			}
			modifier = { #low
				factor = 1.75
				event_target:duelist_1 = { combat_rating_diff = { who = event_target:duelist_2 value = 2.5 } }
				has_game_rule = { name = duel_outcome_randomness value = low }
			}
			modifier = {
				factor = 1.286
				event_target:duelist_1 = { combat_rating_diff = { who = event_target:duelist_2 value = 4 } }
				has_game_rule = { name = duel_outcome_randomness value = low }
			}
			modifier = { #very low
				factor = 4.5
				event_target:duelist_1 = { combat_rating_diff = { who = event_target:duelist_2 value = 2.5 } }
				has_game_rule = { name = duel_outcome_randomness value = very_low }
			}
			modifier = {
				factor = 2.667
				event_target:duelist_1 = { combat_rating_diff = { who = event_target:duelist_2 value = 4 } }
				has_game_rule = { name = duel_outcome_randomness value = very_low }
			}
			# Skill-at-Arms Effects
			modifier = {
				factor = 2
				event_target:duelist_1 = { trait = poor_warrior }
			}
			modifier = {
				factor = 4
				event_target:duelist_1 = { trait = trained_warrior }
			}
			modifier = {
				factor = 8
				event_target:duelist_1 = { trait = skilled_warrior }
			}
			modifier = {
				factor = 16
				event_target:duelist_1 = { trait = master_warrior }
			}
			
			# Duel tactic
			modifier = {
				factor = 2
				OR = {
					AND = {
						event_target:duelist_1 = { has_character_flag = duel_tactic_speed }
						event_target:duelist_2 = { has_character_flag = duel_tactic_force }
					}
					AND = {
						event_target:duelist_1 = { has_character_flag = duel_tactic_force }
						event_target:duelist_2 = { has_character_flag = duel_tactic_defense }
					}
					AND = {
						event_target:duelist_1 = { has_character_flag = duel_tactic_defense }
						event_target:duelist_2 = { has_character_flag = duel_tactic_speed }
					}
				}
			}
			
			# Weapon effects
			modifier = {
				factor = 2
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_4
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_3
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.35
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_2
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.2
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = combat_tier_1
						is_artifact_equipped = yes
					}
				}	
			}
			
			
			modifier = {
				factor = 1.2
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_1
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.35
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_2
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_3
						is_artifact_equipped = yes
					}
				}	
			}
			modifier = {
				factor = 2
				event_target:duelist_1 = {
					any_artifact = { 
						has_artifact_flag = armour_tier_4
						is_artifact_equipped = yes
					}
				}	
			}
			
			# Physical Strength Effects
			modifier = {
				factor = 2
				event_target:duelist_1 = { is_strong_trigger = yes }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { is_weak_trigger = yes }
			}
			
			# Cunning/Intelligence Effects
			modifier = {
				factor = 2
				event_target:duelist_1 = { trait = genius }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { is_smart_trigger = yes }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { trait = imbecile }
			}
			modifier = {
				factor = 0.666
				event_target:duelist_1 = { is_dumb_trigger = yes }
			}
			
			# Personality Effects
			modifier = {
				factor = 2
				event_target:duelist_1 = { trait = brave }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { trait = craven }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = deceitful }
			}
			modifier = {
				factor = 0.666
				event_target:duelist_1 = { trait = honest }
			}
			modifier = {
				factor = 2
				event_target:duelist_1 = { trait = ruthless }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = cannibal_trait }
			}
			
			# Wound Effects
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { trait = wounded }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_1 = { trait = maimed }
			}
			modifier = {
				factor = 0
				event_target:duelist_1 = { 
					OR = {
						trait = incapable 
						trait = crippled	
						trait = sick_incapable
					}	
				}
				event_target:duelist_2 = { 
					NOR = {
						trait = incapable 
						trait = crippled
						trait = sick_incapable						
					}	
				}
			}
			modifier = {
				factor = 0.25
				event_target:duelist_1 = { trait = one_eyed }
			}
			modifier = {
				factor = 0.125
				event_target:duelist_1 = { trait = one_handed }
			}
			modifier = {
				factor = 0.125
				event_target:duelist_1 = { trait = one_legged }
			}
			modifier = {
				factor = 0.05
				event_target:duelist_1 = { trait = mangled }
			}
			modifier = {
				factor = 0.125
				event_target:duelist_1 = { trait = severely_injured }
			}
			
			# Health Effects
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { is_ill = yes }
			}	
			modifier = {
				factor = 0.25
				event_target:duelist_1 = { trait = infirm }
			}
			modifier = {
				factor = 0.166
				event_target:duelist_1 = { has_epidemic = yes }	
			}
			modifier = {
				factor = 0.033
				event_target:duelist_1 = {
					OR = {
						trait = blinded
						trait = blinded_age
					}
				}	
			}
			modifier = {
				factor = 0.75
				event_target:duelist_1 = { trait = drunkard }
			}
			
			# Body Shape Effects
			modifier = {
				factor = 3
				event_target:duelist_1 = { trait = tall }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_1 = { trait = hunchback }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_1 = { trait = dwarf }
			}
			modifier = {
				factor = 0.25
				event_target:duelist_1 = { trait = clubfooted }
			}
			
			# Age Effects
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { age = 50 }
			}
			modifier = {
				factor = 0.333
				event_target:duelist_1 = { age = 70 }
			}
			
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_1 = { age = 16 } }
			}
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_1 = { age = 12 } }
			}
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_1 = { age = 8 } }
			}
			modifier = {
				factor = 0.5
				NOT = { event_target:duelist_1 = { age = 4 } }
			}
			
			# Way of Life war focus effects
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { has_character_modifier = wol_duel_training }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { has_character_modifier = wol_war_fit }
			}
			
			
			# Magical Effects
			modifier = {
				factor = 2
				event_target:duelist_1 = { trait = direwolf }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = wolf }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = snowbear }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = eagle }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = shadowcat }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = brownbear }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { trait = dog }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { trait = crow }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { trait = boar }
			}
			modifier = {
				factor = 2
				event_target:duelist_1 = { trait = chosen_by_rhllor }
			}
			modifier = {
				factor = 4
				event_target:duelist_1 = { trait = resurrected_by_rhllor }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { trait = favored_by_rhllor }
			}
			modifier = {
				factor = 0.8
				107 = { 
					NOT = { has_province_modifier = completeharren3 } 
					NOT = { has_province_flag = pre_harren_harrenhal }
				}
				event_target:duelist_1 = { has_landed_title = c_harrenhal }
			}
			modifier = {
				factor = 0.8
				107 = { 
					NOT = { has_province_modifier = completeharren3 } 
					NOT = { has_province_flag = pre_harren_harrenhal }
				}
				c_harrenhal = {
					holder_scope = {
						OR = {
							any_child = { character = event_target:duelist_1 }
							any_child = { any_child = { character = event_target:duelist_1 } }
						}
					}
				}
			}
			modifier = {
				factor = 2
				event_target:duelist_1 = { has_character_modifier = demon_child_non_pagan }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { trait = dragon_dreams } # Can see into the future-ish
			}
			modifier = {
				factor = 5
				event_target:duelist_1 = { trait = white_walker } # Counteract age effect
			}
			modifier = {
				factor = 4
				event_target:duelist_1 = { trait = immortal } # Counteract age effect
			}
			modifier = {
				factor = 4
				event_target:duelist_1 = { trait = undead }
			}
			
			# Misc character modifiers
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { has_character_modifier = wolf_blood }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { has_character_modifier = lycanthropy }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { has_character_modifier = manly_skill_wrestling }
			}
			modifier = {
				factor = 4
				event_target:duelist_1 = { has_character_modifier = martially_ambidextrous }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { any_artifact = { artifact_type = prosthetic_hand_metal is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.5
				event_target:duelist_1 = { any_artifact = { artifact_type = prosthetic_leg_artifact is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { has_character_modifier = peg_leg }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { has_character_modifier = phantom_pain }
			}
			modifier = {
				factor = 0.5
				event_target:duelist_1 = { has_character_modifier = severe_illness }
			}
			modifier = {
				factor = 0.05
				event_target:duelist_1 = { has_character_modifier = bedridden_illness }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_1 = { any_artifact = { artifact_type = how_to_hold_a_sword is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_1 = { any_artifact = { artifact_type = a_soldiers_life is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { any_artifact = { artifact_type = my_fechtbuch is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { any_artifact = { artifact_type = the_sword_and_buckler is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_1 = { any_artifact = { artifact_type = lessons_taught_to_me_by_rival_2 is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { any_artifact = { artifact_type = lessons_taught_to_me_by_rival_3 is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.1
				event_target:duelist_1 = { any_artifact = { artifact_type = the_wisdom_of_the_heavens is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { any_artifact = { artifact_type = ordinary_beasts is_artifact_active = yes } }
			}
			modifier = {
				factor = 1.25
				event_target:duelist_1 = { any_artifact = { artifact_type = the_book_of_shadows is_artifact_active = yes } }
			}
		}	
		event_target:duelist_2 = {
			save_event_target_as = duel_round_loser
			clr_character_flag = duel_random_boost
		}
		event_target:duelist_1 = { 
			save_event_target_as = duel_round_winner
			clr_character_flag = duel_random_boost
			character_event = { id = duel.5 }
		}
	}
}

# Winner attacks!
character_event = {
	id = duel.5
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	show_from_from = yes
	
	#Default
	desc = {
		text = EVTDESCDUEL5
		trigger = { }
	}	
	desc = {
		text = EVTDESCDUEL5SKILL
		trigger = { 
			OR = {
				trait = skilled_warrior
				trait = master_warrior
			}
		}
	}	
	desc = {
		text = EVTDESCDUEL5SWORD
		trigger = { 
			any_artifact = { has_artifact_flag = valyrian_steel is_artifact_equipped = yes }
		}
	}	
	desc = {
		text = EVTDESCDUEL5STRONG
		trigger = { 
			is_strong_trigger = yes
			NOT = { has_character_flag = duel_tactic_speed }
		}
	}	
	desc = {
		text = EVTDESCDUEL5QUICK
		trigger = { 
			is_smart_incl_genius_trigger = yes	
			NOT = { has_character_flag = duel_tactic_force }
		}
	}	
	desc = {
		text = EVTDESCDUEL5WROTH
		trigger = { 
			trait = wroth	
			NOT = { has_character_flag = duel_tactic_defense }
		}
	}	
	desc = {
		text = EVTDESCDUEL5PATIENT
		trigger = { 
			trait = patient
			NOT = { has_character_flag = duel_tactic_force }
		}
	}	
	desc = {
		text = EVTDESCDUEL5DECEITFUL
		trigger = { 
			trait = deceitful
		}
	}	
	desc = {
		text = EVTDESCDUEL5TALL
		trigger = { 
			trait = tall
		}
	}	
	desc = {
		text = EVTDESCDUEL5RHLLOR
		trigger = { 
			OR = {
				trait = chosen_by_rhllor
				trait = favored_by_rhllor
			}	
		}
	}
	
	immediate = {
		if = { #find sword for loc
			limit = { ai = no }
			random_artifact = {
				limit = {
					has_artifact_flag = valyrian_steel
					is_artifact_equipped = yes
				}
				save_event_target_as = valyrian_steel_sword
			}
		}
	}
	
	option = {
		name = {
			text = "EVTOPTADUEL5"
			trigger = {
				NOR = {
					AND = {
						has_character_flag = duel_tactic_speed
						event_target:duel_round_loser = { has_character_flag = duel_tactic_force }
					}
					AND = {
						has_character_flag = duel_tactic_force
						event_target:duel_round_loser = { has_character_flag = duel_tactic_defense }
					}
					AND = {
						has_character_flag = duel_tactic_defense
						event_target:duel_round_loser = { has_character_flag = duel_tactic_speed }
					}
				}
			}
		}	
		name = {
			text = "EVTOPTADUEL5A" #Speed
			trigger = {
				AND = {
					has_character_flag = duel_tactic_speed
					event_target:duel_round_loser = { has_character_flag = duel_tactic_force }
				}
			}
		}	
		name = {
			text = "EVTOPTADUEL5B" #Force
			trigger = {
				AND = {
					has_character_flag = duel_tactic_force
					event_target:duel_round_loser = { has_character_flag = duel_tactic_defense }
				}
			}
		}	
		name = {
			text = "EVTOPTADUEL5C" #Defense
			trigger = {
				AND = {
					has_character_flag = duel_tactic_defense
					event_target:duel_round_loser = { has_character_flag = duel_tactic_speed }
				}
			}
		}	
		#Opponent is either FROMFROM or FROMFROMFROM
		event_target:duel_round_loser = {
			character_event = { id = duel.6 tooltip = "EVTTOOLTIPDUEL6" }
		}
	}
}

# Loser is attacked!
character_event = {
	id = duel.6
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"	
	
	is_triggered_only = yes
	
	#Default
	desc = {
		text = EVTDESCDUEL6
		trigger = {  }
	}	

	
	desc = {
		text = EVTDESCDUEL6SKILL
		trigger = { 
			FROM = {
				OR = {
					trait = skilled_warrior
					trait = master_warrior
				}
			}	
		}
	}	
	
	desc = {
		text = EVTDESCDUEL6SWORD
		trigger = { 
			FROM = {
				any_artifact = { has_artifact_flag = valyrian_steel is_artifact_equipped = yes }
			}	
		}
	}	
	
	desc = {
		text = EVTDESCDUEL6STRONG
		trigger = { 
			FROM = { 
				is_strong_trigger = yes 
				NOT = { has_character_flag = duel_tactic_speed }
			}
		}
	}	

	desc = {
		text = EVTDESCDUEL6QUICK
		trigger = { 
			FROM = { 
				is_smart_incl_genius_trigger = yes
				NOT = { has_character_flag = duel_tactic_force }
			}	
		}
	}	
	desc = {
		text = EVTDESCDUEL6WROTH
		trigger = {  
			FROM = { 
				trait = wroth 
				NOT = { has_character_flag = duel_tactic_defense }
			}			
		}
	}	

	desc = {
		text = EVTDESCDUEL6PATIENT
		trigger = { 
			FROM = { 
				trait = patient 
				NOT = { has_character_flag = duel_tactic_force }
			}
		}
	}	
	
	desc = {
		text = EVTDESCDUEL6DECEITFUL
		trigger = { 
			FROM = { trait = deceitful }
		}
	}	
	
	desc = {
		text = EVTDESCDUEL6TALL
		trigger = { 
			FROM = { trait = tall }
		}
	}	
	
	desc = {
		text = EVTDESCDUEL6RHLLOR
		trigger = { 
			FROM = { 
				OR = {
					trait = chosen_by_rhllor
					trait = favored_by_rhllor
				}	
			}	
		}
	}	
	
	immediate = {
		if = { #find sword for loc
			limit = { ai = no }
			FROM = {
				random_artifact = {
					limit = {
						has_artifact_flag = valyrian_steel
						is_artifact_equipped = yes
					}
					save_event_target_as = valyrian_steel_sword
				}
			}	
		}
	}
	
	option = {
		name = {
			text = "EVTOPTADUEL6"
			trigger = {
				NOR = {
					AND = {
						FROM = { has_character_flag = duel_tactic_speed }
						has_character_flag = duel_tactic_force
					}
					AND = {
						FROM = { has_character_flag = duel_tactic_force }
						has_character_flag = duel_tactic_defense
					}
					AND = {
						FROM = { has_character_flag = duel_tactic_defense }
						has_character_flag = duel_tactic_speed
					}
				}
			}
		}	
		name = {
			text = "EVTOPTADUEL6A" #Speed
			trigger = {
				AND = {
					FROM = { has_character_flag = duel_tactic_speed }
					has_character_flag = duel_tactic_force
				}
			}
		}	
		name = {
			text = "EVTOPTADUEL6B" #Force
			trigger = {
				AND = {
					FROM = { has_character_flag = duel_tactic_force }
					has_character_flag = duel_tactic_defense
				}
			}
		}	
		name = {
			text = "EVTOPTADUEL6C" #Defense
			trigger = {
				AND = {
					FROM = { has_character_flag = duel_tactic_defense }
					has_character_flag = duel_tactic_speed
				}
			}
		}	
		hidden_tooltip = { k_naga = { holder_scope = { character_event = { id = duel.7 } } } }
	}
}

# Determine attack outcome
character_event = {
	id = duel.7
	is_triggered_only = yes
	
	# Nobody but the actual referee should ever get this
	trigger = { has_landed_title = k_naga }
	
	option = { # Killing Blow
		name = KILL
		event_target:duel_round_winner = { character_event = { id = duel.201 } }
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.01
				event_target:duel_round_winner = { 
					has_character_flag = flag_duel_friendly 
					NOT = { has_character_flag = trial_by_seven_duel }
				}
			}
			modifier = {
				factor = 0.15
				event_target:duel_round_winner = { 
					has_character_flag = flag_duel_friendly 
					has_character_flag = trial_by_seven_duel
				}
			}
			modifier = {
				factor = 0.66
				event_target:duel_round_winner = { 
					OR = {
						has_character_flag = elected_champion
						has_character_flag = self_elected_champion
						has_character_flag = self_elected_champion_b
						has_character_flag = demmanded_trial_by_combat
						has_character_flag = champion_of_relative
					}
				}
			}
			
			modifier = {
				factor = 1.5
				event_target:duel_round_winner = { trait = cruel }
			}
			modifier = {
				factor = 1.25
				event_target:duel_round_winner = { trait = wroth }
			}
			modifier = {
				factor = 1.25
				event_target:duel_round_loser = { trait = brave }
			}
			modifier = {
				factor = 1.25
				event_target:duel_round_loser = { trait = stubborn }
			}
			modifier = {
				factor = 0.8
				event_target:duel_round_winner = { trait = patient }
			}
			modifier = {
				factor = 0.5
				event_target:duel_round_winner = { trait = kind }
			}
		}
	}
	
	option = { # Subdued Opponent
		name = SUBDUE
		trigger = { #Never use between AI in fight to the death (no point)
			OR = {
				event_target:duel_round_loser = { ai = no }
				event_target:duel_round_winner = { ai = no }
				event_target:duel_round_loser = { NOT = { has_character_flag = flag_duel_to_the_death } }
			}
		}
		event_target:duel_round_winner = { character_event = { id = duel.105 } }
		ai_chance = {
			factor = 100
			# Needs Opponent Taken Alive
			modifier = {
				factor = 10
				OR = {
					any_current_enemy = { character = event_target:duel_round_loser } # Enemy
					any_current_enemy = { any_close_relative = { character = event_target:duel_round_loser } } # Enemy's close relatives
					any_current_enemy = { current_heir = { character = event_target:duel_round_loser } } # Enemy's heir
				}
				NOR = {
					trait = lunatic
					trait = possessed
				}
				NOR = {
					trait = wroth
					trait = cruel
					trait = paranoid
				}
			}			
			
			# Personal Opinion Modifiers
			modifier = {
				factor = 1.25
				event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = 20 } }
			}
			modifier = {
				factor = 1.25
				event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = 40 } }
			}
			modifier = {
				factor = 1.25
				event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = 60 } }
			}
			modifier = {
				factor = 1.25
				event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = 80 } }
			}
			modifier = {
				factor = 1.25
				event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = 100 } }
			}
			modifier = {
				factor = 0.8
				NOT = { event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = -19 } } }
			}
			modifier = {
				factor = 0.8
				NOT = { event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = -39 } } }
			}
			modifier = {
				factor = 0.8
				NOT = { event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = -59 } } }
			}
			modifier = {
				factor = 0.8
				NOT = { event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = -79 } } }
			}
			modifier = {
				factor = 0.8
				NOT = { event_target:duel_round_winner = { opinion = { who = event_target:duel_round_loser value = -99 } } }
			}
			
			modifier = {
				factor = 3
				event_target:duel_round_winner = { trait = honorable }
			}
		}
	}
}

### YIELD OUTCOMES
character_event = {
	id = duel.105
	desc = "EVTDESCDUEL105"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	show_from_from = yes
	
	option = {
		name = "EVTOPTADUEL105"
		event_target:duel_round_loser = { character_event = { id = duel.106 tooltip = "EVTTOOLTIPDUEL106" } }
	}
}

character_event = {
	id = duel.106
	desc = "EVTDESCDUEL106"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = must_yield
		if = {
			limit = { 
				NOT = { has_character_flag = flag_duel_to_the_death } 
				NOT = { trait = white_walker }
			}
			random = {
				chance = 25
				# Duel Fatigue - adjust values if neccessary
				modifier = {
					factor = 1.5
					check_variable = { which = duel_rounds value = 2 }
				}
				modifier = {
					factor = 1.5
					check_variable = { which = duel_rounds value = 4 }
				}
				modifier = {
					factor = 1.5
					check_variable = { which = duel_rounds value = 6 }
				}
				set_character_flag = must_yield
			}
		}	
	}
	
	option = {
		trigger = {
			NOT = { has_character_flag = flag_duel_to_the_death }
			NOT = { trait = white_walker }
		}
		name = "EVTOPTADUEL106"
		clr_character_flag = must_yield
		event_target:duel_round_winner = { character_event = { id = duel.107 tooltip = "EVTTOOLTIPDUEL107" } }
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NAND = { 
					has_character_flag = flag_duel_friendly 
					NOT = { has_character_flag = trial_by_seven_duel }
				}
				NOT = { trait = wounded }
				NOT = { has_severe_disability_trigger = yes }
				NOT = { trait = craven }
				NOT = { event_target:duel_round_winner = { combat_rating_diff = { who = ROOT value = 2.64 } } }
			}
			modifier = {
				factor = 2
				has_character_flag = flag_duel_friendly
				NOT = { has_character_flag = trial_by_seven_duel }
			}
			modifier = {
				factor = 2
				event_target:duel_round_winner = { combat_rating_diff = { who = ROOT value = 2 } }
			}
			# Nearly Beaten!
			modifier = {
				factor = 4
				is_maimed_trigger = yes
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 2
				trait = wounded
				NOT = { trait = lunatic }
			}
			# Opponent Nearly Beaten!
			modifier = {
				factor = 0.25
				NOT = { is_maimed_trigger = yes }
				event_target:duel_round_winner = { is_maimed_trigger = yes }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 0.5
				NOT = { is_maimed_trigger = yes }
				NOT = { trait = wounded }
				event_target:duel_round_winner = { trait = wounded }
				NOT = { trait = lunatic }
			}
			# Personality Effects
			modifier = {
				factor = 5
				trait = craven
			}
			modifier = {
				factor = 2
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = brave
			}
			modifier = {
				factor = 0.5
				trait = stubborn
			}
			modifier = {
				factor = 0.75
				trait = proud
			}
			modifier = {
				factor = 0.33
				trait = wroth
			}
		}
	}
	
	option = {	
		trigger = {
			NOT = { has_character_flag = must_yield }
		}
		name = {
			text = "EVTOPTBDUEL106"
			trigger = {
				NOR = { 
					religion = drowned_god
					has_house_words_trigger = yes
				}
			}
		}	
		name = {
			text = "EVTOPTCDUEL106"
			trigger = {
				religion = drowned_god
			}
		}
		name = {
			text = "EVTOPTGETHOUSEWORDS"
			trigger = {
				has_house_words_trigger = yes
			}
		}
		character_event = { id = duel.110 tooltip = "EVTTOOLTIPDUEL110" }
		ai_chance = { factor = 100 }
	}
}

character_event = {
	id = duel.107
	desc = "EVTDESCDUEL107"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTADUEL107"
		set_character_flag = flag_spared_opponent
		event_target:duel_round_loser = { character_event = { id = duel.108 tooltip = "EVTTOOLTIPDUEL108" } }
		ai_chance = {
			factor = 100
			# Need Opponent Taken Alive
			modifier = {
				factor = 10
				any_current_enemy = { character = event_target:duel_round_loser }
				NOR = {
					trait = lunatic
					trait = possessed
				}
				NOR = {
					trait = wroth
					trait = cruel
					trait = paranoid
				}
			}
			# Nearly Beaten!
			modifier = {
				factor = 4
				is_maimed_trigger = yes
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 2
				trait = wounded
				NOT = { trait = lunatic }
			}
			# Opponent Nearly Beaten!
			modifier = {
				factor = 0.25
				event_target:duel_round_loser = { is_maimed_trigger = yes }
				NOT = { trait = lunatic }
				NOT = { has_character_flag = flag_duel_friendly }
			}
			modifier = {
				factor = 0.5
				event_target:duel_round_loser = { trait = wounded }
				NOT = { trait = lunatic }
				NOT = { has_character_flag = flag_duel_friendly }
			}
			# Personal Opinion Modifiers
			modifier = {
				factor = 1.25
				opinion = { who = event_target:duel_round_loser value = 20 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = event_target:duel_round_loser value = -19 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = event_target:duel_round_loser value = -39 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = event_target:duel_round_loser value = -59 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = event_target:duel_round_loser value = -79 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = event_target:duel_round_loser value = -99 } }
			}
			
			# Would Be Kinslaying
			modifier = {
				factor = 10
				OR = {
					dynasty = event_target:duel_round_loser
					is_close_relative = event_target:duel_round_loser
				}	
				NOT = { trait = arbitrary }
			}
			modifier = {
				factor = 20
				OR = {
					dynasty = event_target:duel_round_loser
					is_close_relative = event_target:duel_round_loser
				}
				trait = just
			}
			
			# Personality Modifiers
			modifier = {
				factor = 10
				trait = honorable
			}
			modifier = {
				factor = 10
				trait = honest
			}
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 3
				trait = just
			}
			modifier = {
				factor = 2
				trait = gregarious
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = trusting
			}
			modifier = {
				factor = 0.8
				trait = paranoid
			}
			modifier = {
				factor = 0.8
				trait = proud
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = ruthless
			}
			modifier = {
				factor = 0.5
				trait = deceitful
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}
			modifier = {
				factor = 0.5
				trait = arbitrary
			}
			modifier = {
				factor = 1000
				has_character_flag = flag_duel_friendly
				trait = wikid
			}
			modifier = {
				factor = 10
				has_character_flag = flag_duel_friendly
				NOT = { has_character_flag = trial_by_seven_duel }
				NOT = {
					OR = {
						trait = lunatic
						trait = possessed
						trait = cruel
						trait = wroth
					}
				}
			}
			modifier = {
				factor = 5
				has_character_flag = flag_duel_friendly
				NOT = { has_character_flag = trial_by_seven_duel }
			}
		}
	}
	
	option = {		
		name = {
			text = "EVTOPTBDUEL107"
			trigger = {
				NOT = { dynasty = 190 }
			}
		}
		name = {
			text = "EVTOPTCDUEL107"
			trigger = {
				dynasty = 190
			}
		}	
		name = {
			text = "EVTOPTBDUEL107B"
			trigger = {
				NOT = { opinion = { who = event_target:duel_round_loser value = -33 } }
			}
		}
		ai_chance = { 
			factor = 100 
			modifier = {
				factor = 0
				opinion = { who = event_target:duel_round_loser value = 40 }
				NOT = { trait = lunatic }
			}
			# Friendly Duels, must have motive to be dishonorable
			modifier = {
				factor = 0
				has_character_flag = flag_duel_friendly
				NOT = {
					OR = {
						#has ongoing murder plot
						AND = {
							OR = {
								has_plot = plot_kill_character
								has_plot = plot_kill_spouse
							}
							plot_target_char = { character = event_target:duel_round_loser }
						}
						AND = {
							any_backed_character = {
								OR = {
									has_plot = plot_kill_character
									has_plot = plot_kill_spouse
								}
								plot_target_char = { character = event_target:duel_round_loser }
							}
						}
						# Titles
						OR = {
							any_pretender_title = { # Get rid of the current ruler or heir if I'm a pretender
								OR = {
									current_heir = { character = event_target:duel_round_loser }
									holder_scope = { character = event_target:duel_round_loser }
								}
							}
							any_heir_title = { # Kill a ruler if I'm the heir
								holder_scope = { character = event_target:duel_round_loser }
								NOT = { has_law = succ_appointment }
							}
						}	

						# Family concerns
						any_child = { # Gets rid of obstacles in the way of a child's succession
							OR = {
								any_pretender_title = {
									current_heir = { character = event_target:duel_round_loser }
								}
								any_heir_title = {
									holder_scope = { character = event_target:duel_round_loser }
								}
							}
						}
						any_spouse = {	# Get rid of the current heir to a title the character's spouse is a pretender to
							any_pretender_title = {
								current_heir = { character = event_target:duel_round_loser }
							}
						}
						any_spouse = { # Get rid of a ruler the spouse is heir to
							any_heir_title = {
								holder_scope = { character = event_target:duel_round_loser }
							}
						}
						
						# A lover of spouse...
						any_spouse = { is_lover = event_target:duel_round_loser }	
						
						# Rivals/enemies
						is_foe = event_target:duel_round_loser
						event_target:duel_round_loser = { has_opinion_modifier = { who = ROOT modifier = opinion_claimant_adventure_target } }
						
						# Go nuts...
						trait = lunatic
						trait = possessed					
					}
				}
			}
		}		
		set_character_flag = flag_killed_opponent
		custom_tooltip = { text = EVTTOOLTIPDUEL109 }
		
		if = {
			limit = { has_character_flag = flag_duel_friendly }
			if = {
				limit = {
					has_nickname = no
					OR = {
						trait = dishonorable1
						trait = dishonorable2
						trait = dishonorable3
						trait = dishonorable4
						trait = dishonorable5
						trait = dishonorable6
						trait = dishonorable7
						trait = dishonorable8
						trait = dishonorable9
						trait = dishonorable10
					}
				}
				give_nickname = nick_the_ruthless
			}
			change_variable = { which = "dishonorable" value = 10 } 
			hidden_tooltip = { character_event = { id = maintenance.3 } } #dishonour trait
			
			event_target:duel_round_loser = { save_event_target_as = kinslayer_target } #check for kinslayer
			add_kinslayer_trait_effect = yes		
		}
		event_target:duel_round_loser = {
			#Wolfgang Pauli's vengeance CB modifiers knuckey: changed to something less drastic
			father = {
				if = {
					limit = {
						is_alive = yes			
					}
					opinion = {
						who = ROOT
						modifier = opinion_slayed_kinsman
					}
				}	
			}
			mother = {
				if = {
					limit = {
						is_alive = yes			
					}
					opinion = {
						who = ROOT
						modifier = opinion_slayed_kinsman
					}
				}	
			}
			any_child = {
				limit = {
					is_alive = yes
					OR = {
						NOT = { is_close_relative = ROOT }
						opinion = { who = PREV value = 50 }
					}			
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			any_spouse = {
				limit = { 
					opinion = { who = PREV value = -25 } 
					OR = {
						NOT = { is_close_relative = ROOT }
						opinion = { who = PREV value = 50 }
					}
					NOT = { is_child_of = PREV }
					NOT = { any_child = { character = PREVPREV } }
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			any_dynasty_member = {
				limit = {
					is_alive = yes
					is_close_relative = PREV
					OR = {
						NOT = { is_close_relative = ROOT }
						opinion = { who = PREV value = 50 }
					}	
					NOT = { is_child_of = PREV }
					NOT = { any_child = { character = PREVPREV } }
					NOT = { is_married = PREV }				
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			
			any_friend = {
				limit = { 
					NOT = { is_married = PREV }	
					OR = {
						NOT = { dynasty = PREV }
						NOT = { is_close_relative = PREV }
					}
					NOT = { is_child_of = PREV }
					NOT = { any_child = { character = PREVPREV } }
					NOT = { is_married = PREV }	
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			hidden_tooltip = { character_event = { id = duel.109 tooltip = "EVTTOOLTIPDUEL109" } }
		}
	}
}

character_event = {
	id = duel.108
	desc = "EVTDESCDUEL108"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { #these apply own prestige after
				has_character_flag = in_melee
			}
			break = yes
		}	
		if = {
			limit = {
				OR = {
					tier = EMPEROR
					AND = {
						trait = master_warrior
						FROM = {
							NOT = { trait = master_warrior }
							NOT = { trait = skilled_warrior }
							NOT = { trait = trained_warrior }
							NOT = { trait = poor_warrior }
						}
					}	
				}
			}
			if = {
				limit = { has_character_flag = flag_duel_friendly }
				set_character_flag = prestige_40
				break = yes
			}	
			set_character_flag = prestige_200
			break = yes
		}
		if = {
			limit = {
				OR = {
					tier = KING
					trait = kingsguard
					AND = {
						trait = master_warrior
						FROM = { trait = poor_warrior }
					}
					AND = {
						trait = skilled_warrior
						FROM = { 
							NOT = { trait = master_warrior }
							NOT = { trait = skilled_warrior }
							NOT = { trait = trained_warrior }
							NOT = { trait = poor_warrior }
						}
					}					
				}
			}
			if = {
				limit = { has_character_flag = flag_duel_friendly }
				set_character_flag = prestige_25
				break = yes
			}	
			set_character_flag = prestige_100
			break = yes
		}
		if = {
			limit = {
				OR = {
					tier = DUKE
					AND = {
						trait = master_warrior
						FROM = { trait = trained_warrior }
					}
					AND = {
						trait = skilled_warrior
						FROM = { trait = poor_warrior }
					}	
					AND = {
						trait = trained_warrior
						FROM = { 
							NOT = { trait = master_warrior }
							NOT = { trait = skilled_warrior }
							NOT = { trait = trained_warrior }
							NOT = { trait = poor_warrior }
						}
					}					
				}
			}
			if = {
				limit = { has_character_flag = flag_duel_friendly }
				set_character_flag = prestige_15
				break = yes
			}	
			set_character_flag = prestige_50
			break = yes
		}
		if = {
			limit = {
				OR = {
					tier = COUNT
					AND = {
						trait = master_warrior
						FROM = { trait = skilled_warrior }
					}
					AND = {
						trait = skilled_warrior
						FROM = { trait = trained_warrior }
					}	
					AND = {
						trait = trained_warrior
						FROM = { trait = poor_warrior }
					}
					AND = {
						trait = poor_warrior
						FROM = { 
							NOT = { trait = master_warrior }
							NOT = { trait = skilled_warrior }
							NOT = { trait = trained_warrior }
							NOT = { trait = poor_warrior }
						}
					}					
				}
			}
			if = {
				limit = { has_character_flag = flag_duel_friendly }
				set_character_flag = prestige_10
				break = yes
			}	
			set_character_flag = prestige_25
			break = yes
		}
		set_character_flag = prestige_10
	}
	
	option = {
		name = "EVTOPTADUEL108"
		if = {
			limit = {
				has_character_flag = prestige_200
			}
			prestige = -200
			clr_character_flag = prestige_200
		}
		if = {
			limit = {
				has_character_flag = prestige_100
			}
			prestige = -100
			clr_character_flag = prestige_100
		}
		if = {
			limit = {
				has_character_flag = prestige_50
			}
			prestige = -50
			clr_character_flag = prestige_50
		}	
		if = {
			limit = {
				has_character_flag = prestige_40
			}
			prestige = -40
			clr_character_flag = prestige_40
		}	
		if = {
			limit = {
				has_character_flag = prestige_25
			}
			prestige = -25
			clr_character_flag = prestige_25
		}	
		if = {
			limit = {
				has_character_flag = prestige_15
			}
			prestige = -15
			clr_character_flag = prestige_15
		}
		if = {
			limit = {
				has_character_flag = prestige_10
			}
			prestige = -10
			clr_character_flag = prestige_10
		}
		event_target:duel_round_winner = { character_event = { id = duel_output.1 tooltip = "EVTTOOLTIPDUELOUTPUT1" } }
	}
}

#Inform liege enemy captured after duel
character_event = {
	id = duel.10700
	desc = "EVTDESCDUEL10700"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = OK
		tooltip = { FROMFROM = { imprison = ROOT } }
	}
}

character_event = {
	id = duel.109
	desc = "EVTDESCDUEL109"
	picture = GFX_evt_death
	
	is_triggered_only = yes
	
	immediate = {
		#Check if Rhllor saves character
		if = {
			limit = { 
				religion = rhllor 
				OR = {
					trait = resurrected_by_rhllor
					AND = {
						OR = { 	
							trait = favored_by_rhllor
							trait = chosen_by_rhllor				
						}
						OR = {
							check_variable = { which = "red_god_magic" value = 10 }
							magic_returned_trigger = yes
						}
					}
				}	
			}
			random = {
				chance = 10
				modifier = {
					factor = 2
					trait = resurrected_by_rhllor
				}
				modifier = {
					factor = 2
					trait = chosen_by_rhllor
				}
				modifier = {
					factor = 2
					magic_returned_trigger = yes
				}
				modifier = {
					factor = 1.33
					check_variable = { which = "red_god_magic" value = 1 }
				}
				modifier = {
					factor = 1.5
					check_variable = { which = "red_god_magic" value = 5 }
				}
				set_character_flag = rhllor_resurrected
			}
		}
	}
	
	option = {
		name = "EVTOPTADUEL109"
		trigger = { NOT = { has_character_flag = rhllor_resurrected } }
		if = {
			limit = { has_character_flag = reaving_sword_fight_target }
			set_character_flag = do_not_inherit_sword
		}
		tooltip = {
			death = {
				death_reason = death_duel
				killer = event_target:duel_round_winner
			}
		}	
		hidden_tooltip = {
			if = {
				limit = { 
					has_character_flag = trial_by_seven_duel
				}
				death = {
					death_reason = death_duel_trial_by_seven
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = flag_battlefield_duel
						event_target:duel_round_winner = { has_character_flag = bloodrider_revenge_duel }
						has_character_flag = clansmen_hunt_duel
						has_character_flag = wikid_player_vs_pirate
						has_character_flag = wikid_pirate_vs_player	
						has_character_flag = wikid_pirate_vs_companion
						has_character_flag = wikid_companion_vs_pirate
						has_character_flag = reaving_sword_fight_target
					}	
				}
				death = {
					death_reason = death_duel_battle
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = elected_champion
						has_character_flag = self_elected_champion
						has_character_flag = self_elected_champion_b
						has_character_flag = demmanded_trial_by_combat
						has_character_flag = champion_of_relative
					}
				}
				death = {
					death_reason = death_duel_trial_by_combat
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = reaving_duel
						has_character_flag = reaving_sword_fight
						has_character_flag = clansmen_hunt_duel_target
						has_character_flag = stealing_spearwife
					}	
				}
				death = {
					death_reason = death_battle_raiding
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = wikid_betrayal_companion
						has_character_flag = wikid_betrayal_player
						has_character_flag = tourney_duel_challenger
						has_character_flag = tourney_duel_target
						has_character_flag = WOL_focus_duel
						has_character_flag = wol_lover_duel_accuser
						has_character_flag = wol_lover_duel_lover
						has_character_flag = friends_rivals_duel
						has_character_flag = laughing_storm_duel
					}	
				}
				death = {
					death_reason = death_duel_honour
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			
			if = {
				limit = { 
					OR = {
						has_character_flag = duelist_regent
						has_character_flag = duelist_courtier
					}	
				}
				death = {
					death_reason = death_duel_regency
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = rogue_kg_vs_KG
						has_character_flag = rogue_kg_vs_KING
					}	
				}
				death = {
					death_reason = death_duel_rogue_kg
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = KG_vs_rogue_kg
						has_character_flag = KING_vs_rogue_kg
					}	
				}
				death = {
					death_reason = death_duel_vs_rogue_kg
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					has_character_flag = kingsmoot_duel
				}
				death = {
					death_reason = death_duel_kingsmoot
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					has_character_flag = bloodrider_revenge_duel
				}
				death = {
					death_reason = death_battle_bloodrider
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					has_character_flag = in_melee
				}
				death = {
					death_reason = death_duel_melee
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			death = {
				death_reason = death_duel
				killer = event_target:duel_round_winner
			}
		}		
		event_target:duel_round_winner = { 
			custom_tooltip = {
				text = "EVTTOOLTIPDUELOUTPUT1"
			}
		}		
	}
	
	option = {
		name = "EVTOPTBred_priest.10"
		trigger = {
			has_character_flag = rhllor_resurrected
		}
		character_event = { id = red_priest.38 tooltip = CUSTOMTOOLTIPrhllor_saved_me }
		clr_character_flag = rhllor_resurrected
		
		event_target:duel_round_winner = { 
			custom_tooltip = {
				text = "EVTTOOLTIPDUELOUTPUT1"
				hidden_tooltip = { 
					event_target:duel_round_winner = { character_event = { id = duel.204 days = 1 } } 
				}
			}
		}
	}	
	after = {
		hidden_tooltip = {
			event_target:duel_round_winner = { 
				character_event = { id = duel_output.1 tooltip = "EVTTOOLTIPDUELOUTPUT1" }
				character_event = { id = duel.203 } 
			}				
		}
	}
}

character_event = {
	id = duel.110
	desc = "EVTDESCDUEL110"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTADUEL110"
		if = {
			limit = { trait = wounded }			
			random = {
				chance = 50
				modifier = {
					factor = 0.2
					has_character_flag = flag_duel_friendly
					NOT = { has_character_flag = trial_by_seven_duel }
				}
				hidden_tooltip = { remove_trait = wounded }
				add_maimed_trait_effect = yes
			}	
		}
		if = {
			limit = { 
				NOT = { trait = wounded } 
				NOT = { is_maimed_trigger = yes }
			}
			random = {
				chance = 50
				modifier = {
					factor = 0.5
					has_character_flag = flag_duel_friendly
					NOT = { has_character_flag = trial_by_seven_duel }
				}
				add_trait = wounded
			}	
		}
		#All wounds/maims could be eyeloss
		if = {
			limit = { 
				NOT = { has_character_flag = eye_injury  } 
			}
			random = {
				chance = 1
				modifier = {
					factor = 0.5
					has_character_flag = flag_duel_friendly
					NOT = { has_character_flag = trial_by_seven_duel }
				}
				add_trait = one_eyed	
			}
		}	
		event_target:duel_round_winner = { character_event = { id = duel.111 tooltip = "EVTTOOLTIPDUEL111" } }
	}
}

character_event = {
	id = duel.111
	desc = "EVTDESCDUEL111"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTADUEL111"
			trigger = { NOT = { has_character_flag = flag_duel_friendly } }
		}	
		name = {
			text = "EVTOPTADUEL111B"
			trigger = { has_character_flag = flag_duel_friendly }
		}
		hidden_tooltip = { k_naga = { holder_scope = { character_event = { id = duel.1 } } } }
	}
}

### DEATH OUTCOMES
character_event = {
	id = duel.201
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	show_from_from = yes
	
	desc = {
		text = EVTDESCDUEL201
		trigger = { 
			NAND = { 
				has_character_flag = flag_duel_friendly 
				NOT = { has_character_flag = trial_by_seven_duel }
			} 
		}
	}
	
	desc = {
		text = EVTDESCDUEL201B
		trigger = { 
			has_character_flag = flag_duel_friendly 
			NOT = { has_character_flag = trial_by_seven_duel }
		}
	}
	
	immediate = {
		if = {
			limit = {
				has_nickname = no
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						is_female = no
						is_feudal_monarch_trigger = yes
						NOT = { culture = dothraki }
						NOT = { culture = jogos_nhai }
						NOT = { culture_group = hyrkoon_group }
						NOT = { culture_group = yi_ti_group }
						NOT = { culture = qartheen }
						NOT = { #Not eastern emperors
							AND = {
								tier = EMPEROR
								NOT = {
									OR = {
										culture_group = andal
										culture_group = dornish
										culture_group = first_men
										culture_group = free_folk
										culture = summer_islander
										primary_title = {
											OR = {
												capital_scope = { region = world_westeros }
												title = e_iron_isles #These titles dont have capitals
												title = e_riverlands
												title = e_iron_throne
											}
										}
									}
								}	
							}			
						}						
					}	
					lower_tier_than = KING
				}
				random = {
					chance = 50
					set_character_flag = nick_the_kingslayer
					break = yes
				}
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						dynasty = 190
						OR = {
							trait = master_warrior
							higher_tier_than = DUKE
						}
					}	
					NOT = { dynasty = 190 }
				}
				random = {
					chance = 25
					set_character_flag = nick_the_lionslayer
					break = yes
				}
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						dynasty = 496
						OR = {
							trait = master_warrior
							higher_tier_than = DUKE
						}
					}	
					NOT = { dynasty = 496 }
				}
				random = {
					chance = 25
					FROM = { set_character_flag = nick_the_dragonslayer }
					break = yes
				}
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						dynasty = 59
						OR = {
							trait = master_warrior
							higher_tier_than = DUKE
						}
					}	
					NOT = { dynasty = 59 }
				}
				random = {
					chance = 25
					FROM = { set_character_flag = nick_wolfsbane }
					break = yes
				}
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						dynasty = 107
						OR = {
							trait = master_warrior
							higher_tier_than = DUKE
						}
					}	
					NOT = { dynasty = 107 }
				}
				random = {
					chance = 25
					FROM = { set_character_flag = nick_the_krakenslayer }
					break = yes
				}
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						trait = giant
					}	
					NOT = { trait = giant }
				}
				random = {
					chance = 50
					FROM = { set_character_flag = nick_the_giantsslayer }
					break = yes
				}
			}
			if = {
				limit = {
					culture_group = dornish
					intrigue = 14
					trait = deceitful
					NOT = { trait = honorable }
					OR = {
						trait = skilled_warrior
						trait = master_warrior
					}
				}
				random = {
					chance = 2
					FROM = { set_character_flag = nick_the_viper }
					break = yes
				}
			}
		}
	}
	
	option = {
		name = {
			text = "EVTOPTADUEL201"
			trigger = {
				NOT = { has_house_words_trigger = yes }
				NAND = { 
					has_character_flag = flag_duel_friendly 
					NOT = { has_character_flag = trial_by_seven_duel }
				}
			}
		}	
		name = {
			text = "EVTOPTGETHOUSEWORDS"
			trigger = {
				has_house_words_trigger = yes
				NAND = { 
					has_character_flag = flag_duel_friendly 
					NOT = { has_character_flag = trial_by_seven_duel }
				}
			}
		}
		name = {
			text = "EVTOPTADUEL201B"
			trigger = {
				has_character_flag = flag_duel_friendly
				NOT = { has_character_flag = trial_by_seven_duel }
			}
		}	
		if = {
			limit = {
				has_character_flag = nick_the_kingslayer
			}
			give_nickname = nick_the_kingslayer
			clr_character_flag = nick_the_kingslayer
		}
		if = {
			limit = {
				 has_character_flag = nick_the_lionslayer
			}
			give_nickname = nick_the_lionslayer
			clr_character_flag = nick_the_lionslayer
		}
		if = {
			limit = {
				 has_character_flag = nick_the_dragonslayer
			}
			give_nickname = nick_the_dragonslayer
			clr_character_flag = nick_the_dragonslayer
		}
		if = {
			limit = {
				 has_character_flag = nick_wolfsbane
			}
			give_nickname = nick_wolfsbane
			clr_character_flag = nick_wolfsbane
		}
		if = {
			limit = {
				 has_character_flag = nick_the_krakenslayer
			}
			give_nickname = nick_the_krakenslayer
			clr_character_flag = nick_the_krakenslayer
		}
		if = {
			limit = {
				 has_character_flag = nick_the_giantsslayer
			}
			give_nickname = nick_the_giantsslayer
			clr_character_flag = nick_the_giantsslayer
		}
		if = {
			limit = {
				 has_character_flag = nick_the_viper
			}
			give_nickname = nick_the_viper
			clr_character_flag = nick_the_viper
		}
		event_target:duel_round_loser = { 
			custom_tooltip = { text = EVTTOOLTIPDUEL202 }
			#Wolfgang Pauli's vengeance CB modifiers knuckey: changed to something less drastic
			if = {
				limit = {
					is_blood_relative_of_root_trigger = yes
					ROOT = { 
						is_any_kinslayer_trigger = no 
						NOT = { trait = suspected_kinslayer }
					}					
				}
				ROOT = { add_trait = suspected_kinslayer }
			}
			father = {
				if = {
					limit = {
						is_alive = yes			
					}
					opinion = {
						who = ROOT
						modifier = opinion_slayed_kinsman
					}
				}	
			}
			mother = {
				if = {
					limit = {
						is_alive = yes			
					}
					opinion = {
						who = ROOT
						modifier = opinion_slayed_kinsman
					}
				}	
			}
			any_child = {
				limit = {
					is_alive = yes
					OR = {
						NOT = { is_close_relative = ROOT }
						opinion = { who = PREV value = 50 }
					}			
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			any_spouse = {
				limit = { 
					opinion = { who = PREV value = -25 } 
					OR = {
						NOT = { is_close_relative = ROOT }
						opinion = { who = PREV value = 50 }
					}
					NOT = { is_child_of = PREV }
					NOT = { any_child = { character = PREVPREV } }
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			any_dynasty_member = {
				limit = {
					is_alive = yes
					is_close_relative = PREV
					OR = {
						NOT = { is_close_relative = ROOT }
						opinion = { who = PREV value = 50 }
					}	
					NOT = { is_child_of = PREV }
					NOT = { any_child = { character = PREVPREV } }
					NOT = { is_married = PREV }				
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			
			any_friend = {
				limit = { 
					NOT = { is_married = PREV }	
					OR = {
						NOT = { dynasty = PREV }
						NOT = { is_close_relative = PREV }
					}
					NOT = { is_child_of = PREV }
					NOT = { any_child = { character = PREVPREV } }
					NOT = { is_married = PREV }	
				}
				opinion = {
					who = ROOT
					modifier = opinion_slayed_kinsman
				}
			}
			hidden_tooltip = { character_event = { id = duel.202 tooltip = "EVTTOOLTIPDUEL202" } } 
		}
	}
}

character_event = {
	id = duel.202
	picture = GFX_evt_death
	
	is_triggered_only = yes
	
	desc = {
		text = EVTDESCDUEL202
		trigger = { 
			NAND = { 
				has_character_flag = flag_duel_friendly 
				NOT = { has_character_flag = trial_by_seven_duel }
			}
		}
	}
	desc = {
		text = EVTDESCDUEL202B
		trigger = { 
			has_character_flag = flag_duel_friendly 
			NOT = { has_character_flag = trial_by_seven_duel }
		}
	}
	
	immediate = {
		#Check if Rhllor saves character
		if = {
			limit = { 
				religion = rhllor 
				OR = {
					trait = resurrected_by_rhllor
					AND = {
						OR = { 	
							trait = favored_by_rhllor
							trait = chosen_by_rhllor				
						}
						OR = {
							check_variable = { which = "red_god_magic" value = 10 }
							magic_returned_trigger = yes
						}
					}
				}	
			}
			random = {
				chance = 10
				modifier = {
					factor = 2
					trait = resurrected_by_rhllor
				}
				modifier = {
					factor = 2
					trait = chosen_by_rhllor
				}
				modifier = {
					factor = 2
					magic_returned_trigger = yes
				}
				modifier = {
					factor = 1.33
					check_variable = { which = "red_god_magic" value = 1 }
				}
				modifier = {
					factor = 1.5
					check_variable = { which = "red_god_magic" value = 5 }
				}
				set_character_flag = rhllor_resurrected
			}
		}
	}
	
	option = {
		trigger = { NOT = { has_character_flag = rhllor_resurrected } }
		name = {
			text = "EVTOPTADUEL202"
			trigger = {
				NAND = { 
					has_character_flag = flag_duel_friendly 
					NOT = { has_character_flag = trial_by_seven_duel }
				}
			}
		}
		name = {
			text = "EVTOPTADUEL202B"
			trigger = {
				has_character_flag = flag_duel_friendly 
				NOT = { has_character_flag = trial_by_seven_duel }
			}
		}
		if = {
			limit = { has_character_flag = reaving_sword_fight_target }
			set_character_flag = do_not_inherit_sword
		}
		tooltip = {
			death = {
				death_reason = death_duel
				killer = event_target:duel_round_winner
			}
		}	
		hidden_tooltip = {
			if = {
				limit = { 
					has_character_flag = trial_by_seven_duel
				}
				death = {
					death_reason = death_duel_trial_by_seven
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = flag_battlefield_duel
						event_target:duel_round_winner = { has_character_flag = bloodrider_revenge_duel }
						has_character_flag = clansmen_hunt_duel
						has_character_flag = wikid_player_vs_pirate
						has_character_flag = wikid_pirate_vs_player	
						has_character_flag = wikid_pirate_vs_companion
						has_character_flag = wikid_companion_vs_pirate
						has_character_flag = reaving_sword_fight_target
					}	
				}
				death = {
					death_reason = death_duel_battle
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = elected_champion
						has_character_flag = self_elected_champion
						has_character_flag = self_elected_champion_b
						has_character_flag = demmanded_trial_by_combat
						has_character_flag = champion_of_relative
					}
				}
				death = {
					death_reason = death_duel_trial_by_combat
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = reaving_duel
						has_character_flag = reaving_sword_fight
						has_character_flag = clansmen_hunt_duel_target
						has_character_flag = stealing_spearwife
					}	
				}
				death = {
					death_reason = death_battle_raiding
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = wikid_betrayal_companion
						has_character_flag = wikid_betrayal_player
						has_character_flag = tourney_duel_challenger
						has_character_flag = tourney_duel_target
						has_character_flag = WOL_focus_duel
						has_character_flag = wol_lover_duel_accuser
						has_character_flag = wol_lover_duel_lover
						has_character_flag = friends_rivals_duel
						has_character_flag = laughing_storm_duel
					}	
				}
				death = {
					death_reason = death_duel_honour
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			
			if = {
				limit = { 
					OR = {
						has_character_flag = duelist_regent
						has_character_flag = duelist_courtier
					}	
				}
				death = {
					death_reason = death_duel_regency
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = rogue_kg_vs_KG
						has_character_flag = rogue_kg_vs_KING
					}	
				}
				death = {
					death_reason = death_duel_rogue_kg
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					OR = {
						has_character_flag = KG_vs_rogue_kg
						has_character_flag = KING_vs_rogue_kg
					}	
				}
				death = {
					death_reason = death_duel_vs_rogue_kg
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					has_character_flag = kingsmoot_duel
				}
				death = {
					death_reason = death_duel_kingsmoot
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					has_character_flag = bloodrider_revenge_duel
				}
				death = {
					death_reason = death_battle_bloodrider
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			if = {
				limit = { 
					has_character_flag = in_melee
				}
				death = {
					death_reason = death_duel_melee
					killer = event_target:duel_round_winner
				}
				break = yes
			}
			death = {
				death_reason = death_duel
				killer = event_target:duel_round_winner
			}
		}		
		event_target:duel_round_winner = { 
			custom_tooltip = {
				text = "EVTTOOLTIPDUELOUTPUT1"
			}
		}	
	}
	
	option = {
		name = "EVTOPTBred_priest.10"
		trigger = {
			has_character_flag = rhllor_resurrected
		}
		character_event = { id = red_priest.38 tooltip = CUSTOMTOOLTIPrhllor_saved_me }
		clr_character_flag = rhllor_resurrected
		
		event_target:duel_round_winner = { 
			custom_tooltip = {
				text = "EVTTOOLTIPDUELOUTPUT1"
				hidden_tooltip = { 
					event_target:duel_round_winner = { character_event = { id = duel.204 days = 1 } } 
				}
			}
		}		
	}
	
	after = {
		hidden_tooltip = {
			event_target:duel_round_winner = { 
				character_event = { id = duel_output.1 tooltip = "EVTTOOLTIPDUELOUTPUT1" }
				character_event = { id = duel.203 } 
			}				
		}
	}
}

character_event = {
	id = duel.203
	desc = "EVTDESCDUEL203"
	picture = GFX_evt_lord_dead
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	immediate = {
		#If beat important character, prevent culling
		if = {
			limit = {
				is_ruler = no
				is_married = no
				NOT = { num_of_children = 1 }
				NOT = { father_even_if_dead = { always = yes } } 
				NOT = { mother_even_if_dead = { always = yes } }
				OR = {
					trait = skilled_warrior
					trait = master_warrior
					combat_rating = 6
					prestige = 300
				}
				event_target:duel_round_loser = {
					OR = {
						trait = master_warrior
						trait = skilled_warrior
						higher_tier_than = COUNT
					}
				}
			}
			if = {
				limit = { NOT = { age = 20 } }
				create_character = {
					random_traits = yes
					dynasty = NONE
					female = no
					age = 36
					culture = ROOT
					religion = ROOT
				}
				new_character = {
					ROOT = { set_father = PREV }
					death = yes
				}
			}
			if = {
				limit = { 
					age = 20
					NOT = { age = 35 } 
				}
				create_character = {
					random_traits = yes
					dynasty = NONE
					female = no
					age = 51
					culture = ROOT
					religion = ROOT
				}
				new_character = {
					ROOT = { set_father = PREV }
					death = yes
				}
			}
			if = {
				limit = { age = 35 }
				create_character = {
					random_traits = yes
					dynasty = NONE
					female = no
					age = 66
					culture = ROOT
					religion = ROOT
				}
				new_character = {
					ROOT = { set_father = PREV }
					death = yes
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTADUEL203"
		if = {
			limit = {
				NOT = { has_character_flag = in_melee }
				NOT = { has_character_flag = WOL_focus_duel }
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						OR = {
							tier = EMPEROR
							trait = master_warrior				
						}
					}
				}
				prestige = 150
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						NOT = { tier = EMPEROR }
						NOT = { trait = master_warrior }
						OR = {
							tier = KING
							trait = skilled_warrior
							trait = kingsguard
						}
					}
				}
				prestige = 75
			}
			if = {
				limit = {
					event_target:duel_round_loser = {
						NOT = { trait = kingsguard }
						NOT = { higher_tier_than = DUKE }
						NOT = { trait = master_warrior }
						NOT = { trait = skilled_warrior }
						OR = {
							tier = DUKE
							trait = trained_warrior
						}
					}
				}
				prestige = 35
			}	
			if = {
				limit = {
					event_target:duel_round_loser = {
						NOT = { trait = kingsguard }
						NOT = { higher_tier_than = COUNT }
						NOT = { trait = master_warrior }
						NOT = { trait = skilled_warrior }
						NOT = { trait = trained_warrior }
						OR = {
							tier = COUNT
							trait = poor_warrior
						}
					}
				}
				prestige = 15
			}	
			if = {
				limit = {
					event_target:duel_round_loser = {
						NOT = { trait = kingsguard }
						NOT = { higher_tier_than = BARON }
						NOT = { trait = master_warrior }
						NOT = { trait = skilled_warrior }
						NOT = { trait = trained_warrior }
						NOT = { trait = poor_warrior }
					}
				}
				prestige = 5
			}	
		}	
	}
}
#Inform opponnent of rhllor protection
character_event = {
	id = duel.204
	desc = "EVTDESCDUEL204"
	picture = GFX_evt_duel
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTADUEL204
	}
}