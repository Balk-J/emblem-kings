namespace = startup

character_event = {
	id = startup.1
	#desc = "startup.1.desc"
	
	is_triggered_only = yes #Triggered from on_startup
	only_rulers = yes
	
	trigger = {
		NOT = { has_global_flag = initialized }
		has_landed_title = k_naga
	}
	immediate = { 
		set_global_flag = initialized 
	}
	
	option = {
		#name = startup.1.A
			
		if = {
			limit = { year = 440 }
			# Structures on Valor
			1 = { #Virtus
				add_province_modifier = { name = ancient_ruins duration = -1 }
				add_province_modifier = { name = dragons_gate_elibe duration = -1 }
			}
			2 = { #Temperantia
				add_province_modifier = { name = ancient_ruins duration = -1 }
			}
			# The area in Ilia where Bern found that weather magic tome
			265 = { #Neandreia
				add_province_modifier = { name = ancient_ruins duration = -1 }
			}
			# Arcadia
			120 = { 
				add_province_modifier = { name = ancient_ruins duration = -1 }
			}
		}
		
		# Artifacts
		character_event = { id = startup_artifacts.1 }
		
		# Create immortal characters via event, so they look the appropriate age
		if = { # Athos and Bramimond
			limit = { 
				year = 120
				NOT = { year = 1161 }
			}
			character_event = {
				id = fe_immortal.1
			}
		}
		if = { # Ninian and Nils
			limit = { 
				year = 1159
				NOT = { year = 1161 }
			}
			character_event = {
				id = fe_immortal.2
			}
		}
		if = { # Fae
			limit = { 
				year = 845
				NOT = { year = 4204 }
			}
			character_event = {
				id = fe_immortal.3
			}
		}
		if = { # Sophia
			limit = { 
				year = 905
				NOT = { year = 1400 }
			}
			character_event = {
				id = fe_immortal.4
			}
		}
		
		# Startup events for scenarios
		if = { # Lyn's Story
			limit = { 
				year = 1159
				NOT = { year = 1160 }
			}
			character_event = {
				id = startup.3
			}
		}
		
		if = { # Blazing Sword
			limit = { 
				year = 1160
				NOT = { year = 1161 }
			}
			character_event = {
				id =  startup.4
			}
		}
		
		if = { # Binding Blade
			limit = { 
				year = 1180
				NOT = { year = 1181 }
			}
			character_event = {
				id =  startup.2
			}
		}
	}
}

# Binding Blade setup
character_event = {
	id = startup.2
	
	is_triggered_only = yes 
	
	immediate = {
		set_global_flag = scenario_fe6_binding_blade	
	}
	option = {
		
		if = {
			limit = {
				has_game_rule = {
					name = fe_story
					value = on
				}
			}
			random_character = {
				limit = {
					has_character_flag = is_fe6_zephiel
				}
				set_character_flag = searching_for_demon_dragon
				character_event = {
					id =  fe6.6
					days = 1
				}
			}
		}
	}
}

# The Girl from the Plains setup
character_event = {
	id = startup.3
	
	is_triggered_only = yes 
	
	immediate = {
		if = {
			limit = {
				NOT = { has_global_flag = scenario_fe7_the_girl_from_the_plains }
				d_lyn = {
					has_holder = yes
					holder_scope = {						
						has_character_flag = is_fe7_lyn
						any_current_enemy = {
							has_landed_title = d_caelin
							has_character_flag = is_fe7_lundgren
						}
					}
				}
			}
			set_global_flag = scenario_fe7_the_girl_from_the_plains
			
			if = {
				limit = {
					has_game_rule = {
						name = fe_story
						value = on
					}
				}
				d_lyn = {
					holder_scope = {
						character_event = { id = fe7_lyn.1 days = 20 random = 5 }
					}
				}
			}
		}
	}
	option = {
		name = OK
	}
}

# Blazing Sword setup
character_event = {
	id = startup.4
	
	is_triggered_only = yes 
	
	immediate = {
		if = {
			limit = {
				NOT = { has_global_flag = scenario_fe7_blazing_sword }
			}
			set_global_flag = scenario_fe7_blazing_sword
			
			if = {
				limit = {
					has_game_rule = {
						name = fe_story
						value = on
					}
				}
				k_lycia = {
					set_title_flag = quintessence_conspiracy_zone 
				}
				d_ostia = {									
					set_title_flag = quintessence_conspiracy_target 
				}
				e_nergal = {
					holder_scope = {
						set_character_flag = quintessence_conspiracy_leader
						character_event = { id = fe7_eliwood.13 days = 90 random = 10 }
					}
				}
				d_pherae = {
					holder_scope = {
						set_character_flag = blazing_sword_startup
						character_event = { id = fe7_eliwood.11 days = 1 }
					}
				}
				d_laus = {
					holder_scope = {
						set_character_flag = quintessence_conspiracy_member
					}
				}
				d_santaruz = {
					holder_scope = {
						set_character_flag = quintessence_conspiracy_member
					}
				}
			}
			# Need to get rid of Elbert even if story events are disabled
			random_character = {
				limit = {
					has_character_flag = is_fe7_elbert
				}
				character_event = { id = fe7_eliwood.25 days = 1}
			}
		}
	}
	option = {
		name = OK
	}
}
