# Regalia events

# Divine weapons hunts will follow the same pattern:
# 1: Go to the county where it's hidden, with the ambition to find it.
# 2: Get an event informing you the hiding place has been found, with the option to go straight there, look for a hint first, or call off the hunt.
# 3: The hint event will explain how to get the item and then send you to the hiding spot.
# 4: Puzzle event, varies depending on the weapon.
# Successful completion of the event gets you the weapon. Failure locks that character out of the shrine permanently, if they survive.

namespace = regalia

# Starting point - do you want to search?
character_event = {
	id = regalia.7
	title = "regalia.7.title"
	desc = "regalia.7.desc"
	picture = "GFX_evt_rider_adventure" 
	is_triggered_only = yes
    #has_dlc = "Mystics"
#	prisoner = no
#	only_playable = yes
#	capable_only = yes
#	min_age = 14	
#	trigger = {
#		has_ambition = obj_acquire_regalia
#		NOT = { has_global_flag = regalia_durandal_held }
#		NOT = { has_character_flag = regalia_durandal_trial }
#		NOT = { has_character_flag = regalia_durandal_failure }
#		NOT = { has_character_modifier = declined_regalia_search }		
#		location = {
#			county = {
#				title = c_durandal
#			}
#		}
#	}
#	mean_time_to_happen = {
#		days = 5	
#	}
	
	# Yes, let's look
	option = {
		name = "regalia.7.A"
		trigger = {
			NOT = { has_character_flag = regalia_durandal_info }
		}
		hidden_tooltip = { character_event = { id = regalia.1 } }
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.7.B"
		trigger = {
			has_character_flag = regalia_durandal_info 
		}
		hidden_tooltip = { character_event = { id = regalia.3 } }
	}		
	# No
	option = {
		name = "regalia.7.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}

# Looking for Durandal
narrative_event = {
	id = regalia.1
	title = "regalia.1.title"
	desc = "regalia.1.desc"
	picture = "GFX_evt_rider_adventure" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_durandal_info
	}
	
	option = {
		name = "regalia.1.A"
		prestige = 10
		hidden_tooltip = { 
			if = {
				limit = {
					has_global_flag = georg_defeated
				}
				character_event = { id = regalia.9 } 
			}			
			if = {
				limit = {
					NOT = { has_global_flag = georg_defeated }
				}
				character_event = { id = regalia.3 } 
			}		
		}
	}	
	
	option = {
		name = "regalia.1.B"
		hidden_tooltip = { 
			if = {
				limit = {
					has_global_flag = georg_defeated
				}
				character_event = { id = regalia.8 } 
			}			
			if = {
				limit = {
					NOT = { has_global_flag = georg_defeated }
				}
				character_event = { id = regalia.2 } 
			}		
		}
	}		
	
	option = {
		name = "regalia.1.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Warning about the warriors
narrative_event = {
	id = regalia.2
	title = "regalia.2.title"
	desc = "regalia.2.desc"
	picture = "GFX_evt_rider_adventure" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.2.A"
		hidden_tooltip = { character_event = { id = regalia.3 } }
	}		
	
	option = {
		name = "regalia.2.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# "Valorous Roland" event - mini-war against Georg's guardians
narrative_event = {
	id = regalia.3
	title = "regalia.3.title"
	desc = "regalia.3.desc"
	picture = "GFX_evt_rider_adventure" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.3.A"
		set_character_flag = regalia_durandal_trial
		hidden_tooltip = { 
			ROOT={
				location = {
					create_character = {
						name="Georg"
						random_traits = no
						dynasty = none
						religion = elibe_spirits_pagan
						culture = lycian
						female = no
						age = 30
						attributes = {
							martial = 10
						}
						trait = tough_soldier
						trait = strong
						trait = heavy_infantry_leader
						trait = unyielding_leader
						trait = base_class_mercenary
						trait = class_berserker
						trait = phantom
					}
					
					new_character = {
						set_character_flag = regalia_guardian
						set_character_flag = class_selected
						set_variable = { which = "level" value = 15 }
						create_title = {
							tier = DUKE
							landless = yes
							temporary = yes
							#rebel = yes
							culture = lycian
							name = "PHANTOM_GUARDIANS"
							holder = THIS
						}
						
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							leader = THIS
							match_character = ROOT
							match_mult = 0.25
							attrition = 0
						}
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							match_character = ROOT
							match_mult = 0.25
							attrition = 0
						}
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							match_character = ROOT
							match_mult = 0.25
							attrition = 0
						}
							
						# DoW on the character
						ROOT = {
							war = {
								target = PREV
								casus_belli = regalia_guardian
							}
							reverse_opinion = {
								who = PREV
								modifier = opinion_regalia_trespasser
							}
						}
					}
				}
			}
		}
	}		
	
	option = {
		name = "regalia.3.B"
		set_character_flag = regalia_durandal_failure
		prestige = -100
	}		
}

# Lost to the guardians
narrative_event = {
	id = regalia.4
	title = "regalia.4.title"
	desc = "regalia.4.desc"
	picture = "GFX_evt_bad_news" 
	is_triggered_only = yes
	option = {
		name = "regalia.4.A"
		set_character_flag = regalia_durandal_failure
		clr_character_flag = regalia_durandal_trial
		clr_character_flag = lost_to_regalia_guardians
		prestige = -500
	}		
}

# Defeated the guardians
narrative_event = {
	id = regalia.5
	title = "regalia.5.title"
	desc = "regalia.5.desc"
	picture = "GFX_evt_rider_adventure"
	is_triggered_only = yes
	option = {
		name = "regalia.5.A"
		clr_character_flag = regalia_durandal_trial
		clr_character_flag = defeated_regalia_guardians
		set_global_flag = georg_defeated
		hidden_tooltip = { character_event = { id = regalia.6 } }
	}		
}

#Claim the sword
narrative_event = {
	id = regalia.6
	title = "regalia.6.title"
	desc = "regalia.6.desc"
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.6.A"
		add_artifact = regalia_durandal
		new_artifact = {
			set_creation_date = -1.1.1
		}
		#add_character_modifier = { name = owns_regalia duration = -1 } 
		#add_trait = regalia_durandal
		set_global_flag = regalia_durandal_held 
	}		
}

# Fire cave hint
narrative_event = {
	id = regalia.8
	title = "regalia.8.title"
	desc = "regalia.8.desc"
	picture = "GFX_evt_durandal_tiles" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.8.A"
		hidden_tooltip = { character_event = { id = regalia.11 } }
	}		
	
	option = {
		name = "regalia.8.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Walked off the path!
character_event = {
	id = regalia.9
	#title = "regalia.9.title"
	desc = "regalia.9.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.9.A"
		hidden_tooltip = { 
			set_character_flag = regalia_durandal_failure
			clr_character_flag = regalia_durandal_trial 
		}
		
		random_list = {
			10 = {
				add_trait = wounded
				character_event = { id = regalia.10 }
			}
			20 = {
				add_trait = maimed
				character_event = { id = regalia.10 }
			}
			70 = {
				death = { death_reason = death_lava } 
			}
		}
	}		
}

# Survived, but failed the trial.
character_event = {
	id = regalia.10
	#title = "regalia.10.title"
	desc = "regalia.10.desc"
	picture = "GFX_evt_bad_news" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.10.A"
		prestige = -100
	}		
}

# Durandal Cave is a linear path. Follow the level map and you'll be fine. Make the wrong choice and you fall in the lava.
# Step 1
narrative_event = {
	id = regalia.11
	title = "regalia.11.title"
	desc = "regalia.11.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_durandal_trial
	}
	
	# Forward
	option = {
		name = "regalia.11.A"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
	# Right
	option = {
		name = "regalia.11.B"
		hidden_tooltip = { character_event = { id = regalia.12 } }
	}		
}

# Step 2
character_event = {
	id = regalia.12
	desc = "regalia.12.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	# Near
	option = {
		name = "regalia.12.A"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
	# Far
	option = {
		name = "regalia.12.B"
		hidden_tooltip = { character_event = { id = regalia.13 } }
	}		
}

# Step 3
character_event = {
	id = regalia.13
	desc = "regalia.13.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.13.A"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
	
	option = {
		name = "regalia.13.B"
		hidden_tooltip = { character_event = { id = regalia.14 } }
	}		
}

# Step 4
character_event = {
	id = regalia.14
	desc = "regalia.14.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.14.A"
		hidden_tooltip = { character_event = { id = regalia.15 } }
	}		
	
	option = {
		name = "regalia.14.B"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
}

# Step 5
character_event = {
	id = regalia.15
	desc = "regalia.15.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.15.A"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
	
	option = {
		name = "regalia.15.B"
		hidden_tooltip = { character_event = { id = regalia.16 } }
	}		
	
	option = {
		name = "regalia.15.C"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
}

# Step 6
character_event = {
	id = regalia.16
	desc = "regalia.16.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.16.A"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
	
	option = {
		name = "regalia.16.B"
		hidden_tooltip = { character_event = { id = regalia.17 } }
	}		
}

# Step 7
character_event = {
	id = regalia.17
	desc = "regalia.17.desc"
	picture = "GFX_evt_irminsul_burning" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.17.A"
		hidden_tooltip = { character_event = { id = regalia.9 } }
	}		
	
	option = {
		name = "regalia.17.B"
		hidden_tooltip = { character_event = { id = regalia.6 } }
	}		
}

# Decide on regalia inheritance
# DEPRECATED
character_event = {
	id = regalia.18
	title = "regalia.18.title"
	desc = "regalia.18.desc"
	picture = "GFX_evt_death" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.18.A"
		set_character_flag = regalia_inherit
	}		
	
	option = {
		name = "regalia.18.B"
		set_character_flag = regalia_hide
	}		
	
	option = {
		name = "regalia.18.C"
	}		
}

# Death of a regalia holder
# DEPRECATED
character_event = {
	id = regalia.19
	hide_window = yes
	picture = "GFX_evt_death" 
	
	is_triggered_only = yes
	
	trigger = {		
		any_artifact = { has_artifact_flag = regalia } 
	}
	
	immediate = {
		ROOT = { save_event_target_as = last_regalia_owner }
		
		if = {
			limit = {
				NOT = { has_character_flag = regalia_hide }
			}
			if = { 
				limit = { 
					is_ruler = yes
					current_heir = { 
						dynasty = ROOT 
						is_alive = yes  
						NOT = { any_artifact = { has_artifact_flag = regalia } } 
					}
				}
				current_heir = {
					#
					character_event = { id = regalia.52 }
				}
				set_character_flag = regalia_heir_found
			}
			if = { 
				limit = { NOT = { has_character_flag = regalia_heir_found } is_patrician = yes }
				family_palace = {
					current_heir = { 
						if = {
							limit = { NOT = { any_artifact = { has_artifact_flag = regalia }  } }
							#
							character_event = { id = regalia.52 }
							ROOT = { set_character_flag = regalia_heir_found }
						}	
					}					
				}				
			}
			if = { 
				limit = { NOT = { has_character_flag = regalia_heir_found } }
				random_child = {
					limit = { dynasty = ROOT is_alive = yes NOT = { any_artifact = { has_artifact_flag = regalia } } }
					character_event = { id = regalia.52 }
					ROOT = { set_character_flag = regalia_heir_found }
				}	
			}	
			if = {
				limit = { NOT = { has_character_flag = regalia_heir_found } }
				random_sibling = {
					limit = { dynasty = ROOT is_alive = yes NOT = { any_artifact = { has_artifact_flag = regalia } } }
					character_event = { id = regalia.52 }
					ROOT = { set_character_flag = regalia_heir_found }
				}	
			}	
			if = {
				limit = { NOT = { has_character_flag = regalia_heir_found } }
				random_dynasty_member = {
					limit = { is_alive = yes NOT = { any_artifact = { has_artifact_flag = regalia } } }
					character_event = { id = regalia.52 }
					ROOT = { set_character_flag = regalia_heir_found }
				}
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_heir_found } }
				random_child = {
					limit = { is_primary_heir = yes is_alive = yes NOT = { any_artifact = { has_artifact_flag = regalia } } }
					character_event = { id = regalia.52 }
					ROOT = { set_character_flag = regalia_heir_found }
				}
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_heir_found } }
				random_child = {
					limit = { is_alive = yes NOT = { any_artifact = { has_artifact_flag = regalia } } }
					character_event = { id = regalia.52 }
					ROOT = { set_character_flag = regalia_heir_found }
				}
			}
			if = {
				limit = { 
					NOT = { has_character_flag = regalia_heir_found }
					spouse = { is_alive = yes NOT = { any_artifact = { has_artifact_flag = regalia } } }		
				}
				spouse = { character_event = { id = regalia.52 } }
				set_character_flag = regalia_heir_found
			}
			if = {
				limit = { 
					NOT = { has_character_flag = regalia_heir_found }	
					liege = { NOT = { character = ROOT } NOT = { any_artifact = { has_artifact_flag = regalia } } }
				}
				liege = { character_event = { id = regalia.52 } }
				set_character_flag = regalia_heir_found
			}
			if = {
				limit = { 
					NOT = { has_character_flag = regalia_heir_found }	
					current_heir = { NOT = { character = ROOT } NOT = { any_artifact = { has_artifact_flag = regalia } } }
				}
				current_heir = { 
					#
					character_event = { id = regalia.52 }
				}
				set_character_flag = regalia_heir_found
			}
			if = {
				limit = { 
					NOT = { has_character_flag = regalia_heir_found }	
				}
				random_vassal = { 
					limit = { NOT = { any_artifact = { has_artifact_flag = regalia } } }
					#
					character_event = { id = regalia.52 }
				}
			}
			clr_character_flag = regalia_heir_found
		}
		
		if = {
			limit = {
				has_character_flag = regalia_hide
			}
			if = {
				limit = {
					has_artifact = regalia_durandal
				}
				clr_global_flag = regalia_durandal_held 
			}		
			if = {
				limit = {
					has_artifact = "regalia_binding_blade"
				}
				clr_global_flag = "regalia_binding_blade_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_armads"
				}
				clr_global_flag = "regalia_armads_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_forblaze"
				}
				clr_global_flag = "regalia_forblaze_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_aureola"
				}
				clr_global_flag = "regalia_aureola_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_mulagir"
				}
				clr_global_flag = "regalia_mulagir_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_maltet"
				}
				clr_global_flag = "regalia_maltet_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_apocalypse"
				}
				clr_global_flag = "regalia_apocalypse_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_eckesachs"
				}
				clr_global_flag = "regalia_eckesachs_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_saints_staff"
				}
				clr_global_flag = "regalia_saints_staff_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_mani_katti"
				}
				clr_global_flag = "regalia_mani_katti_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_sol_katti"
				}
				clr_global_flag = "regalia_sol_katti_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_ereshkigal"
				}
				clr_global_flag = "regalia_ereshkigal_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_gespenst"
				}
				clr_global_flag = "regalia_gespenst_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_luce"
				}
				clr_global_flag = "regalia_luce_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_excalibur_fe7"
				}
				clr_global_flag = "regalia_excalibur_fe7_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_rienfleche"
				}
				clr_global_flag = "regalia_rienfleche_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_rex_hasta"
				}
				clr_global_flag = "regalia_rex_hasta_held" 
			}		
			if = {
				limit = {
					has_artifact = "regalia_regal_blade"
				}
				clr_global_flag = "regalia_regal_blade_held" 
			}			
		}
	}		
}

# Found one in the desert!
character_event = {
	id = regalia.20
	#title = "regalia.20.title"
	desc = "regalia.20.desc"
	picture = "GFX_evt_desert" 
	
    #has_dlc = "Mystics"
	prisoner = no
	only_playable = yes
	capable_only = yes
	min_age = 14
	
	trigger = {
		has_ambition = obj_acquire_regalia
		location = {
			terrain = desert
			NOT = { has_province_flag = regalia_found }
			available_regalia_trigger = yes
		}

	}
	mean_time_to_happen = {
		years = 150
	}
	
	# open it
	option = {
		name = "regalia.20.A"
		
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				trait = trusting
			}
		}
		
		hidden_tooltip = {  
			add_random_regalia_from_location_effect = yes
		}
	}	
	
	# No
	option = {
		name = "regalia.20.B"
		
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 50
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = craven
			}
		}
		
		random_list = {
			85 = {}
			10 = { add_trait = paranoid }
			5 = { add_trait = craven }
		}
	}	
}

#Inform character of their prize
character_event = {
	id = regalia.21
	#title = "regalia.21.title"
	desc = "regalia.21.desc"
	picture = "GFX_evt_regalia" 
	
	is_triggered_only = yes
		
	# open it
	option = {
		name = "regalia.21.A"
		add_regalia_effect = yes
	}	
}

# Expedition to ruins
province_event = {
	id = regalia.22
	title = "regalia.22.title"
	desc = "regalia.22.desc"
	picture = "GFX_evt_pagan"

	#hide_window = yes
	
	trigger = {
		has_province_modifier = ancient_ruins
		owner = { 
			has_ambition = obj_acquire_regalia
			#NOT = { any_artifact = { has_artifact_flag = regalia } } 
			NOT = { trait = incapable }
				
			job_spiritual = {
				ai = yes
				NOT = {
					trait = craven
				}
				prisoner = no
				opinion = { who = PREV value = 25 }
			}			
		}
		available_regalia_trigger = yes
	}
	
	mean_time_to_happen = {
		years = 120
	}
	
	immediate = { 
		owner = { character_event = { id = regalia.23} } 
	}

	option = {
		name = OK
	}
}

character_event = {
	id = regalia.23
	title = "regalia.23.title"
	desc = "regalia.23.desc"
	picture = "GFX_evt_pagan" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.23.A"
		
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 3
				trait = brave
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
		}
		
		random_list = {
			70 = { # Found it
				hidden_tooltip = { ROOT = { character_event = { id = regalia.24 days=3 } } }
			}
			20 = { # Nothing
				hidden_tooltip = { ROOT = { character_event = { id = regalia.25 days=3 } } }
			}
			10 = { # Death
				hidden_tooltip = { ROOT = { character_event = { id = regalia.26 days=3 } } }
			}
		}		
	}	
		
	option = {
		name = "regalia.23.B"
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				trait = craven
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
		}
				
		job_spiritual = {
			random_list = {
				50 = { # Found it
					hidden_tooltip = { ROOT = { character_event = { id = regalia.27 days=3 } } }
				}
				30 = { # Nothing
					hidden_tooltip = { ROOT = { character_event = { id = regalia.28 days=3 } } }
				}
				20 = { # Death
					hidden_tooltip = { ROOT = { character_event = { id = regalia.29 days=7 } } }
				}
				# Takes it and sells it?
			}
		}
	}	
		
	option = {
		name = "regalia.23.C"
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				trait = brave
			}
		}
		
		job_spiritual = {
			opinion = {
				modifier = opinion_unhappy
				who = ROOT
				years = 1
			}		
		}
	}	
}

character_event = {
	id = regalia.24
	#title = "regalia.24.title"
	desc = "regalia.24.desc"
	picture = "GFX_evt_pagan" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.24.A"
		add_random_regalia_from_owned_ruins_effect = yes
	}	
}

# Failed hunt
character_event = {
	id = regalia.25
	#title = "regalia.25.title"
	desc = "regalia.25.desc"
	picture = "GFX_evt_pagan" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.25.A"
		prestige = -50
		job_spiritual = {
			reverse_opinion = {
				modifier = opinion_unhappy
				who = ROOT
				years = 5
			}		
			prestige = -100
		}		
	}	
}

# Died in the ruins
character_event = {
	id = regalia.26
	#title = "regalia.26.title"
	desc = "regalia.26.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.26.A"
		death = { death_reason = death_accident }
	}	
}

# Chaplain success
character_event = {
	id = regalia.27
	#title = "regalia.27.title"
	desc = "regalia.27.desc"
	picture = "GFX_evt_pagan" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.27.A"
		
		job_spiritual = {
			wealth = 100
			prestige = 100
		}		
		add_random_regalia_from_owned_ruins_effect = yes
	}	
	option = {
		name = "regalia.27.B"
		
		job_spiritual = {
			opinion = {
				modifier = happy
				who = ROOT
				years = 5
			}		
			wealth = 200
			prestige = 100
		}		
		add_random_regalia_from_owned_ruins_effect = yes
	}	
	option = {
		name = "regalia.27.C"
		
		job_spiritual = {
			opinion = {
				modifier = unhappy
				who = ROOT
				years = 5
			}		
			prestige = 100
		}		
		add_random_regalia_from_owned_ruins_effect = yes
	}	
}

# Chaplain failed hunt
character_event = {
	id = regalia.28
	#title = "regalia.28.title"
	desc = "regalia.28.desc"
	picture = "GFX_evt_pagan" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.28.A"
		job_spiritual = {
			prestige = -100
		}		
	}	
}

# Chaplain died in the ruins
character_event = {
	id = regalia.29
	#title = "regalia.29.title"
	desc = "regalia.29.desc"
	picture = "GFX_evt_pagan" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.29.A"
		death = { death_reason = death_accident }
	}	
}


# Buy one
character_event = {
	id = regalia.30
	#title = "regalia.30.title"
	desc = "regalia.30.desc"
	picture = "GFX_evt_market"
	
	only_rulers = yes
	prisoner = no
	capable_only = yes
	
	trigger = {
		age = 14
		has_ambition = obj_acquire_regalia
		NOT = { any_artifact = { has_artifact_flag = regalia } }
		available_regalia_trigger = yes
	}

	mean_time_to_happen = {
		years = 5000
		
		modifier = {
			factor = 0.25
			wealth = 500
		}
		modifier = {
			factor = 0.25
			wealth = 1000
		}
		modifier = {
			factor = 0.25
			wealth = 5000
		}
		modifier = {
			factor = 0.25
			wealth = 10000
		}
		modifier = {
			factor = 0.9
			stewardship = 10
		}
		modifier = {
			factor = 0.9
			stewardship = 15
		}
		modifier = {
			factor = 0.9
			stewardship = 20
		}
	}

	immediate = {
		random_list = {		
			50 = { 
				set_character_flag=fake_regalia_peddler
			}
			50 = { 
				set_character_flag=true_regalia_peddler
			}
		}
	}
	
	# It could be fake. If so, a character with good intrigue or learning can spot it.
	option = {
		name = "regalia.30.A"
		tooltip_info = intrigue
		trigger = {
			has_character_flag=fake_regalia_peddler
			intrigue = 15
		}
		ROOT = { character_event = { id = regalia.31 } }
	}
	option = {
		name = "regalia.30.B"
		tooltip_info = learning
		trigger = {
			has_character_flag=fake_regalia_peddler
			learning = 12
		}
		ROOT = { character_event = { id = regalia.31 } }
	}

	# Buy it
	option = {
		name = "regalia.30.C"
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 2
				trait = trusting
			}
			modifier = {
				factor = 0.5
				trait = greedy
			}
		}
		wealth = -1000
		
		custom_tooltip = {
			name = regalia.30.C.tooltip
			hidden_tooltip = {
				if = {
					limit = {
						has_character_flag=fake_regalia_peddler
					}
					set_character_flag = "bought_fake_regalia"		
					character_event = { id = regalia.31 } 
				}
				
				if = {
					limit = {
						has_character_flag=true_regalia_peddler
					}
					add_random_regalia_from_capital_effect = yes
				}
			
			}
		}
	}

	# Pass
	option = {
		name = "regalia.30.D"
		ai_chance = { factor = 100 }
		
		clr_character_flag=true_regalia_peddler
		clr_character_flag=fake_regalia_peddler
	}	
}

# It was a fake
character_event = {
	id = regalia.31
	#title = "regalia.31.title"
	desc = "regalia.31.desc"
	picture = "GFX_evt_market" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.31.A"
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 2
				trait = cruel
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 0.5
				trait = kind
			}
		}
		random_list = {		
			50 = {
				modifier = {
					factor = 0.5
					NOT={intrigue = 10}
				}
				modifier = {
					factor = 1.5
					intrigue = 15
				}
				modifier = {
					factor = 1.2
					intrigue = 20
				}
				if = {
					limit = { has_character_flag = bought_fake_regalia }
					wealth = 1000
					clr_character_flag = "bought_fake_regalia"
				}
				create_character = {
					female = no
					age = 40
					random_traits = yes
					dynasty = none
					culture = seafarer
					religion = ROOT
					trait = deceitful
					trait = greedy
					trait = flamboyant_schemer
				}
				new_character = {
					imprison = ROOT
					opinion = {
						modifier = opinion_arrest_attempt
						who = ROOT
						years = 15
					}
				}
				custom_tooltip = { text = regalia.31.A.tooltip }
			}
			50 = {
				modifier = {
					factor = 1.5
					NOT={intrigue = 10}
				}
				ROOT = { character_event = { id = regalia.32 } }
			}
		}
	}
	option = {
		name = "regalia.31.B"
		ai_chance = { factor = 10 }
		if = {
			limit = { has_character_flag = bought_fake_regalia }
			random_list = {		
				50 = {
					modifier = {
						factor = 1.5
						intrigue = 15
					}
					modifier = {
						factor = 1.2
						intrigue = 20
					}
					wealth = 1000
					custom_tooltip = { text = regalia.31.B.tooltip }
					clr_character_flag = bought_fake_regalia
				}
				50 = { 
					modifier = {
						factor = 1.5
						NOT={intrigue = 10}
					}
					ROOT = { character_event = { id = regalia.32 } }
				}
			}
		}
		if = {
			limit = { NOT = { has_character_flag = bought_fake_regalia } }
			custom_tooltip = { text = regalia.31.B.tooltip }
		}
	}
}

# He got away
character_event = {
	id = regalia.32
	desc = "regalia.32.desc"
	picture = "GFX_evt_scandal"

	is_triggered_only = yes

	option = {
		name = "regalia.32.A"
		if = {
			limit = { NOT = { has_character_flag = bought_fake_regalia } }
			#custom_tooltip = { text = regalia.32.A.tooltip }
			prestige = -10
		}
		if = {
			limit = { has_character_flag = bought_fake_regalia }
			prestige = -100
			clr_character_flag = bought_fake_regalia
		}
	}
}

# Armads
# Starting point - do you want to search?
character_event = {
	id = regalia.33
	title = "regalia.33.title"
	desc = "regalia.33.desc"
	picture = "GFX_evt_rider_adventure" 
	
    is_triggered_only = yes
	
	# Yes, let's look
	option = {
		name = "regalia.33.A"
		trigger = {
			NOT = { has_character_flag = regalia_armads_info }
		}
		hidden_tooltip = { character_event = { id = regalia.34 } }
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.33.B"
		trigger = {
			has_character_flag = regalia_armads_info 
		}
		hidden_tooltip = { character_event = { id = regalia.3 } }
	}		
	# No
	option = {
		name = "regalia.33.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}

# Looking for Armads
narrative_event = {
	id = regalia.34
	title = "regalia.34.title"
	desc = "regalia.34.desc"
	picture = "GFX_evt_whispers" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_armads_info
	}
	
	option = {
		name = "regalia.34.A"
		prestige = 10
		hidden_tooltip = { 
			if = {
				limit = {
					has_global_flag = kaim_defeated
				}
				character_event = { id = regalia.1 } 
			}			
			if = {
				limit = {
					NOT = { has_global_flag = kaim_defeated }
				}
				character_event = { id = regalia.36 } 
			}		
		}
	}	
	
	option = {
		name = "regalia.34.B"
		hidden_tooltip = { 
			if = {
				limit = {
					has_global_flag = kaim_defeated
				}
				character_event = { id = regalia.8 } 
			}			
			if = {
				limit = {
					NOT = { has_global_flag = kaim_defeated }
				}
				wealth = -10
				character_event = { id = regalia.35 } 
			}		
		}
	}		
	
	option = {
		name = "regalia.34.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Warning about the warriors
narrative_event = {
	id = regalia.35
	title = "regalia.35.title"
	desc = "regalia.35.desc"
	picture = "GFX_evt_whispers" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.35.A"
		hidden_tooltip = { character_event = { id = regalia.36 } }
	}		
	
	option = {
		name = "regalia.35.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# "The Berserker" event - mini-war against Kaim's guardians
narrative_event = {
	id = regalia.36
	title = "regalia.36.title"
	desc = "regalia.36.desc"
	picture = "GFX_evt_viking_battle_oldgods" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.36.A"
		set_character_flag = regalia_armads_trial
		hidden_tooltip = { 
			ROOT={
				location = {
					create_character = {
						name="Kaim"
						random_traits = no
						dynasty = none
						religion = elibe_spirits_pagan
						culture = western_islander
						female = no
						age = 30
						attributes = {
							martial = 10
						}
						trait = tough_soldier
						trait = strong
						trait = heavy_infantry_leader
						trait = unyielding_leader
						trait = base_class_mercenary
						trait = class_hero
						trait = phantom
					}
					
					new_character = {
						set_character_flag = regalia_guardian
						set_character_flag = class_selected
						set_variable = { which = "level" value = 16 }
						
						create_title = {
							tier = DUKE
							landless = yes
							temporary = yes
							#rebel = yes
							culture = western_islander
							name = "PHANTOM_GUARDIANS"
							holder = THIS
						}
						
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							leader = THIS
							match_character = ROOT
							match_mult = 0.25
							attrition = 0
						}
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							match_character = ROOT
							match_mult = 0.25
							attrition = 0
						}
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							match_character = ROOT
							match_mult = 0.25
							attrition = 0
						}
							
						# DoW on the character
						ROOT = {
							war = {
								target = PREV
								casus_belli = regalia_guardian
							}
							reverse_opinion = {
								who = PREV
								modifier = opinion_regalia_trespasser
							}
						}
					}
				}
			}
		}
	}		
	
	option = {
		name = "regalia.36.B"
		set_character_flag = regalia_armads_failure
		prestige = -100
	}		
}

# Lost to the guardians
narrative_event = {
	id = regalia.37
	title = "regalia.37.title"
	desc = "regalia.37.desc"
	picture = "GFX_evt_bad_news" 
	is_triggered_only = yes
	option = {
		name = "regalia.37.A"
		set_character_flag = regalia_armads_failure
		clr_character_flag = regalia_armads_trial
		clr_character_flag = lost_to_regalia_guardians
		prestige = -500
	}		
}

# Defeated the guardians
narrative_event = {
	id = regalia.38
	title = "regalia.38.title"
	desc = "regalia.38.desc"
	picture = "GFX_evt_rider_adventure"
	is_triggered_only = yes
	option = {
		name = "regalia.38.A"
		clr_character_flag = regalia_armads_trial
		clr_character_flag = defeated_regalia_guardians
		set_global_flag = kaim_defeated
		hidden_tooltip = { character_event = { id = regalia.39 } }
	}		
}

#Claim the axe
narrative_event = {
	id = regalia.39
	title = "regalia.39.title"
	desc = "regalia.39.desc"
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.39.A"
		#add_character_modifier = { name = owns_regalia duration = -1 } 
		#add_trait = regalia_armads
		add_artifact = regalia_armads
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_armads_held 
		
		# Durban gets the best lines:
		# "I am power. Power without peer. I am the dragonhunter. I am the fleshbiter, the bonecrusher, the skullbreaker, the doombringer."
		# "I require no seals. I have no need of this idleness called peace. Power unused is power wasted. Better to lie spent in the grave than to sit in wait. I care not who... I would fight someone..."
	}		
}

# Poison cave hint
narrative_event = {
	id = regalia.40
	title = "regalia.40.title"
	desc = "regalia.40.desc"
	picture = "GFX_evt_armads_sketch" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.40.A"
		hidden_tooltip = { character_event = { id = regalia.41 } }
	}		
	
	option = {
		name = "regalia.40.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		#prestige = -10
	}		
}

# Armads Cave is a roughly circular path, with several junctions where you can choose a direction to take. Each junction gets an event.
# Most junctions have poison gas traps between them. The traps have a random chance to hurt you.
character_event = {
	id = regalia.41
	#title = "regalia.41.title"
	desc = "regalia.41.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# Forward
	option = {
		name = "regalia.41.A"
		ai_chance = { 
			factor = 0
		}
		set_character_flag = regalia_armads_trial
		hidden_tooltip = { character_event = { id = regalia.42 } }
	}		
	
	option = {
		name = "regalia.41.B"
		ai_chance = { 
			factor = 100
		}
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Junction #1, southwest corner
character_event = {
	id = regalia.42
	#title = "regalia.42.title"
	desc = "regalia.42.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# North
	option = {
		name = "regalia.42.A"
		set_character_flag = "armads_cave_2"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
	# East
	option = {
		name = "regalia.42.B"
		set_character_flag = "armads_cave_5"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
	# Back out of the cave
	option = {
		name = "regalia.42.B"
		hidden_tooltip = { character_event = { id = regalia.43 } }
	}		
}

# Stumbled out of the cave
character_event = {
	id = regalia.43
	#title = "regalia.43.title"
	desc = "regalia.43.desc"
	picture = "GFX_evt_bad_news" 
	
	is_triggered_only = yes
	
	# Forward
	option = {
		name = "regalia.43.A"
		set_character_flag = regalia_armads_failure
		clr_character_flag = regalia_armads_trial
		prestige = -500
	}		
}

# Poison gas!
# Random chance for it to hit.
# On the first hit, it causes illness. Subsequent hits lower health.
# High-intrigue characters have better chances to dodge, and thief classes always dodge.
# TODO: Have it cause random symptoms instead of the illness-health thing?
character_event = {
	id = regalia.44
	#title = "regalia.44.title"
	desc = "regalia.44.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {		
			50 = {
				modifier = {
					factor = 0.5
					NOT={intrigue = 5}
				}
				modifier = {
					factor = 1.5
					intrigue = 10
				}
				modifier = {
					factor = 1.2
					intrigue = 15
				}
				set_character_flag = "armads_cave_dodged_gas"
			}
			50 = {
				modifier = {
					factor = 0
					OR = {
						trait="class_assassin"
						trait="class_assassin_female"
						trait="class_rogue"
						trait="class_thief"
						trait="class_thief_female"
					}
				}
				modifier = {
					factor = 1.5
					NOT={intrigue = 5}
				}
				set_character_flag = "armads_cave_gassed"
			}
		}	
	}
	# Back out of the cave
	option = {
		name= {
		  text = "regalia.44.A.1"
		  trigger = {
			has_character_flag = "armads_cave_dodged_gas"
		  }
		}
		name= {
		  text = "regalia.44.A.2"
		  trigger = {
			has_character_flag = "armads_cave_gassed"
		  }
		}
		
		if = {
			limit = {
				has_character_flag = "armads_cave_gassed"				
			}
			
			if = {
				limit = {
					trait = "ill"				
				}
				health = -0.5
			}			
			if = {
				limit = {
					NOT={trait = "ill" }
				}
				add_trait="ill"
			}	
		}
		clr_character_flag = "armads_cave_dodged_gas"
		clr_character_flag = "armads_cave_gassed"
		
		if = {
			limit = {
				has_character_flag = "armads_cave_1"				
			}
			clr_character_flag = "armads_cave_1"
			hidden_tooltip = { character_event = { id = regalia.42 } }
		}
		if = {
			limit = {
				has_character_flag = "armads_cave_2"				
			}
			clr_character_flag = "armads_cave_2"
			hidden_tooltip = { character_event = { id = regalia.45 } }
		}
		if = {
			limit = {
				has_character_flag = "armads_cave_3"				
			}
			clr_character_flag = "armads_cave_3"
			hidden_tooltip = { character_event = { id = regalia.47 } }
		}
		if = {
			limit = {
				has_character_flag = "armads_cave_4"				
			}
			clr_character_flag = "armads_cave_4"
			hidden_tooltip = { character_event = { id = regalia.48 } }
		}
		if = {
			limit = {
				has_character_flag = "armads_cave_5"				
			}
			clr_character_flag = "armads_cave_5"
			hidden_tooltip = { character_event = { id = regalia.49 } }
		}
		if = {
			limit = {
				has_character_flag = "armads_cave_6"				
			}
			clr_character_flag = "armads_cave_6"
			hidden_tooltip = { character_event = { id = regalia.50 } }
		}
		if = {
			limit = {
				has_character_flag = "armads_cave_7"				
			}
			clr_character_flag = "armads_cave_7"
			hidden_tooltip = { character_event = { id = regalia.51 } }
		}
	}		
}

# Junction #2, northwest corner
character_event = {
	id = regalia.45
	#title = "regalia.45.title"
	desc = "regalia.45.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# Northwest - dead end.
	option = {
		name = "regalia.45.A"
		set_character_flag = "armads_cave_2"
		hidden_tooltip = { character_event = { id = regalia.46 } }
	}		
	# Northeast
	option = {
		name = "regalia.45.B"
		set_character_flag = "armads_cave_3"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}	
	# Southeast
	option = {
		name = "regalia.45.B"
		set_character_flag = "armads_cave_4"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}	
	# Southwest
	option = {
		name = "regalia.45.D"
		set_character_flag = "armads_cave_1"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
}

# Junction #2, northwest corner dead end
character_event = {
	id = regalia.46
	#title = "regalia.46.title"
	desc = "regalia.46.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.46.A"
		set_character_flag = "armads_cave_2"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}			
}

# Junction #3, northeast area
character_event = {
	id = regalia.47
	#title = "regalia.47.title"
	desc = "regalia.47.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# Northwest
	option = {
		name = "regalia.47.A"
		set_character_flag = "armads_cave_2"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
	# Northeast
	option = {
		name = "regalia.47.B"
		hidden_tooltip = { character_event = { id = regalia.51 } }
	}	
	# South
	option = {
		name = "regalia.47.B"
		set_character_flag = "armads_cave_4"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
}

# Junction #4, central area
character_event = {
	id = regalia.48
	#title = "regalia.48.title"
	desc = "regalia.48.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# North
	option = {
		name = "regalia.48.A"
		set_character_flag = "armads_cave_3"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
	# West
	option = {
		name = "regalia.48.B"
		set_character_flag = "armads_cave_2"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}	
	# South
	option = {
		name = "regalia.48.B"
		set_character_flag = "armads_cave_5"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
}

# Junction #5, south central area
character_event = {
	id = regalia.49
	#title = "regalia.49.title"
	desc = "regalia.49.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# North
	option = {
		name = "regalia.49.A"
		set_character_flag = "armads_cave_4"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
	# West
	option = {
		name = "regalia.49.B"
		set_character_flag = "armads_cave_1"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}	
	# East
	option = {
		name = "regalia.49.C"
		hidden_tooltip = { character_event = { id = regalia.50 } }
	}		
}

# Junction #6, southeast corner
character_event = {
	id = regalia.50
	#title = "regalia.50.title"
	desc = "regalia.50.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# North
	option = {
		name = "regalia.50.A"
		set_character_flag = "armads_cave_7"
		hidden_tooltip = { character_event = { id = regalia.44 } }
	}		
	# West
	option = {
		name = "regalia.50.B"
		hidden_tooltip = { character_event = { id = regalia.49 } }
	}	
}

# Junction #7, northeast corner
character_event = {
	id = regalia.51
	#title = "regalia.51.title"
	desc = "regalia.51.desc"
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
	
	# Goal!
	option = {
		name = "regalia.51.A"
		clr_character_flag = regalia_armads_trial
		hidden_tooltip = { character_event = { id = regalia.39 } }
	}	
}

# Death of a regalia holder, part 2 - hand out the regalia to its heir
character_event = {
	id = regalia.52
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
			
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = regalia_durandal
				}
			}
			add_artifact = regalia_durandal
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_binding_blade"
				}
			}
			add_artifact = "regalia_binding_blade"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_armads"
				}
			}
			add_artifact = "regalia_armads"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_forblaze"
				}
			}
			add_artifact = "regalia_forblaze"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_aureola"
				}
			}
			add_artifact = "regalia_aureola"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_mulagir"
				}
			}
			add_artifact = "regalia_mulagir"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_maltet"
				}
			}
			add_artifact = "regalia_maltet"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_apocalypse"
				}
			}
			add_artifact = "regalia_apocalypse"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_eckesachs"
				}
			}
			add_artifact = "regalia_eckesachs"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_saints_staff"
				}
			}
			add_artifact = "regalia_saints_staff"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_mani_katti"
				}
			}
			add_artifact = "regalia_mani_katti"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_sol_katti"
				}
			}
			add_artifact = "regalia_sol_katti"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_ereshkigal"
				}
			}
			add_artifact = "regalia_ereshkigal"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_gespenst"
				}
			}
			add_artifact = "regalia_gespenst"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_luce"
				}
			}
			add_artifact = "regalia_luce"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_excalibur_fe7"
				}
			}
			add_artifact = "regalia_excalibur_fe7"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_rienfleche"
				}
			}
			add_artifact = "regalia_rienfleche"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_basilikos"
				}
			}
			add_artifact = "regalia_basilikos"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_rex_hasta"
				}
			}
			add_artifact = "regalia_rex_hasta"
		}	
		if = {
			limit = {
				event_target:last_regalia_owner = {
					has_artifact = "regalia_regal_blade"
				}
			}
			add_artifact = "regalia_regal_blade"
		}		
			
	}		
}

# Eckesachs
# Starting point - do you want to search?
character_event = {
	id = regalia.53
	title = "regalia.53.title"
	desc = "regalia.53.desc"
	picture = "GFX_evt_magnificent_castle" 
	
    is_triggered_only = yes

	# Yes, let's look
	option = {
		name = "regalia.53.A"
		trigger = {
			NOT = { has_character_flag = regalia_eckesachs_info }
		}
		hidden_tooltip = { character_event = { id = regalia.54 days=5} }
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.53.B"
		trigger = {
			has_character_flag = regalia_eckesachs_info 
		}
		hidden_tooltip = { character_event = { id = regalia.55 } }
	}		
	# No
	option = {
		name = "regalia.53.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}

# Looking for Eckesachs
narrative_event = {
	id = regalia.54
	title = "regalia.54.title"
	desc = "regalia.54.desc"
	picture = "GFX_evt_throne_room" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_eckesachs_info
	}
	
	option = {
		name = "regalia.54.A"
		prestige = 10
		hidden_tooltip = { 
			character_event = { id = regalia.55 } 
		}
	}	
	
	option = {
		name = "regalia.54.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Meeting with sword's keeper
narrative_event = {
	id = regalia.55
	title = "regalia.55.title"
	desc = "regalia.55.desc"
	picture = "GFX_evt_council" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.55.A"
		hidden_tooltip = { 
			# Eckesachs is a Zephiel-only weapon.
			# We'll say it can only be held by someone from the royal line.
			# Or, someone who holds or has a claim on the kingdom of Bern.
			
			if = {
				limit = {
					OR = {
						dynasty = 401 # of Bern
						dynasty = 118 # Eldreed; Al is Hartmut's secret bastard
						has_claim = k_bern
						has_landed_title = k_bern
						has_claim = k_calach # Calach is close enough. Might as well make this a little more open.
						has_landed_title = k_calach
					}
				}
				character_event = { id = regalia.56 } 
			}
			if = {
				limit = {
					NOR = {
						dynasty = 401 # of Bern
						dynasty = 118 # Eldreed; Al is Hartmut's secret bastard
						has_claim = k_bern
						has_landed_title = k_bern
						has_claim = k_calach # Calach is close enough. Might as well make this a little more open.
						has_landed_title = k_calach
					}
				}
				character_event = { id = regalia.57 } 
			}
		
		
		}
	}		
	
	option = {
		name = "regalia.55.B"
		set_character_flag = regalia_eckesachs_failure
		piety = 100
		
		if = {
			limit = {
				NOT = {trait = humble}
			}
			random = {
				chance = 50
				if = {
					limit = {
						trait = proud
					}
					remove_trait = proud
				}
				if = {
					limit = {
						NOT = {trait = proud}
					}
					add_trait = humble
				}
			}
		}
	}			
	
	option = {
		name = "regalia.55.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Accepted by Eckesachs
narrative_event = {
	id = regalia.56
	title = "regalia.56.title"
	desc = "regalia.56.desc"
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.56.A"
		#add_character_modifier = { name = owns_regalia duration = -1 } 
		#add_trait = regalia_eckesachs
		add_artifact = regalia_eckesachs
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_eckesachs_held 
	}		
}

# Rejected by Eckesachs
character_event = {
	id = regalia.57
	#title = "regalia.57.title"
	desc = "regalia.57.desc"
	picture = "GFX_evt_bad_news" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.9.A"
		hidden_tooltip = { 
			set_character_flag = regalia_eckesachs_failure
		}
		prestige = -500
	}		
}

character_event = {
    id = regalia.59
    desc = regalia.hunted
    picture = GFX_evt_regalia

    is_triggered_only = yes

    option = { #it's their duty
        name = item.1.A
		add_regalia_effect = yes
        artifact_duty_effect = yes
    }

    option = { #monetary reward
        name = item.1.B
		add_regalia_effect = yes
        artifact_money_effect = yes
    }
    
    option = { #reward them with a favor
        name = item.1.C
		add_regalia_effect = yes
        artifact_favor_effect = yes
    }

    option = { #praise them (prestige reward)
    	trigger = {
			diplomacy = 15
		}
        name = item.1.D
		add_regalia_effect = yes
        artifact_prestige_effect = yes
    }
    after = { clr_artifact_flagsmodifiers_effect = yes }
}

# Apocalypse
# Starting point - do you want to search?
character_event = {
	id = regalia.60
	title = "regalia.60.title"
	desc = {
		trigger = {
			any_realm_title = {
				title = b_temple_of_seals
			}
		}
		text = regalia.60.desc.1
	}	
	desc = {
		trigger = {
			NOT = { 
				any_realm_title = {
					title = b_temple_of_seals
				}
			}
		}
		text = regalia.60.desc.2
	}
	picture = "GFX_evt_pagan" 
	
    is_triggered_only = yes
	
	# Yes, let's look
	option = {
		name = "regalia.60.A"
		trigger = {
			NOT = { has_character_flag = regalia_apocalypse_info }
		}
		hidden_tooltip = { 
			set_character_flag = regalia_apocalypse_trial
			if = {
				limit = {
					any_realm_title = {
						title = b_temple_of_seals
					}
				}
				character_event = { id = regalia.62 days=5} 
			}
			if = {
				limit = {
					NOT = {
						any_realm_title = {
							title = b_temple_of_seals
						}
					}
				}
				
		
				random_list = {
					50 = {
						character_event = { id = regalia.61 days=5} 
					}
					50 = {
						modifier = {
							factor = 1.25
							intrigue = 5
							NOT = { intrigue = 10 }
						}
						modifier = {
							factor = 1.5
							intrigue = 10
							NOT = { intrigue = 15 }
						}
						modifier = {
							factor = 2
							intrigue = 15
							NOT = { intrigue = 20 }
						}
						modifier = {
							factor = 3
							intrigue = 20
							NOT = { intrigue = 25 }
						}
						modifier = {
							factor = 4
							intrigue = 25
							NOT = { intrigue = 30 }
						}
						modifier = {
							factor = 5
							intrigue = 30
						} 
						character_event = { id = regalia.62 days=5} 
					}
				}
			}
		}
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.60.B"
		trigger = {
			has_character_flag = regalia_apocalypse_info 
		}
		set_character_flag = regalia_apocalypse_trial
		hidden_tooltip = { character_event = { id = regalia.65 } }
	}		
	# No
	option = {
		name = "regalia.60.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}

# Search failure
character_event = {
	id = regalia.61
	desc = regalia.61.desc
	picture = "GFX_evt_bad_news" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.61.A"
		clr_character_flag = regalia_apocalypse_trial
		add_character_modifier = { name = declined_regalia_search duration = 365 } 
	}	
}

# Looking for Apocalypse
narrative_event = {
	id = regalia.62
	title = regalia.62.title
	#desc = regalia.62.desc
	desc = {
		trigger = {
			any_realm_title = {
				title = b_temple_of_seals
			}
		}
		text = regalia.62.desc.1
	}	
	desc = {
		trigger = {
			NOT = { 
				any_realm_title = {
					title = b_temple_of_seals
				}
			}
		}
		text = regalia.62.desc.2
	}
	picture = "GFX_evt_pagan" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.62.A"
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				any_realm_title = {
					title = b_temple_of_seals
				}
			}
		}
		prestige = 10
		hidden_tooltip = { 
			
			if = {
				limit = {
					any_realm_title = {
						title = b_temple_of_seals
					}
				}
				character_event = { id = regalia.65 } 
			}
			if = {
				limit = {
					NOT = {
						any_realm_title = {
							title = b_temple_of_seals
						}
					}
				}
				character_event = { id = regalia.63 } 
			}
		}
	}	
	
	option = {
		name = "regalia.62.B"
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				NOT = {
					any_realm_title = {
						title = b_temple_of_seals
					}
				}
			}
		}
		clr_character_flag = regalia_apocalypse_trial
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}
}

# Search 
character_event = {
	id = regalia.63
	hide_window = yes	
	is_triggered_only = yes
		
	option = {
		name = OK
		random_list = {
			50 = { # Failure
				modifier = {
					factor = 0
					OR = {
						diplomacy = 8
						intrigue = 8
						martial = 8
					}
				}
				character_event = { id = regalia.64 } 
			}
			50 = { # Random success
				character_event = { id = regalia.65 } 
			}
			50 = {
				modifier = {
					factor = 0
					NOT = { diplomacy = 8 }
				}
				character_event = { id = regalia.65 } 
			}
			50 = {
				modifier = {
					factor = 0
					NOT = { intrigue = 8 }
				}
				character_event = { id = regalia.65 } 
			}
			50 = {
				modifier = {
					factor = 0
					NOT = { martial = 8 }
				}
				character_event = { id = regalia.65 } 
			}
		}
	}	
}


# Caught trying to sneak in
character_event = {
	id = regalia.64
	desc = regalia.64.desc
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.64.A"
		clr_character_flag = regalia_apocalypse_trial
		set_character_flag = regalia_apocalypse_failure
	}	
}

# Temple
narrative_event = {
	id = regalia.65
	desc = regalia.65.desc
	title = regalia.65.title
	picture = "GFX_evt_jailbreak" 
	
	is_triggered_only = yes
	
	immediate = {
		set_variable = { which = apocalypse_trap value = 0 }
		set_variable = { which = apocalypse_chest value = 0 }
		set_character_flag = regalia_apocalypse_info
	}
		
	option = {
		name = "regalia.65.A"
		ai_chance = {
			factor = 50
		}
		character_event = { id = regalia.66 } 
	}	
	option = {
		name = "regalia.65.B"
		ai_chance = {
			factor = 50
		}
		character_event = { id = regalia.66 } 
	}	
	option = {
		name = "regalia.65.C"
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { is_dumb_trigger = yes }
			}
		}
		character_event = { id = regalia.72 } 
	}	
	option = {
		name = "regalia.65.D"
		ai_chance = {
			factor = 0
		}
		clr_character_flag = regalia_apocalypse_trial
		set_character_flag = regalia_apocalypse_failure
	}	
}

# Drowned
character_event = {
	id = regalia.72
	desc = regalia.72.desc
	picture = "GFX_evt_kraken" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.72.A"		
		death = { death_reason = death_accident_drowning }
	}	
}

# Hidden spear trap event.
character_event = {
	id = regalia.66
	hide_window = yes
	is_triggered_only = yes
		
	immediate = {
		change_variable = { which = apocalypse_trap value = 1 }
	}	
		
	option = {
		name = OK
		random_list = {		
			50 = {
				modifier = {
					factor = 2
					intrigue = 5
				}
				modifier = {
					factor = 2
					intrigue = 10
				}
				modifier = {
					factor = 2
					intrigue = 15
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				modifier = {
					factor = 2
					intrigue = 25
				}
				modifier = {
					factor = 2
					intrigue = 30
				}
				modifier = {
					factor = 2
					trait = paranoid
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
				character_event = { id = regalia.68 } 
			}
			50 = {
				modifier = {
					factor = 0
					trait=base_class_thief
				}
				
				character_event = { id = regalia.67 } 
			}
		}	
	}	
}

# Hit by trap!
character_event = {
	id = regalia.67
	#desc = regalia.67.desc
	desc = {
		trigger = {
			check_variable = { which = apocalypse_trap value = 1 }
			NOT = { check_variable = { which = apocalypse_trap value = 2 } }
		}
		text = regalia.67.desc.1
	}	
	desc = {
		trigger = {
			check_variable = { which = apocalypse_trap value = 2 }
			NOT = { check_variable = { which = apocalypse_trap value = 3 } }
		}
		text = regalia.67.desc.2
	}	
	desc = {
		trigger = {
			check_variable = { which = apocalypse_trap value = 3 }
		}
		text = regalia.67.desc.3
	}	
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.67.A"
		random_list = {		
			70 = {
				modifier = {
					factor = 0
					OR = {
						trait = wounded 
						trait = maimed 
						trait = mangled 
					}
				}
				add_trait = wounded
			}
			20 = {
				modifier = {
					factor = 0
					OR = {
						trait = maimed 
						trait = mangled 
					}
				}
				if = {
					limit = { trait = wounded }
					remove_trait = wounded
				}
				add_trait = maimed
			}
			10 = {
				modifier = {
					factor = 0
					trait = mangled 
				}				
				if = {
					limit = { trait = wounded }
					remove_trait = wounded
				}
				if = {
					limit = { trait = maimed }
					remove_trait = maimed
				}
				add_trait = mangled
			}
			10 = {
				modifier = {
					factor = 0
					NOT = { trait = wounded }
					NOT = { trait = maimed }
					NOT = { trait = mangled }
				}
				death = { death_reason = death_accident }
			}
		}	
		# Chest
		if = {
			limit = { check_variable = { which = apocalypse_trap value = 2 } } 			
			character_event = { id = regalia.69 } 
		}
		# Trap
		if = {
			limit = { NOT = { check_variable = { which = apocalypse_trap value = 2 } } }			
			character_event = { id = regalia.66 } 
		}
	}	
}
# Dodge trap
character_event = {
	id = regalia.68
	#desc = regalia.68.desc
	desc = {
		trigger = {
			check_variable = { which = apocalypse_trap value = 1 }
			NOT = { check_variable = { which = apocalypse_trap value = 2 } }
		}
		text = regalia.68.desc.1
	}	
	desc = {
		trigger = {
			check_variable = { which = apocalypse_trap value = 2 }
			NOT = { check_variable = { which = apocalypse_trap value = 3 } }
		}
		text = regalia.68.desc.2
	}	
	desc = {
		trigger = {
			check_variable = { which = apocalypse_trap value = 3 }
		}
		text = regalia.68.desc.3
	}	
	picture = "GFX_evt_into_the_dungeon" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.68.A"
		# Chest
		if = {
			limit = { check_variable = { which = apocalypse_trap value = 2 } } 			
			character_event = { id = regalia.69 } 
		}
		# Trap
		if = {
			limit = { NOT = { check_variable = { which = apocalypse_trap value = 2 } } }			
			character_event = { id = regalia.66 } 
		}
	}	
}
# Trapped chest
narrative_event = {
	id = regalia.69
	desc = regalia.69.desc
	title = regalia.69.title
	picture = "GFX_evt_relic_box" 
	
	is_triggered_only = yes
		
	immediate = {
		change_variable = { which = apocalypse_chest value = 1 }
	}	
		
	option = {
		name = "regalia.69.A"
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				is_smart_trigger = yes 
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 1.5
				intrigue = 10
			}
			modifier = {
				factor = 2
				intrigue = 15
			}
			modifier = {
				factor = 1.5
				learning = 10
			}
			modifier = {
				factor = 2
				learning = 15
			}
		}
		hidden_tooltip = { character_event = { id = regalia.70 } }
	}	
	option = {
		name = "regalia.69.B"
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				is_dumb_trigger = yes 
			}
			modifier = {
				factor = 50
				trait = greedy 
			}
		}
		hidden_tooltip = {
			# Chest
			if = {
				limit = { check_variable = { which = apocalypse_chest value = 2 } } 			
				character_event = { id = regalia.71 } 
			}
			# Trap
			if = {
				limit = { NOT = { check_variable = { which = apocalypse_chest value = 2 } } }			
				character_event = { id = regalia.66 } 
			}
		}
	}	
}

# Manakete-trapped chest.
character_event = {
	id = regalia.70
	desc = regalia.70.desc
	picture = "GFX_evt_fire_dragons_gate" 
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.70.A"		
		death = { death_reason = death_burned_manakete }
	}	
}

#Claim the tome
narrative_event = {
	id = regalia.71
	title = regalia.71.title
	desc = regalia.71.desc
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.71.A"
		add_artifact = regalia_apocalypse
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_apocalypse_held 
		clr_character_flag = regalia_apocalypse_trial
	}		
}

# Mulagir

# Starting point - do you want to search?
character_event = {
	id = regalia.72
	desc = "regalia.72.desc"
	picture = "GFX_evt_mongols" 
	
	is_triggered_only = yes
	
	# Yes, let's look
	option = {
		name = "regalia.72.A"
		trigger = {
			NOT = { has_character_flag = regalia_mulagir_info }
		}
		hidden_tooltip = { character_event = { id = regalia.73 days = 5 } }
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.72.B"
		trigger = {
			has_character_flag = regalia_mulagir_info 
		}
		hidden_tooltip = { character_event = { id = regalia.78 } }
	}		
	# No
	option = {
		name = "regalia.72.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}
# Looking for Mulagir
narrative_event = {
	id = regalia.73
	title = "regalia.73.title"
	desc = "regalia.73.desc"
	picture = "GFX_evt_market" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_mulagir_info
	}
	
	option = {
		name = "regalia.73.A"
		prestige = 10
		hidden_tooltip = { 
			character_event = { id = regalia.78 } 	
		}
	}	
	
	option = {
		name = "regalia.73.B"
		wealth = -10
		hidden_tooltip = { 
			character_event = { id = regalia.75 } 
		}
	}		
	
	option = {
		name = "regalia.73.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# The Silver Wolf event - check ruins for bow.
character_event = {
	id = regalia.74
	#title = "regalia.74.title"
	desc = "regalia.74.desc"
	picture = "GFX_evt_mongols" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.74.A"
		trigger = { NOT = { has_character_flag = regalia_mulagir_trial_1_checked } }
		set_character_flag = regalia_mulagir_trial_1_checked
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = regalia_mulagir_trial_1 }
				character_event = { id = regalia.79 } 
				break = yes
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_mulagir_trial_1 } }
				character_event = { id = regalia.76 } 
			}
		}
	}	
	option = {
		name = "regalia.74.B"
		trigger = { NOT = { has_character_flag = regalia_mulagir_trial_2_checked } }
		set_character_flag = regalia_mulagir_trial_2_checked
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = regalia_mulagir_trial_2 }
				character_event = { id = regalia.79 } 
				break = yes
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_mulagir_trial_2 } }
				character_event = { id = regalia.76 } 
			}
		}
	}	
	option = {
		name = "regalia.74.C"
		trigger = { NOT = { has_character_flag = regalia_mulagir_trial_3_checked } }
		set_character_flag = regalia_mulagir_trial_3_checked
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = regalia_mulagir_trial_3 }
				character_event = { id = regalia.79 } 
				break = yes
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_mulagir_trial_3 } }
				character_event = { id = regalia.76 } 
			}
		}
	}		
	
	option = {
		name = "regalia.74.D"
		hidden_tooltip = { character_event = { id = regalia.83 } }
	}		
}

# The Silver Wolf event - check ruins for bow.
character_event = {
	id = regalia.83
	desc = "regalia.83.desc"
	picture = "GFX_evt_mongols" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.83.A"
		trigger = { NOT = { has_character_flag = regalia_mulagir_trial_4_checked } }
		set_character_flag = regalia_mulagir_trial_4_checked
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = regalia_mulagir_trial_4 }
				character_event = { id = regalia.79 } 
				break = yes
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_mulagir_trial_4 } }
				character_event = { id = regalia.76 } 
			}
		}
	}	
	option = {
		name = "regalia.83.B"
		trigger = { NOT = { has_character_flag = regalia_mulagir_trial_5_checked } }
		set_character_flag = regalia_mulagir_trial_5_checked
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = regalia_mulagir_trial_5 }
				character_event = { id = regalia.79 } 
				break = yes
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_mulagir_trial_5 } }
				character_event = { id = regalia.76 } 
			}
		}
	}	
	option = {
		name = "regalia.83.C"
		trigger = { NOT = { has_character_flag = regalia_mulagir_trial_6_checked } }
		set_character_flag = regalia_mulagir_trial_6_checked
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = regalia_mulagir_trial_6 }
				character_event = { id = regalia.79 } 
				break = yes
			}
			if = {
				limit = { NOT = { has_character_flag = regalia_mulagir_trial_6 } }
				character_event = { id = regalia.76 } 
			}
		}
	}		
	
	option = {
		name = "regalia.83.D"
		hidden_tooltip = { character_event = { id = regalia.74 } }
	}		
}

# Warning about the nomads
narrative_event = {
	id = regalia.75
	title = "regalia.75.title"
	desc = "regalia.75.desc"
	picture = "GFX_evt_mongols" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.75.A"
		hidden_tooltip = { character_event = { id = regalia.78 } }
	}		
	
	option = {
		name = "regalia.75.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Spawn nomads
character_event = {
	id = regalia.76
	desc = "regalia.76.desc"
	picture = "GFX_evt_mongols" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.76.A"
		hidden_tooltip = { 
			if = {
				limit = {
					any_current_enemy = {
						has_character_flag = mulagir_guardian
					}
				}
				location = {
					ROOT = {
						random_current_enemy = {
							limit = {
								has_character_flag = mulagir_guardian
							}
							spawn_unit = {
								province = PREVPREV
								home = PREVPREV
								owner = THIS
								match_character = ROOT
								match_mult = 0.083
								attrition = 0
							}
							spawn_unit = {
								province = PREVPREV
								home = PREVPREV
								owner = THIS
								match_character = ROOT
								match_mult = 0.083
								attrition = 0
							}
							spawn_unit = {
								province = PREVPREV
								home = PREVPREV
								owner = THIS
								match_character = ROOT
								match_mult = 0.083
								attrition = 0
							}
						}
					}
				}
			}
			if = {
				limit = {
					NOT = {
						any_current_enemy = {
							has_character_flag = mulagir_guardian
						}
					}
				}
				
				location = {
					create_character = {
						#name="Thoril"
						random_traits = yes
						dynasty = none
						religion = divine_sky_pagan
						culture = sacaean
						female = no
						age = 30
						attributes = {
							martial = 10
						}
						trait = tough_soldier
						trait = holy_warrior
						trait = flat_terrain_leader
						trait = base_class_horse_archer
						trait = class_bow_knight
						trait = heresiarch
					}
					
					new_character = {
						set_character_flag = mulagir_guardian
						set_character_flag = regalia_guardian
						set_character_flag = class_selected
						set_variable = { which = "level" value = 15 }
						create_title = {
							tier = COUNT
							landless = yes
							temporary = yes
							#rebel = yes
							culture = sacaean
							name = "PHANTOM_GUARDIANS"
							holder = THIS
						}
						# Get the war dec to work right.
						# Just make the guardians a vassal of the character if he's a duke or above.
						if = {
							limit = {
								ROOT = {
									primary_title = { higher_tier_than = COUNT } 
								}
							}
							set_defacto_liege = ROOT
						}
						
						# If he's an independent count, the guardians can also stay independent.
						# If he's a vassal count, the guardians need to have the same liege so they don't war the wrong person.
						if = {
							limit = {
								ROOT = {
									primary_title = { lower_tier_than = DUKE } 
									independent = no
								}
							}
							ROOT = {
								liege = {
									save_event_target_as = target_count_liege
								}
							}
							set_defacto_liege = event_target:target_count_liege
							
						}
						#set_defacto_liege = ROOT
						
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							leader = THIS
							match_character = ROOT
							match_mult = 0.083
							attrition = 0
						}
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							match_character = ROOT
							match_mult = 0.083
							attrition = 0
						}
						spawn_unit = {
							province = PREV
							home = PREV
							owner = THIS
							match_character = ROOT
							match_mult = 0.083
							attrition = 0
						}
							
						# DoW on the character
						ROOT = {
							reverse_war = {
								target = PREV
								casus_belli = regalia_guardian
							}
							reverse_opinion = {
								who = PREV
								modifier = opinion_regalia_trespasser
							}
						}
					}
				}
			}
			character_event = { id = regalia.74 }
		}
	}		
}

# Post regalia guardian war event
character_event = {
	id = regalia.77
	hide_window = yes 
	
	is_triggered_only = yes
	
	option = {
		name = OK
		if = {
			limit = { 
				has_character_flag = regalia_durandal_trial 
				has_character_flag = lost_to_regalia_guardians 
			}
			character_event = { id = regalia.4 }
			break = yes
		}
		if = {
			limit = { 
				has_character_flag = regalia_durandal_trial 
				has_character_flag = defeated_regalia_guardians 
			}
			character_event = { id = regalia.5 }
			break = yes
		}
		if = {
			limit = { 
				has_character_flag = regalia_armads_trial 
				has_character_flag = lost_to_regalia_guardians 
			}
			character_event = { id = regalia.37 }
			break = yes
		}
		if = {
			limit = { 
				has_character_flag = regalia_armads_trial 
				has_character_flag = defeated_regalia_guardians 
			}
			character_event = { id = regalia.38 }
			break = yes
		}
		if = {
			limit = { 
				has_character_flag = regalia_mulagir_trial 
				has_character_flag = lost_to_regalia_guardians 
			}
			character_event = { id = regalia.80 }
			break = yes
		}
		if = {
			limit = { 
				has_character_flag = regalia_mulagir_trial 
				has_character_flag = defeated_regalia_guardians 
			}
			character_event = { id = regalia.81 }
			break = yes
		}
	}		
}

# Set some flags before the Silver Wolf event
character_event = {
	id = regalia.78
	hide_window = yes
	is_triggered_only = yes
		
	option = {
		name = OK
		clr_character_flag = regalia_mulagir_trial_1
		clr_character_flag = regalia_mulagir_trial_1_checked
		clr_character_flag = regalia_mulagir_trial_2
		clr_character_flag = regalia_mulagir_trial_2_checked
		clr_character_flag = regalia_mulagir_trial_3
		clr_character_flag = regalia_mulagir_trial_3_checked
		clr_character_flag = regalia_mulagir_trial_4
		clr_character_flag = regalia_mulagir_trial_4_checked
		clr_character_flag = regalia_mulagir_trial_5
		clr_character_flag = regalia_mulagir_trial_5_checked
		clr_character_flag = regalia_mulagir_trial_6
		clr_character_flag = regalia_mulagir_trial_6_checked
		
		set_character_flag = regalia_mulagir_trial
		random_list = {
			16 = { set_character_flag = regalia_mulagir_trial_1 }
			16 = { set_character_flag = regalia_mulagir_trial_2 }
			16 = { set_character_flag = regalia_mulagir_trial_3 }
			16 = { set_character_flag = regalia_mulagir_trial_4 }
			16 = { set_character_flag = regalia_mulagir_trial_5 }
			16 = { set_character_flag = regalia_mulagir_trial_6 }
		}
		character_event = { id = regalia.74 }
	}		
}

# Found the bow!
character_event = {
	id = regalia.79
	desc = "regalia.79.desc"
	picture = "GFX_evt_mongols" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.79.A"
		trigger = {
			NOT = {
				any_current_enemy = {
					has_character_flag = mulagir_guardian
				}
			}
		}
		piety = 100
		hidden_tooltip = { character_event = { id = regalia.82 } }
	}		
	option = {
		name = "regalia.79.B"
		trigger = {
			any_current_enemy = {
				has_character_flag = mulagir_guardian
			}
		}
	}		
}

# Lost to the guardians
character_event = {
	id = regalia.80
	desc = "regalia.80.desc"
	picture = "GFX_evt_bad_news" 
	is_triggered_only = yes
	option = {
		name = "regalia.80.A"
		set_character_flag = regalia_mulagir_failure
		clr_character_flag = regalia_mulagir_trial
		clr_character_flag = lost_to_regalia_guardians
		prestige = -500
	}		
}

# Defeated the guardians
character_event = {
	id = regalia.81
	desc = "regalia.81.desc"
	picture = "GFX_evt_mongols"
	is_triggered_only = yes
	option = {
		name = "regalia.81.A"
		clr_character_flag = regalia_mulagir_trial
		clr_character_flag = defeated_regalia_guardians
		hidden_tooltip = { character_event = { id = regalia.82 } }
	}		
}

# Claim the bow
narrative_event = {
	id = regalia.82
	title = regalia.82.title
	desc = regalia.82.desc
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.82.A"
		add_artifact = regalia_mulagir
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_mulagir_held 
		clr_character_flag = regalia_mulagir_trial_1
		clr_character_flag = regalia_mulagir_trial_1_checked
		clr_character_flag = regalia_mulagir_trial_2
		clr_character_flag = regalia_mulagir_trial_2_checked
		clr_character_flag = regalia_mulagir_trial_3
		clr_character_flag = regalia_mulagir_trial_3_checked
		clr_character_flag = regalia_mulagir_trial_4
		clr_character_flag = regalia_mulagir_trial_4_checked
		clr_character_flag = regalia_mulagir_trial_5
		clr_character_flag = regalia_mulagir_trial_5_checked
		clr_character_flag = regalia_mulagir_trial_6
		clr_character_flag = regalia_mulagir_trial_6_checked
	}		
}

# Force a regalia guardian's surrender if they're out of troops.
character_event = {
	id = regalia.84 	
	hide_window = yes
	is_triggered_only = yes
	
	only_rulers = yes
	trigger = {
		has_character_flag = regalia_guardian
		any_war = {
			attacker = { character = ROOT }
		}
		any_current_enemy = {
			ROOT = { 
				NOT = { relative_power = { who = PREV power = 0.01 } }
			}
		}
	}
	
	
	option = {
		name = OK
		any_war = {
			limit = {
				attacker = { character = ROOT }
				using_cb = regalia_guardian
			}
			end_war = reverse_demand
		} 
	}
}

# Maltet

# Starting point - do you want to search?
character_event = {
	id = regalia.85
	desc = "regalia.85.desc"
	picture = "GFX_evt_knight_kneeling" 
	
	is_triggered_only = yes
	
	# Yes, let's look
	option = {
		name = "regalia.85.A"
		trigger = {
			NOT = { has_character_flag = regalia_maltet_info }
		}
		hidden_tooltip = { character_event = { id = regalia.86 days = 5 } }
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.85.B"
		trigger = {
			has_character_flag = regalia_maltet_info 
		}
		hidden_tooltip = { character_event = { id = regalia.88 } }
	}		
	# No
	option = {
		name = "regalia.85.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}

# Looking for maltet
narrative_event = {
	id = regalia.86
	title = "regalia.86.title"
	desc = "regalia.86.desc"
	picture = "GFX_evt_bishop" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_maltet_info
	}
	
	option = {
		name = "regalia.86.A"
		hidden_tooltip = { 
			character_event = { id = regalia.88 } 	
		}
	}	
	
	option = {
		name = "regalia.86.B"
		piety = -10
		hidden_tooltip = { 
			character_event = { id = regalia.87 } 
		}
	}		
	
	option = {
		name = "regalia.86.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Information about the shrine
narrative_event = {
	id = regalia.87
	title = "regalia.87.title"
	desc = "regalia.87.desc"
	picture = "GFX_evt_bishop" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.87.A"
		hidden_tooltip = { character_event = { id = regalia.88 } }
	}		
	
	option = {
		name = "regalia.87.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Maltet shrine
narrative_event = {
	id = regalia.88
	title = "regalia.88.title"
	desc = "regalia.88.desc"
	picture = "GFX_evt_midwinter_blot_oldgods" 
	
	is_triggered_only = yes
	immediate = {
		set_character_flag = regalia_maltet_trial
	}
	option = {
		name = "regalia.88.A"
		trigger = {
			OR = {
				is_smart_trigger = yes
				trait = architect
				trait = siege_leader
				learning = 10
				intrigue = 10
			}
		}
		set_character_flag = regalia_maltet_trial_smart
		character_event = { id = regalia.89 }
	}		
	option = {
		name = "regalia.88.B"
		trigger = {
			OR = {
				trait = wroth
				trait = strong
			}
		}
		set_character_flag = regalia_maltet_trial_direct
		character_event = { id = regalia.89 }
	}		
	
	option = {
		name = "regalia.88.D"
		set_character_flag = regalia_maltet_failure
	}		
}

character_event = {
	id = regalia.89
	#title = "regalia.89.title"
	#desc = "regalia.89.desc"
	desc = {
		trigger = {
			has_character_flag = regalia_maltet_trial_smart
		}
		text = regalia.89.desc.1
	}	
	desc = {
		trigger = {
			has_character_flag = regalia_maltet_trial_direct
		}
		text = regalia.89.desc.2
	}
	picture = "GFX_evt_midwinter_blot_oldgods" 
	
	is_triggered_only = yes
	option = {
		name = "regalia.89.A"
		clr_character_flag = regalia_maltet_trial_smart
		clr_character_flag = regalia_maltet_trial_direct
		character_event = { id = regalia.90 }
	}		
}

# Claim the spear
narrative_event = {
	id = regalia.90
	title = regalia.90.title
	desc = regalia.90.desc
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.90.A"
		add_artifact = regalia_maltet
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_maltet_held 
		clr_character_flag = regalia_maltet_trial
	}		
}

# aureola

# Starting point - do you want to search?
character_event = {
	id = regalia.91
	desc = "regalia.91.desc"
	picture = "GFX_evt_bishop" 
	
	is_triggered_only = yes
	
	# Yes, let's look
	option = {
		name = "regalia.91.A"
		trigger = {
			NOT = { has_character_flag = regalia_aureola_info }
		}
		hidden_tooltip = { character_event = { id = regalia.92 days = 5 } }
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.91.B"
		trigger = {
			has_character_flag = regalia_aureola_info 
		}
		hidden_tooltip = { character_event = { id = regalia.94 } }
	}		
	# No
	option = {
		name = "regalia.91.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}

# Looking for aureola
narrative_event = {
	id = regalia.92
	title = "regalia.92.title"
	desc = "regalia.92.desc"
	picture = "GFX_evt_bishop" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_aureola_info
	}
	
	option = {
		name = "regalia.92.A"
		prestige = 10
		hidden_tooltip = { 
			character_event = { id = regalia.94 } 	
		}
	}	
	
	option = {
		name = "regalia.92.B"
		hidden_tooltip = { 
			character_event = { id = regalia.93 } 
		}
	}		
	
	option = {
		name = "regalia.92.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Information about the item
narrative_event = {
	id = regalia.93
	title = "regalia.93.title"
	desc = "regalia.93.desc"
	picture = "GFX_evt_bishop" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.93.A"
		hidden_tooltip = { character_event = { id = regalia.94 } }
	}		
	
	option = {
		name = "regalia.93.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Ping event to get ToS holder in scope
character_event = {
	id = regalia.94	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		set_character_flag = regalia_aureola_trial
	}

	option = {
		name = OK
		if = {
			limit = { has_landed_title = b_tower_of_the_saint }
			character_event = { id = regalia.96 } # If they hold the tower, they can search at their leisure. Go to that event.
		}
		if = {
			limit = { NOT = { has_landed_title = b_tower_of_the_saint } }
			b_tower_of_the_saint = {
				holder_scope = {
					character_event = { id = regalia.99 } # Else ping the holder to get them in scope.
				}
			}
		}
	}		
}

# Claim the tome
narrative_event = {
	id = regalia.95
	title = regalia.95.title
	desc = regalia.95.desc
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.95.A"
		add_artifact = regalia_aureola
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_aureola_held 
		clr_character_flag = regalia_aureola_trial
	}		
}

character_event = {
	id = regalia.96
	desc = "regalia.96.desc"
	picture = "GFX_evt_pope_feast" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.96.A"
		character_event = { id = regalia.97 }
	}		
}

# Aureola chamber trial
character_event = {
	id = regalia.97	

	is_triggered_only = yes
	hide_window = yes
	
	option = {
		name = OK
		if = {
			limit = {  
				OR = {
					AND = {
						religion = elimine_church
						piety = 1
					}
					AND = {
						religion_group = light_group
						piety = 100
						OR = {
							trait = class_monk
							trait = class_cleric
							trait = class_priest
							trait = class_war_cleric
							trait = class_war_priest
							trait = class_bishop
							trait = class_bishop_female
						}
					}
					AND = {
						religion_group = light_group
						piety = 200
					}
				}
			}
			character_event = { id = regalia.95 } # success
			break = yes
		}
		character_event = { id = regalia.98 } # failure
	}		
}

# Found Aureola but can't take it
character_event = {
	id = regalia.98
	desc = "regalia.98.desc"
	picture = "GFX_evt_bad_news" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.98.A"
		clr_character_flag = regalia_aureola_trial
		set_character_flag = regalia_aureola_failure
	}		
}

# Ping back to hunter
character_event = {
	id = regalia.99	
	is_triggered_only = yes
	hide_window = yes
	
	option = {
		name = OK		
		FROM = { character_event = { id = regalia.100 } }
	}		
}

# Tower of the Saint - how to proceed?
narrative_event = {
	id = regalia.100
	title = "regalia.100.title"
	desc = "regalia.100.desc"
	picture = "GFX_evt_pope_feast" 
	
	is_triggered_only = yes
	immediate = {
		set_character_flag = regalia_aureola_trial
	}

	# Ask the owner of the bishopric to look around
	option = {
		name = "regalia.100.A"
		trigger = {
			NOT = { has_character_flag = regalia_aureola_trial_search_prohibited }
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100			
				OR = {
					has_pious_trait_trigger = yes
					has_virtue_trigger = yes
					has_benevolent_trait_trigger = yes
					has_pleasant_trait_trigger = yes
				}
			}
		}
		piety = 50
		FROM = {
			character_event = { id = regalia.101 }
		}
	}		

	# Sneak in
	option = {
		name = "regalia.100.B"
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2			
				trait = deceitful
			}
		}
		piety = -100
		character_event = { id = regalia.106 }
	}		
	
	# Storm the tower
	option = {
		name = "regalia.100.C"
		trigger = {
			b_tower_of_the_saint = {
				holder_scope = {
					OR = {
						any_current_enemy = {
							character = ROOT
						}
						any_liege = {
							any_current_enemy = {
								character = ROOT
							}
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 100
		}
		piety = -50
		character_event = { id = regalia.112 }
	}
	
	# Give up
	option = {
		name = "regalia.100.D"
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100	
				has_character_flag = regalia_aureola_trial_search_prohibited 		
				OR = {
					is_pious_trigger = yes
					has_virtue_trigger = yes
					has_pleasant_personality_trigger = yes
				}
			}
		}
		piety = 100
		clr_character_flag = regalia_aureola_trial
		set_character_flag = regalia_aureola_failure
	}		
}

# Holder of tower is asked for permission
character_event = {
	id = regalia.101
	desc = "regalia.101.desc"
	picture = "GFX_evt_pilgrims_epic_journey" 
	
	is_triggered_only = yes
	
	# okay
	option = {
		name = "regalia.101.A"
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0			
				NOT = { opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 2			
				opinion = { who = FROM value = 50 } 
			}
		}
		piety = 100
		custom_tooltip = {
			name = regalia.101.A.tooltip
			hidden_tooltip = {
				FROM = {
					character_event = { id = regalia.102 }
				}
			}
		}
	}	
	# ask for money
	option = {
		name = "regalia.101.B"
		ai_chance = {
			factor = 25
			modifier = {
				factor = 10			
				trait = greedy
			}
			modifier = {
				factor = 0.1			
				trait = charitable
			}
		}
		piety = -50
		custom_tooltip = {
			name = regalia.101.B.tooltip
			hidden_tooltip = {
				FROM = {
					character_event = { id = regalia.103 }
				}
			}
		}
	}	
	# Ask for a favor
	option = {
		name = "regalia.101.D"
		ai_chance = {
			factor = 25
			modifier = {
				factor = 2			
				trait = ambitious
			}
		}
		piety = -10
		custom_tooltip = {
			name = regalia.101.D.tooltip
			hidden_tooltip = {
				FROM = {
					character_event = { id = regalia.110 }
				}
			}
		}
	}		
	# No
	option = {
		name = "regalia.101.D"
		ai_chance = {
			factor = 25
			modifier = {
				factor = 100			
				NOT = { opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 2		
				OR = {	
					trait = zealous	
					is_pious_trigger = yes
				}
			}
		}
		custom_tooltip = {
			name = regalia.101.D.tooltip
			hidden_tooltip = {
				FROM = {
					character_event = { id = regalia.113 }
				}
			}
		}
	}	
}

# Holder allows hunter to search
character_event = {
	id = regalia.102
	desc = "regalia.102.desc"
	picture = "GFX_evt_pope_feast" 
	
	is_triggered_only = yes
	
	option = {
		#name = "regalia.102.A"
		name = EXCELLENT
		opinion = {
			modifier = opinion_grateful
			who = FROM
			years = 1
		}	
		character_event = { id = regalia.97 }	
	}		
}

# Holder asks hunter for money
character_event = {
	id = regalia.103
	desc = "regalia.103.desc"
	picture = "GFX_evt_pope_feast" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.103.A"
		transfer_scaled_wealth = {
			to = FROM
			value = 0.25
			min = 50
		}
		opinion = {
			modifier = opinion_irritated
			who = FROM
			years = 1
		}	
		hidden_tooltip = {
			FROM = {
				character_event = { id = regalia.104 }
			}
		}
		character_event = { id = regalia.97 }
	}	
	option = {
		name = "regalia.103.B"
		custom_tooltip = {
			name = regalia.103.B.tooltip
			hidden_tooltip = {
				set_character_flag = regalia_aureola_trial_search_prohibited
				character_event = { id = regalia.100 }
				FROM = {
					character_event = { id = regalia.105 }
				}
			}
		}
	}		
}

# Notify holder of payment
character_event = {
	id = regalia.104
	desc = "regalia.104.desc"
	picture = "GFX_evt_pilgrims_epic_journey" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.104.A"
		opinion = {
			modifier = opinion_happy
			who = FROM
			years = 1
		}	
	}		
}
# Notify holder of no payment
character_event = {
	id = regalia.105
	desc = "regalia.105.desc"
	picture = "GFX_evt_pilgrims_epic_journey" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.105.A"
		opinion = {
			modifier = opinion_irritated
			who = FROM
			years = 1
		}	
	}		
}

# Sneaking into the tower of the Saint
character_event = {
	id = regalia.106
	desc = "regalia.106.desc"
	picture = "GFX_evt_shadow" 
	
	is_triggered_only = yes
	
	immediate = {
		# Check hunter's intrigue against holder's intrigue to see if they get in
		random_list = {
			50 = {
				modifier = {
					factor = 1.25
					intrigue = 5
					NOT = { intrigue = 10 }
				}
				modifier = {
					factor = 1.5
					intrigue = 10
					NOT = { intrigue = 15 }
				}
				modifier = {
					factor = 2
					intrigue = 15
					NOT = { intrigue = 20 }
				}
				modifier = {
					factor = 3
					intrigue = 20
					NOT = { intrigue = 25 }
				}
				modifier = {
					factor = 4
					intrigue = 25
					NOT = { intrigue = 30 }
				}
				modifier = {
					factor = 5
					intrigue = 30
				}
				set_character_flag = regalia_aureola_trial_sneak_success
			}
			50 = {
				modifier = {
					factor = 1.25
					b_tower_of_the_saint = { holder_scope = { intrigue = 5 } }
					NOT = { b_tower_of_the_saint = { holder_scope = {intrigue = 10 } } }
				}
				modifier = {
					factor = 1.5
					b_tower_of_the_saint = { holder_scope = { intrigue = 10 } }
					NOT = { b_tower_of_the_saint = { holder_scope = { intrigue = 15 } } }
				}
				modifier = {
					factor = 2
					b_tower_of_the_saint = { holder_scope = { intrigue = 15 } }
					NOT = { b_tower_of_the_saint = { holder_scope = { intrigue = 20 } } }
				}
				modifier = {
					factor = 3
					b_tower_of_the_saint = { holder_scope = { intrigue = 20 } }
					NOT = { b_tower_of_the_saint = { holder_scope = { intrigue = 25 } } }
				}
				modifier = {
					factor = 4
					b_tower_of_the_saint = { holder_scope = { intrigue = 25 } }
					NOT = { b_tower_of_the_saint = { holder_scope = { intrigue = 30 } } }
				}
				modifier = {
					factor = 5
					b_tower_of_the_saint = { holder_scope = { intrigue = 30 } }
				}
				set_character_flag = regalia_aureola_trial_sneak_failure
			}
		}

	}
	# Success
	option = {
		name = "regalia.106.A"
		trigger = { has_character_flag = regalia_aureola_trial_sneak_success }
		hidden_tooltip = {
			clr_character_flag = regalia_aureola_trial_sneak_success
			character_event = { id = regalia.97 }
			b_tower_of_the_saint = { holder_scope = { 
				character_event = { id = regalia.107 }
			} }
		}
	}		
	# Heavenly arrows
	option = {
		name = "regalia.106.B"
		trigger = { has_character_flag = regalia_aureola_trial_sneak_failure }
		hidden_tooltip = {
			clr_character_flag = regalia_aureola_trial_sneak_failure
			character_event = { id = regalia.108 }
			b_tower_of_the_saint = { holder_scope = { 
				character_event = { id = regalia.109 }
			} }
		}
	}		
}

# Notify holder of theft
character_event = {
	id = regalia.107
	desc = "regalia.107.desc"
	picture = "GFX_evt_emissary" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.107.A"
	}		
}

# Heavenly Arrows
character_event = {
	id = regalia.108
	desc = "regalia.108.desc"
	picture = "GFX_evt_shadow" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.108.A"
		if = {
			limit = {
				NOT = { trait = wounded }
			}
			add_trait = wounded
		}
		clr_character_flag = regalia_aureola_trial
		set_character_flag = regalia_aureola_failure
	}		
}

# Notify holder of theft attempt
character_event = {
	id = regalia.109
	desc = "regalia.109.desc"
	picture = "GFX_evt_shadow" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.109.A"
	}		
}


# Holder asks hunter for a favor
character_event = {
	id = regalia.110
	desc = "regalia.110.desc"
	picture = "GFX_evt_pope_feast" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.110.A"
		FROM = {
			add_favor = ROOT
		}
		hidden_tooltip = {
			FROM = {
				character_event = { id = regalia.111 }
			}
		}
		character_event = { id = regalia.97 }
	}	
	option = {
		name = "regalia.110.B"
		custom_tooltip = {
			name = regalia.103.B.tooltip
			hidden_tooltip = {
				set_character_flag = regalia_aureola_trial_search_prohibited
				character_event = { id = regalia.100 }
				FROM = {
					character_event = { id = regalia.105 }
				}
			}
		}
	}		
}

# Notify holder of favor
character_event = {
	id = regalia.111
	desc = "regalia.111.desc"
	picture = "GFX_evt_pilgrims_epic_journey" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.111.A"
		opinion = {
			modifier = opinion_happy
			who = FROM
			years = 1
		}	
	}		
}

# Hunter storms the tower
character_event = {
	id = regalia.112
	desc = "regalia.112.desc"
	picture = "GFX_evt_siege" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.112.A"
		prestige = 50
		character_event = { id = regalia.97 }	
	}		
}

# Holder denies hunter's request
character_event = {
	id = regalia.113
	desc = "regalia.113.desc"
	picture = "GFX_evt_pope_feast" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.113.A"
		opinion = {
			modifier = opinion_unhappy
			who = FROM
			years = 1
		}	
		custom_tooltip = {
			name = regalia.103.B.tooltip
			set_character_flag = regalia_aureola_trial_search_prohibited
			hidden_tooltip = {
				character_event = { id = regalia.100 }
			}
		}
	}		
}


# Forblaze

# Starting point - do you want to search?
character_event = {
	id = regalia.114
	desc = "regalia.114.desc"
	picture = "GFX_evt_desert" 
	
	is_triggered_only = yes
	
	# Yes, let's look
	option = {
		name = "regalia.114.A"
		trigger = {
			NOT = { has_character_flag = regalia_forblaze_info }
		}
		hidden_tooltip = { character_event = { id = regalia.115 days = 5 } }
	}	
	# I already found it, skip to the trial
	option = {
		name = "regalia.114.B"
		trigger = {
			has_character_flag = regalia_forblaze_info 
		}
		hidden_tooltip = { character_event = { id = regalia.117 } }
	}		
	# No
	option = {
		name = "regalia.114.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
	}		
}

# Looking for forblaze
narrative_event = {
	id = regalia.115
	title = "regalia.115.title"
	desc = "regalia.115.desc"
	picture = "GFX_evt_market_byzantine" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_forblaze_info
	}
	
	option = {
		name = "regalia.115.A"
		prestige = 10
		hidden_tooltip = { 
			character_event = { id = regalia.117 } 	
		}
	}	
	
	option = {
		name = "regalia.115.B"
		hidden_tooltip = { 
			character_event = { id = regalia.116 } 
		}
	}		
	
	option = {
		name = "regalia.115.C"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}

# Information about the item
narrative_event = {
	id = regalia.116
	title = "regalia.116.title"
	desc = "regalia.116.desc"
	picture = "GFX_evt_market_byzantine" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.116.A"
		hidden_tooltip = { character_event = { id = regalia.117 } }
	}		
	
	option = {
		name = "regalia.116.B"
		add_character_modifier = { name = declined_regalia_search duration = 30 } 
		prestige = -10
	}		
}


character_event = {
	id = regalia.117
	desc = "regalia.117.desc"
	picture = "GFX_evt_meditating_in_temple" 
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = regalia_forblaze_trial
	}
	option = {
		name = "regalia.117.A"
		prestige = -10
		character_event = { id = regalia.118 }
	}		
}

# Forblaze altar
narrative_event = {
	id = regalia.118
	title = "regalia.118.title"
	desc = "regalia.118.desc"
	picture = "GFX_evt_meditating_in_temple" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.118.A"
		trigger = {
			OR = {
				religion = elibe_spirits_pagan
				culture = nabatan
				trait = dragon
				trait = dragon_blood
			}
		}
		ai_chance = {
			factor = 100
		}
		hidden_tooltip = { character_event = { id = regalia.119 } }
	}		
	option = {
		name = "regalia.118.B"
		trigger = {
			OR = {
				trait = strong
				trait = brawny
			}
		}
		ai_chance = {
			factor = 100
		}
		hidden_tooltip = { character_event = { id = regalia.120 } }
	}		
	option = {
		name = "regalia.118.C"
		trigger = {
			any_courtier = {
				prisoner = no
				#opinion = { who = FROM value = 20 }
				OR = {
					trait = strong
					trait = brawny
					OR = {
						religion = elibe_spirits_pagan
						culture = nabatan
						trait = dragon
						trait = dragon_blood
					}
				}
			}
		}
		ai_chance = {
			factor = 100
		}

		if = {
			limit = {
				any_courtier = {
					prisoner = no
					#opinion = { who = FROM value = 20 }
					OR = {
						religion = elibe_spirits_pagan
						culture = nabatan
						trait = dragon
						trait = dragon_blood
					}
				}

			}
			random_courtier = {
				limit = {
					prisoner = no
					#opinion = { who = FROM value = 20 }
					OR = {
						religion = elibe_spirits_pagan
						culture = nabatan
						trait = dragon
						trait = dragon_blood
					}
				}
			}
			hidden_tooltip = { character_event = { id = regalia.119 } }
			break = yes
		}

		if = {
			limit = {
				any_courtier = {
					prisoner = no
					#opinion = { who = FROM value = 20 }
					OR = {
						trait = strong
						trait = brawny
					}
				}

			}
			random_courtier = {
				limit = {
					prisoner = no
					#opinion = { who = FROM value = 20 }
					OR = {
						trait = strong
						trait = brawny
					}
				}
			}
			hidden_tooltip = { character_event = { id = regalia.120 } }
		}
	}		
	
	option = {
		name = "regalia.118.D"
		ai_chance = {
			factor = 1
		}
		prestige = -50
		hidden_tooltip = { character_event = { id = regalia.122 } }
	}		
}

# Open the altar with the right person
character_event = {
	id = regalia.119
	desc = "regalia.119.desc"
	picture = "GFX_evt_meditating_in_temple" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.119.A"
		character_event = { id = regalia.121 }
	}		
}
# Open the altar by force
character_event = {
	id = regalia.120
	desc = "regalia.120.desc"
	picture = "GFX_evt_meditating_in_temple" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.120.A"
		character_event = { id = regalia.121 }
	}		
}

# Claim the tome
narrative_event = {
	id = regalia.121
	title = regalia.121.title
	desc = regalia.121.desc
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.121.A"
		add_artifact = regalia_forblaze
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_forblaze_held 
		clr_character_flag = regalia_forblaze_trial
	}		
}

# Can't open the altar 
character_event = {
	id = regalia.122
	desc = "regalia.122.desc"
	picture = "GFX_evt_meditating_in_temple" 
	
	is_triggered_only = yes
	
	option = {
		name = "regalia.122.A"
		clr_character_flag = regalia_forblaze_trial
		set_character_flag = regalia_forblaze_failure
	}		
}

# Mani Katti is held by the owner of the shrine, or Lyn.

# Sol Katti
character_event = {
	id = regalia.123
	#desc = regalia.123.desc
	desc = {
		trigger = {
			any_courtier = { has_job_title = job_spiritual }
		}
		text = regalia.123.desc.1
	}	
	desc = {
		trigger = {
			NOT = { 
				any_courtier = { has_job_title = job_spiritual }
			}
		}
		text = regalia.123.desc.2
	}
	picture = "GFX_evt_mongols" 
	
    #has_dlc = "Mystics"
	prisoner = no
	only_playable = yes
	capable_only = yes
	min_age = 14
	
	trigger = {
		has_ambition = obj_acquire_regalia
		NOT = { has_global_flag = regalia_sol_katti_held }
		culture = sacaean
		OR = {
			religion = divine_sky_pagan
			religion = divine_sky_pagan_reformed
			religion = elibe_spirits_pagan
		}
		#any_courtier = { has_job_title = job_spiritual }
	}
	
	mean_time_to_happen = {
		years = 5000
		
		modifier = {
			factor = 0.5
			prestige = 1000
		}
		modifier = {
			factor = 0.5
			prestige = 5000
		}
		modifier = {
			factor = 0.5
			prestige = 10000
		}
		modifier = {
			factor = 0.5
			piety = 1000
		}
		modifier = {
			factor = 0.5
			piety = 3000
		}
		modifier = {
			factor = 0.5
			piety = 5000
		}
	}
	
	option = {
		name = "regalia.123.A"
		ai_chance = {
			factor = 90
		}

		add_artifact = regalia_sol_katti
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_sol_katti_held
	}	

	option = {
		name = "regalia.123.B"
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2			
				trait = craven
			}
		}
	}		
}

# Claim the Binding Blade
narrative_event = {
	id = regalia.124
	title = regalia.124.title
	desc = regalia.124.desc
	picture = "GFX_evt_regalia"
	
	is_triggered_only = yes
		
	option = {
		name = "regalia.124.A"
		add_artifact = regalia_binding_blade
		new_artifact = {
			set_creation_date = -1.1.1
		}
		set_global_flag = regalia_binding_blade_held 
	}		
}

# Possible additional events to get regalia:

# Just... find it, randomly?
# Found it going raiding?
# Dig up treasure in remote location?
